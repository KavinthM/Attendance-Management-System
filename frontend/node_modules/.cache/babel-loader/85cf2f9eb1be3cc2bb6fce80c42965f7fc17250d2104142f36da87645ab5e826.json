{"ast":null,"code":"// @ts-check\nimport { EventType } from '../blocks/UploadCtxProvider/EventEmitter.js';\nimport { validateIsImage, validateFileType, validateMaxSizeLimit, validateUploadError } from '../utils/validators/file/index.js';\nimport { validateMultiple, validateCollectionUploadError } from '../utils/validators/collection/index.js';\n\n/**\n * @typedef {(\n *   outputEntry: import('../types').OutputFileEntry,\n *   api: import('./UploaderPublicApi.js').UploaderPublicApi,\n * ) => undefined | import('../types').OutputErrorFile} FuncFileValidator\n */\n\n/**\n * @typedef {(\n *   collection: ReturnType<\n *     typeof import('./buildOutputCollectionState.js').buildOutputCollectionState<\n *       import('../types').OutputCollectionStatus\n *     >\n *   >,\n *   api: import('./UploaderPublicApi.js').UploaderPublicApi,\n * ) => undefined | import('../types').OutputErrorCollection} FuncCollectionValidator\n */\n\nconst LOGGER = {\n  file: 'File validator execution has failed',\n  collection: 'Collection validator execution has failed',\n  message: 'Missing message. We recommend adding message: value.'\n};\nexport class ValidationManager {\n  /**\n   * @private\n   * @type {import('./UploaderBlock.js').UploaderBlock}\n   */\n  _blockInstance;\n\n  /** @type {FuncFileValidator[]} */\n  _fileValidators = [validateIsImage, validateFileType, validateMaxSizeLimit, validateUploadError];\n\n  /** @type {FuncCollectionValidator[]} */\n  _collectionValidators = [validateMultiple, validateCollectionUploadError];\n\n  /** @param {import('./UploaderBlock.js').UploaderBlock} blockInstance */\n  constructor(blockInstance) {\n    this._blockInstance = blockInstance;\n    this._uploadCollection = this._blockInstance.uploadCollection;\n    const runAllValidators = () => {\n      this.runFileValidators();\n      this.runCollectionValidators();\n    };\n    this._blockInstance.subConfigValue('maxLocalFileSizeBytes', runAllValidators);\n    this._blockInstance.subConfigValue('multipleMin', runAllValidators);\n    this._blockInstance.subConfigValue('multipleMax', runAllValidators);\n    this._blockInstance.subConfigValue('multiple', runAllValidators);\n    this._blockInstance.subConfigValue('imgOnly', runAllValidators);\n    this._blockInstance.subConfigValue('accept', runAllValidators);\n  }\n\n  /** @param {string[]} [entryIds] */\n  runFileValidators(entryIds) {\n    const ids = entryIds ?? this._uploadCollection.items();\n    for (const id of ids) {\n      const entry = this._uploadCollection.read(id);\n      if (entry) {\n        this._runFileValidatorsForEntry(entry);\n      }\n    }\n  }\n  runCollectionValidators() {\n    const collection = this._blockInstance.api.getOutputCollectionState();\n    const errors = [];\n    for (const validator of [...this._collectionValidators, ...this._addCustomTypeToValidators(this._blockInstance.cfg.collectionValidators)]) {\n      try {\n        const errorOrErrors = validator(collection, this._blockInstance.api);\n        if (!errorOrErrors) {\n          continue;\n        }\n        if (errorOrErrors) {\n          errors.push(errorOrErrors);\n          if (!errorOrErrors.message) {\n            console.warn(LOGGER.message);\n          }\n        }\n      } catch (error) {\n        console.warn(LOGGER.collection, error);\n      }\n    }\n    this._blockInstance.$['*collectionErrors'] = errors;\n    if (errors.length > 0) {\n      this._blockInstance.emit(EventType.COMMON_UPLOAD_FAILED, () => (/** @type {import('../types').OutputCollectionState<'failed'>} */\n      this._blockInstance.api.getOutputCollectionState()), {\n        debounce: true\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @param {import('./TypedData.js').TypedData<typeof import('./uploadEntrySchema.js').uploadEntrySchema>} entry\n   */\n  _runFileValidatorsForEntry(entry) {\n    const outputEntry = this._blockInstance.api.getOutputItem(entry.uid);\n    const errors = [];\n    for (const validator of [...this._fileValidators, ...this._addCustomTypeToValidators(this._blockInstance.cfg.fileValidators)]) {\n      try {\n        const error = validator(outputEntry, this._blockInstance.api);\n        if (!error) {\n          continue;\n        }\n        if (error) {\n          errors.push(error);\n          if (!error.message) {\n            console.warn(LOGGER.message);\n          }\n        }\n      } catch (error) {\n        console.warn(LOGGER.file, error);\n      }\n    }\n    entry.setValue('errors', errors);\n  }\n\n  /**\n   * @template T\n   * @param {T[]} validators\n   * @returns {T[]}\n   */\n  _addCustomTypeToValidators(validators) {\n    // @ts-ignore\n    return validators.map(fn => (...args) => {\n      // @ts-ignore\n      const result = fn(...args);\n      return result ? {\n        ...result,\n        ...{\n          type: 'CUSTOM_ERROR'\n        }\n      } : undefined;\n    });\n  }\n}","map":{"version":3,"names":["EventType","validateIsImage","validateFileType","validateMaxSizeLimit","validateUploadError","validateMultiple","validateCollectionUploadError","LOGGER","file","collection","message","ValidationManager","_blockInstance","_fileValidators","_collectionValidators","constructor","blockInstance","_uploadCollection","uploadCollection","runAllValidators","runFileValidators","runCollectionValidators","subConfigValue","entryIds","ids","items","id","entry","read","_runFileValidatorsForEntry","api","getOutputCollectionState","errors","validator","_addCustomTypeToValidators","cfg","collectionValidators","errorOrErrors","push","console","warn","error","$","length","emit","COMMON_UPLOAD_FAILED","debounce","outputEntry","getOutputItem","uid","fileValidators","setValue","validators","map","fn","args","result","type","undefined"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/abstract/ValidationManager.js"],"sourcesContent":["// @ts-check\nimport { EventType } from '../blocks/UploadCtxProvider/EventEmitter.js';\nimport {\n  validateIsImage,\n  validateFileType,\n  validateMaxSizeLimit,\n  validateUploadError,\n} from '../utils/validators/file/index.js';\nimport { validateMultiple, validateCollectionUploadError } from '../utils/validators/collection/index.js';\n\n/**\n * @typedef {(\n *   outputEntry: import('../types').OutputFileEntry,\n *   api: import('./UploaderPublicApi.js').UploaderPublicApi,\n * ) => undefined | import('../types').OutputErrorFile} FuncFileValidator\n */\n\n/**\n * @typedef {(\n *   collection: ReturnType<\n *     typeof import('./buildOutputCollectionState.js').buildOutputCollectionState<\n *       import('../types').OutputCollectionStatus\n *     >\n *   >,\n *   api: import('./UploaderPublicApi.js').UploaderPublicApi,\n * ) => undefined | import('../types').OutputErrorCollection} FuncCollectionValidator\n */\n\nconst LOGGER = {\n  file: 'File validator execution has failed',\n  collection: 'Collection validator execution has failed',\n  message: 'Missing message. We recommend adding message: value.',\n};\n\nexport class ValidationManager {\n  /**\n   * @private\n   * @type {import('./UploaderBlock.js').UploaderBlock}\n   */\n  _blockInstance;\n\n  /** @type {FuncFileValidator[]} */\n  _fileValidators = [validateIsImage, validateFileType, validateMaxSizeLimit, validateUploadError];\n\n  /** @type {FuncCollectionValidator[]} */\n  _collectionValidators = [validateMultiple, validateCollectionUploadError];\n\n  /** @param {import('./UploaderBlock.js').UploaderBlock} blockInstance */\n  constructor(blockInstance) {\n    this._blockInstance = blockInstance;\n\n    this._uploadCollection = this._blockInstance.uploadCollection;\n\n    const runAllValidators = () => {\n      this.runFileValidators();\n      this.runCollectionValidators();\n    };\n\n    this._blockInstance.subConfigValue('maxLocalFileSizeBytes', runAllValidators);\n    this._blockInstance.subConfigValue('multipleMin', runAllValidators);\n    this._blockInstance.subConfigValue('multipleMax', runAllValidators);\n    this._blockInstance.subConfigValue('multiple', runAllValidators);\n    this._blockInstance.subConfigValue('imgOnly', runAllValidators);\n    this._blockInstance.subConfigValue('accept', runAllValidators);\n  }\n\n  /** @param {string[]} [entryIds] */\n  runFileValidators(entryIds) {\n    const ids = entryIds ?? this._uploadCollection.items();\n    for (const id of ids) {\n      const entry = this._uploadCollection.read(id);\n      if (entry) {\n        this._runFileValidatorsForEntry(entry);\n      }\n    }\n  }\n\n  runCollectionValidators() {\n    const collection = this._blockInstance.api.getOutputCollectionState();\n    const errors = [];\n\n    for (const validator of [\n      ...this._collectionValidators,\n      ...this._addCustomTypeToValidators(this._blockInstance.cfg.collectionValidators),\n    ]) {\n      try {\n        const errorOrErrors = validator(collection, this._blockInstance.api);\n        if (!errorOrErrors) {\n          continue;\n        }\n        if (errorOrErrors) {\n          errors.push(errorOrErrors);\n\n          if (!errorOrErrors.message) {\n            console.warn(LOGGER.message);\n          }\n        }\n      } catch (error) {\n        console.warn(LOGGER.collection, error);\n      }\n    }\n\n    this._blockInstance.$['*collectionErrors'] = errors;\n\n    if (errors.length > 0) {\n      this._blockInstance.emit(\n        EventType.COMMON_UPLOAD_FAILED,\n        () =>\n          /** @type {import('../types').OutputCollectionState<'failed'>} */ (\n            this._blockInstance.api.getOutputCollectionState()\n          ),\n        { debounce: true },\n      );\n    }\n  }\n\n  /**\n   * @private\n   * @param {import('./TypedData.js').TypedData<typeof import('./uploadEntrySchema.js').uploadEntrySchema>} entry\n   */\n  _runFileValidatorsForEntry(entry) {\n    const outputEntry = this._blockInstance.api.getOutputItem(entry.uid);\n    const errors = [];\n\n    for (const validator of [\n      ...this._fileValidators,\n      ...this._addCustomTypeToValidators(this._blockInstance.cfg.fileValidators),\n    ]) {\n      try {\n        const error = validator(outputEntry, this._blockInstance.api);\n        if (!error) {\n          continue;\n        }\n        if (error) {\n          errors.push(error);\n\n          if (!error.message) {\n            console.warn(LOGGER.message);\n          }\n        }\n      } catch (error) {\n        console.warn(LOGGER.file, error);\n      }\n    }\n    entry.setValue('errors', errors);\n  }\n\n  /**\n   * @template T\n   * @param {T[]} validators\n   * @returns {T[]}\n   */\n  _addCustomTypeToValidators(validators) {\n    // @ts-ignore\n    return validators.map((fn) => (...args) => {\n      // @ts-ignore\n      const result = fn(...args);\n\n      return result ? { ...result, ...{ type: 'CUSTOM_ERROR' } } : undefined;\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}