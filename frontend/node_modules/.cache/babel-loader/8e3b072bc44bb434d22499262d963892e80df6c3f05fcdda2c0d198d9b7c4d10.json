{"ast":null,"code":"// src/utils/api.js\n// Centralized API helper — JSON by default, supports FormData, timeouts, and JWT auth.\n\n// ✅ Use relative base by default so CRA/Vite proxy forwards to http://localhost:5000\n// If you want to bypass the proxy, set REACT_APP_API_BASE (e.g., http://localhost:5000)\nexport const API_BASE = (process.env.REACT_APP_API_BASE || \"\").replace(/\\/+$/, \"\");\n\n// --- token helpers ---\nexport function setToken(token) {\n  try {\n    localStorage.setItem(\"token\", token);\n    console.log('Token stored:', token);\n  } catch (e) {\n    console.error('Failed to store token:', e);\n  }\n}\nexport function getToken() {\n  try {\n    const token = localStorage.getItem(\"token\");\n    // Only log if debugging is needed - reduces console noise\n    // console.log('Token retrieved:', token ? 'present' : 'missing');\n    return token;\n  } catch (e) {\n    console.error('Failed to retrieve token:', e);\n    return null;\n  }\n}\nexport function clearToken() {\n  try {\n    localStorage.removeItem(\"token\");\n  } catch {}\n}\n\n// Build a full URL from a path\nexport function buildUrl(path) {\n  return `${API_BASE}${path.startsWith(\"/\") ? \"\" : \"/\"}${path}`;\n}\n\n/**\n * api(path, options)\n * - method: HTTP method (default \"GET\")\n * - body: object for JSON or FormData for uploads\n * - headers: additional headers (Content-Type set automatically for JSON)\n * - timeoutMs: request timeout (default 12000ms)\n * - withCredentials: include cookies (default false)\n * - skipAuth: don't attach Authorization header (default false)\n * - redirectOn401: auto-redirect to /login on 401 (default false)\n */\nexport async function api(path, {\n  method = \"GET\",\n  body,\n  headers = {},\n  timeoutMs = 12000,\n  withCredentials = false,\n  skipAuth = false,\n  redirectOn401 = false\n} = {}) {\n  var _data;\n  const token = skipAuth ? null : getToken();\n  // Only log API calls if debugging is needed - reduces console noise\n  // console.log('API call to:', path, 'with token:', token ? 'present' : 'missing');\n  const url = buildUrl(path);\n  const ctrl = new AbortController();\n  const timer = setTimeout(() => ctrl.abort(), timeoutMs);\n\n  // If sending FormData, don't set Content-Type; the browser will add the boundary\n  const isForm = typeof FormData !== \"undefined\" && body instanceof FormData;\n  const init = {\n    method,\n    headers: {\n      Accept: \"application/json\",\n      ...(isForm ? {} : {\n        \"Content-Type\": \"application/json\"\n      }),\n      ...(token ? {\n        Authorization: `Bearer ${token}`\n      } : {}),\n      ...headers\n    },\n    ...(withCredentials ? {\n      credentials: \"include\"\n    } : {}),\n    signal: ctrl.signal\n  };\n  if (body != null) {\n    init.body = isForm ? body : JSON.stringify(body);\n  }\n  let res;\n  try {\n    res = await fetch(url, init);\n  } catch {\n    clearTimeout(timer);\n    throw new Error(\"Network error: API unreachable. Ensure backend is running, dev proxy is set, or REACT_APP_API_BASE is correct.\");\n  }\n  clearTimeout(timer);\n\n  // Handle empty responses (e.g., 204 No Content)\n  let data = null;\n  if (res.status !== 204) {\n    try {\n      data = await res.json();\n    } catch {\n      data = null;\n    }\n  }\n  if (!res.ok) {\n    if (res.status === 401 && redirectOn401) {\n      clearToken();\n      if (typeof window !== \"undefined\") window.location.assign(\"/login\");\n    }\n    const msg = data && (data.message || data.error) || `HTTP ${res.status}`;\n    throw new Error(msg);\n  }\n  return (_data = data) !== null && _data !== void 0 ? _data : {};\n}\n\n// Convenience wrappers\nexport const get = (p, o) => api(p, {\n  ...o,\n  method: \"GET\"\n});\nexport const post = (p, body, o) => api(p, {\n  ...o,\n  method: \"POST\",\n  body\n});\nexport const put = (p, body, o) => api(p, {\n  ...o,\n  method: \"PUT\",\n  body\n});\nexport const del = (p, o) => api(p, {\n  ...o,\n  method: \"DELETE\"\n});","map":{"version":3,"names":["API_BASE","process","env","REACT_APP_API_BASE","replace","setToken","token","localStorage","setItem","console","log","e","error","getToken","getItem","clearToken","removeItem","buildUrl","path","startsWith","api","method","body","headers","timeoutMs","withCredentials","skipAuth","redirectOn401","_data","url","ctrl","AbortController","timer","setTimeout","abort","isForm","FormData","init","Accept","Authorization","credentials","signal","JSON","stringify","res","fetch","clearTimeout","Error","data","status","json","ok","window","location","assign","msg","message","get","p","o","post","put","del"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/src/utils/api.js"],"sourcesContent":["// src/utils/api.js\n// Centralized API helper — JSON by default, supports FormData, timeouts, and JWT auth.\n\n// ✅ Use relative base by default so CRA/Vite proxy forwards to http://localhost:5000\n// If you want to bypass the proxy, set REACT_APP_API_BASE (e.g., http://localhost:5000)\nexport const API_BASE = (process.env.REACT_APP_API_BASE || \"\").replace(/\\/+$/, \"\");\n\n// --- token helpers ---\nexport function setToken(token) {\n  try { \n    localStorage.setItem(\"token\", token); \n    console.log('Token stored:', token);\n  } catch (e) {\n    console.error('Failed to store token:', e);\n  }\n}\nexport function getToken() {\n  try { \n    const token = localStorage.getItem(\"token\");\n    // Only log if debugging is needed - reduces console noise\n    // console.log('Token retrieved:', token ? 'present' : 'missing');\n    return token;\n  } catch (e) {\n    console.error('Failed to retrieve token:', e);\n    return null;\n  }\n}\nexport function clearToken() {\n  try { localStorage.removeItem(\"token\"); } catch {}\n}\n\n// Build a full URL from a path\nexport function buildUrl(path) {\n  return `${API_BASE}${path.startsWith(\"/\") ? \"\" : \"/\"}${path}`;\n}\n\n/**\n * api(path, options)\n * - method: HTTP method (default \"GET\")\n * - body: object for JSON or FormData for uploads\n * - headers: additional headers (Content-Type set automatically for JSON)\n * - timeoutMs: request timeout (default 12000ms)\n * - withCredentials: include cookies (default false)\n * - skipAuth: don't attach Authorization header (default false)\n * - redirectOn401: auto-redirect to /login on 401 (default false)\n */\nexport async function api(\n  path,\n  {\n    method = \"GET\",\n    body,\n    headers = {},\n    timeoutMs = 12000,\n    withCredentials = false,\n    skipAuth = false,\n    redirectOn401 = false,\n  } = {}\n) {\n  const token = skipAuth ? null : getToken();\n  // Only log API calls if debugging is needed - reduces console noise\n  // console.log('API call to:', path, 'with token:', token ? 'present' : 'missing');\n  const url = buildUrl(path);\n\n  const ctrl = new AbortController();\n  const timer = setTimeout(() => ctrl.abort(), timeoutMs);\n\n  // If sending FormData, don't set Content-Type; the browser will add the boundary\n  const isForm = typeof FormData !== \"undefined\" && body instanceof FormData;\n\n  const init = {\n    method,\n    headers: {\n      Accept: \"application/json\",\n      ...(isForm ? {} : { \"Content-Type\": \"application/json\" }),\n      ...(token ? { Authorization: `Bearer ${token}` } : {}),\n      ...headers,\n    },\n    ...(withCredentials ? { credentials: \"include\" } : {}),\n    signal: ctrl.signal,\n  };\n\n  if (body != null) {\n    init.body = isForm ? body : JSON.stringify(body);\n  }\n\n  let res;\n  try {\n    res = await fetch(url, init);\n  } catch {\n    clearTimeout(timer);\n    throw new Error(\n      \"Network error: API unreachable. Ensure backend is running, dev proxy is set, or REACT_APP_API_BASE is correct.\"\n    );\n  }\n  clearTimeout(timer);\n\n  // Handle empty responses (e.g., 204 No Content)\n  let data = null;\n  if (res.status !== 204) {\n    try { data = await res.json(); } catch { data = null; }\n  }\n\n  if (!res.ok) {\n    if (res.status === 401 && redirectOn401) {\n      clearToken();\n      if (typeof window !== \"undefined\") window.location.assign(\"/login\");\n    }\n    const msg = (data && (data.message || data.error)) || `HTTP ${res.status}`;\n    throw new Error(msg);\n  }\n\n  return data ?? {};\n}\n\n// Convenience wrappers\nexport const get  = (p, o)          => api(p, { ...o, method: \"GET\" });\nexport const post = (p, body, o)     => api(p, { ...o, method: \"POST\", body });\nexport const put  = (p, body, o)     => api(p, { ...o, method: \"PUT\", body });\nexport const del  = (p, o)           => api(p, { ...o, method: \"DELETE\" });\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}