{"ast":null,"code":"var _jsxFileName = \"/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/src/Components/DirectMessages/DirectMessages.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { api } from '../../utils/api';\nimport './DirectMessages.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst DirectMessages = ({\n  userType\n}) => {\n  _s();\n  var _selectedContact$firs;\n  const [parents, setParents] = useState([]);\n  const [teachers, setTeachers] = useState([]);\n  const [selectedContact, setSelectedContact] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [editId, setEditId] = useState(null);\n  const [editText, setEditText] = useState('');\n  const [showActionsId, setShowActionsId] = useState(null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const chatRef = useRef(null);\n\n  // Fetch current user data\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        var _userData$data;\n        const userData = await api('/auth/me');\n        console.log('User data received:', userData);\n        console.log('User data keys:', Object.keys(userData));\n\n        // Extract user from different possible response formats\n        let user = (userData === null || userData === void 0 ? void 0 : userData.user) || (userData === null || userData === void 0 ? void 0 : (_userData$data = userData.data) === null || _userData$data === void 0 ? void 0 : _userData$data.user) || userData;\n        console.log('Extracted user:', user);\n        console.log('User keys:', Object.keys(user || {}));\n\n        // Handle different ID field names\n        if (user && !user._id) {\n          // Try to find ID in different field names\n          if (user.id) {\n            user._id = user.id;\n          } else if (user.userID) {\n            user._id = user.userID;\n          } else if (user.userId) {\n            user._id = user.userId;\n          } else if (user.ID) {\n            user._id = user.ID;\n          }\n          console.log('User after ID mapping:', user);\n        }\n        if (user && user._id) {\n          setCurrentUser(user);\n          console.log('Current user set successfully:', user);\n        } else {\n          console.error('User data missing _id field. Full user object:', JSON.stringify(user, null, 2));\n        }\n      } catch (err) {\n        console.error('Failed to load user:', err);\n      }\n    };\n    fetchUser();\n  }, []);\n\n  // Fetch list of parents (for teacher view) or teachers (for parent view)\n  useEffect(() => {\n    if (userType === 'teacher' && currentUser) {\n      const fetchParents = async () => {\n        console.log('Fetching parents for teacher. Current user:', currentUser);\n        setLoading(false);\n        try {\n          // Step 1: Get teacher's academic info (grade and class)\n          const teacherAcademicRes = await api(`/academic/${currentUser.userID}`);\n          console.log('Teacher academic response:', teacherAcademicRes);\n          const teacherAcademic = (teacherAcademicRes === null || teacherAcademicRes === void 0 ? void 0 : teacherAcademicRes.academicRecord) || teacherAcademicRes;\n          console.log('Teacher academic info:', teacherAcademic);\n          if (!teacherAcademic || !teacherAcademic.grade || !teacherAcademic.class) {\n            console.log('Teacher has no academic assignment');\n            setParents([]);\n            return;\n          }\n          const teacherGrade = teacherAcademic.grade;\n          const teacherClass = teacherAcademic.class;\n          console.log(`Teacher is assigned to Grade ${teacherGrade}${teacherClass}`);\n\n          // Step 2: Get all parents\n          const parentsRes = await api('/users/role/parent');\n          const allParents = (parentsRes === null || parentsRes === void 0 ? void 0 : parentsRes.users) || parentsRes || [];\n          console.log('All parents:', allParents);\n          if (allParents.length === 0) {\n            console.log('No parents found in system');\n            setParents([]);\n            return;\n          }\n\n          // Step 3: Get academic info for all parents\n          const parentsWithAcademic = await Promise.all(allParents.map(async parent => {\n            try {\n              var _parent$fullName, _parent$fullName2;\n              const academicRes = await api(`/academic/${parent.userID}`);\n              const academicInfo = (academicRes === null || academicRes === void 0 ? void 0 : academicRes.academicRecord) || academicRes;\n              if (!academicInfo || !academicInfo.grade || !academicInfo.class) {\n                console.log(`No valid academic info for parent ${parent.userID}`);\n                return null;\n              }\n              return {\n                ...parent,\n                _id: parent.userID,\n                // Use userID as _id for consistency\n                firstName: ((_parent$fullName = parent.fullName) === null || _parent$fullName === void 0 ? void 0 : _parent$fullName.split(' ')[0]) || parent.fullName,\n                lastName: ((_parent$fullName2 = parent.fullName) === null || _parent$fullName2 === void 0 ? void 0 : _parent$fullName2.split(' ').slice(1).join(' ')) || '',\n                grade: academicInfo.grade,\n                class: academicInfo.class\n              };\n            } catch (err) {\n              console.log(`Error fetching academic info for parent ${parent.userID}:`, err);\n              return null;\n            }\n          }));\n\n          // Filter out null values (parents without academic info)\n          const validParents = parentsWithAcademic.filter(p => p !== null);\n          console.log('Parents with academic info:', validParents);\n\n          // Step 4: Filter parents by matching grade and class\n          const matchingParents = validParents.filter(p => {\n            const matches = p.grade === teacherGrade && p.class === teacherClass;\n            console.log(`Parent ${p.userID} (Grade ${p.grade}${p.class}): ${matches ? 'MATCH' : 'no match'}`);\n            return matches;\n          });\n          console.log('Matching parents:', matchingParents);\n          setParents(matchingParents);\n        } catch (err) {\n          console.error('Failed to load parents:', err);\n          setParents([]);\n        }\n      };\n      fetchParents();\n    } else if (userType === 'parent' && currentUser) {\n      // For parents, fetch their child's class teacher based on Academic table\n      const fetchTeachers = async () => {\n        console.log('Fetching teachers for parent. Current user:', currentUser);\n        setLoading(false);\n        try {\n          // Step 1: Get parent's academic info (grade and class)\n          const parentAcademicRes = await api(`/academic/${currentUser.userID}`);\n          console.log('Parent academic response:', parentAcademicRes);\n          const parentAcademic = (parentAcademicRes === null || parentAcademicRes === void 0 ? void 0 : parentAcademicRes.academicRecord) || parentAcademicRes;\n          console.log('Parent academic info:', parentAcademic);\n          if (!parentAcademic || !parentAcademic.grade || !parentAcademic.class) {\n            console.log('Parent has no academic assignment');\n            setTeachers([]);\n            return;\n          }\n          const parentGrade = parentAcademic.grade;\n          const parentClass = parentAcademic.class;\n          console.log(`Parent is in Grade ${parentGrade}${parentClass}`);\n\n          // Step 2: Get all teachers\n          const teachersRes = await api(`/users/role/teacher`);\n          const allTeachers = (teachersRes === null || teachersRes === void 0 ? void 0 : teachersRes.users) || teachersRes || [];\n          console.log('All teachers:', allTeachers);\n          if (allTeachers.length === 0) {\n            console.log('No teachers found in system');\n            setTeachers([]);\n            return;\n          }\n\n          // Step 3: Get academic info for all teachers\n          const teachersWithAcademic = await Promise.all(allTeachers.map(async teacher => {\n            try {\n              var _teacher$fullName, _teacher$fullName2;\n              const academicRes = await api(`/academic/${teacher.userID}`);\n              const academicInfo = (academicRes === null || academicRes === void 0 ? void 0 : academicRes.academicRecord) || academicRes;\n              if (!academicInfo || !academicInfo.grade || !academicInfo.class) {\n                console.log(`No valid academic info for teacher ${teacher.userID}`);\n                return null;\n              }\n              return {\n                ...teacher,\n                _id: teacher.userID,\n                // Use userID as _id for consistency\n                firstName: ((_teacher$fullName = teacher.fullName) === null || _teacher$fullName === void 0 ? void 0 : _teacher$fullName.split(' ')[0]) || teacher.fullName,\n                lastName: ((_teacher$fullName2 = teacher.fullName) === null || _teacher$fullName2 === void 0 ? void 0 : _teacher$fullName2.split(' ').slice(1).join(' ')) || '',\n                grade: academicInfo.grade,\n                class: academicInfo.class\n              };\n            } catch (err) {\n              console.log(`Error fetching academic info for teacher ${teacher.userID}:`, err);\n              return null; // Don't include teachers without academic info\n            }\n          }));\n\n          // Filter out null values (teachers without academic info)\n          const validTeachers = teachersWithAcademic.filter(t => t !== null);\n          console.log('Teachers with academic info:', validTeachers);\n\n          // Step 4: Filter teachers by matching grade and class\n          const matchingTeachers = validTeachers.filter(t => {\n            const matches = t.grade === parentGrade && t.class === parentClass;\n            console.log(`Teacher ${t.userID} (Grade ${t.grade}${t.class}): ${matches ? 'MATCH' : 'no match'}`);\n            return matches;\n          });\n          console.log('Matching teachers:', matchingTeachers);\n          setTeachers(matchingTeachers);\n        } catch (err) {\n          console.error('Failed to load teachers:', err);\n          setTeachers([]);\n        }\n      };\n      fetchTeachers();\n    } else if (currentUser) {\n      setLoading(false);\n    }\n  }, [userType, currentUser]);\n\n  // Helper to determine message side based on sender\n  const getMessageSide = senderId => {\n    if (!currentUser) return 'left';\n    return senderId === currentUser._id ? 'right' : 'left';\n  };\n\n  // Helper to check edit/delete time limits\n  function canEditMessage(msg) {\n    const now = Date.now();\n    const sent = new Date(msg.sentAt || msg.createdAt).getTime();\n    return now - sent <= 10 * 60 * 1000; // 10 minutes\n  }\n  function canDeleteMessage(msg) {\n    const now = Date.now();\n    const sent = new Date(msg.sentAt || msg.createdAt).getTime();\n    return now - sent <= 24 * 60 * 60 * 1000; // 24 hours\n  }\n\n  // Show hover actions/drop menu only within 2 hours of sending\n  function canShowActionsMenu(msg) {\n    const now = Date.now();\n    const sent = new Date(msg.sentAt || msg.createdAt).getTime();\n    return now - sent <= 2 * 60 * 60 * 1000; // 2 hours\n  }\n\n  // Format date for display\n  function formatDate(dateStr) {\n    const d = new Date(dateStr);\n    const today = new Date();\n    if (d.toDateString() === today.toDateString()) {\n      return 'Today';\n    }\n    return d.toLocaleDateString(undefined, {\n      weekday: 'long',\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  }\n  // Format time for display\n  function formatTime(dateStr) {\n    const d = new Date(dateStr);\n    return d.toLocaleTimeString(undefined, {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  }\n\n  // Fetch messages when a contact is selected\n  useEffect(() => {\n    if (selectedContact && currentUser && currentUser._id) {\n      const fetchMessages = async () => {\n        try {\n          console.log('Fetching messages between:', currentUser._id, 'and', selectedContact._id);\n          // Use the simpler endpoint that works with fromUserId/toUserId\n          const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n          console.log('Messages received:', res.data);\n          setMessages(res.data.messages || res.data || []);\n        } catch (err) {\n          console.error('Failed to load messages:', err);\n          setMessages([]);\n        }\n      };\n      fetchMessages();\n    }\n  }, [selectedContact, currentUser]);\n\n  // Scroll chat to bottom when messages change\n  useEffect(() => {\n    if (chatRef.current) {\n      chatRef.current.scrollTop = chatRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  // Send message to backend\n  const handleSend = async () => {\n    if (input.trim() === '') {\n      alert('Please enter a message');\n      return;\n    }\n    if (!currentUser || !currentUser._id) {\n      alert('User not loaded. Please refresh the page.');\n      console.error('currentUser not loaded:', currentUser);\n      return;\n    }\n    if (!selectedContact || !selectedContact._id) {\n      alert('No contact selected');\n      return;\n    }\n    try {\n      // Build classId from grade and class (e.g., \"3B\")\n      const classId = selectedContact.grade && selectedContact.class ? `${selectedContact.grade}${selectedContact.class}` : 'default';\n      console.log('Sending message:', {\n        fromUserId: currentUser._id,\n        toUserId: selectedContact._id,\n        classId: classId,\n        messageContent: input\n      });\n      const response = await axios.post('/chat', {\n        fromUserId: currentUser._id,\n        toUserId: selectedContact._id,\n        classId: classId,\n        messageContent: input\n      });\n      console.log('Message sent successfully:', response.data);\n\n      // Refresh messages\n      const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n      setMessages(res.data.messages || res.data || []);\n      setInput('');\n    } catch (err) {\n      var _err$response, _err$response2, _err$response2$data;\n      console.error('Failed to send message:', err);\n      console.error('Error details:', (_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.data);\n      alert(`Failed to send message: ${((_err$response2 = err.response) === null || _err$response2 === void 0 ? void 0 : (_err$response2$data = _err$response2.data) === null || _err$response2$data === void 0 ? void 0 : _err$response2$data.message) || err.message}`);\n    }\n  };\n\n  // Edit message\n  const handleEditSave = async id => {\n    if (!selectedContact || !currentUser) return;\n    try {\n      await axios.put(`/chat/${id}`, {\n        messageContent: editText\n      });\n      const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n      setMessages(res.data.messages || res.data || []);\n      setEditId(null);\n      setEditText('');\n    } catch (err) {\n      console.error('Failed to edit message:', err);\n    }\n  };\n\n  // Delete message\n  const handleDelete = async id => {\n    if (!selectedContact || !currentUser) return;\n    try {\n      await axios.delete(`/chat/${id}`);\n      const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n      setMessages(res.data.messages || res.data || []);\n    } catch (err) {\n      console.error('Failed to delete message:', err);\n    }\n  };\n\n  // Filter contacts based on search query\n  const contactList = userType === 'teacher' ? parents : teachers;\n  console.log('Contact list:', contactList, 'userType:', userType, 'parents:', parents, 'teachers:', teachers);\n  const filteredContacts = contactList.filter(contact => {\n    const query = searchQuery.toLowerCase();\n    const name = `${contact.firstName || ''} ${contact.lastName || ''}`.toLowerCase();\n    const userId = (contact.userId || contact._id || '').toLowerCase();\n    return name.includes(query) || userId.includes(query);\n  });\n  console.log('Filtered contacts:', filteredContacts);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"container\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"section-title\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Direct Messages\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 390,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Chat securely between teachers and parents\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 389,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"dm-whatsapp-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"dm-sidebar\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dm-search-bar\",\n          children: /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            placeholder: \"Search by name or user ID...\",\n            value: searchQuery,\n            onChange: e => setSearchQuery(e.target.value),\n            className: \"dm-search-input\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 397,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 396,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dm-parent-list\",\n          children: loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"dm-no-parents\",\n            children: \"Loading...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 407,\n            columnNumber: 15\n          }, this) : filteredContacts.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n            className: \"dm-no-parents\",\n            children: userType === 'teacher' ? 'No parents found' : 'No teachers found'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 15\n          }, this) : filteredContacts.map(contact => {\n            var _contact$firstName;\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `dm-parent-item ${(selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact._id) === contact._id ? 'active' : ''}`,\n              onClick: () => setSelectedContact(contact),\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"dm-parent-avatar\",\n                children: (((_contact$firstName = contact.firstName) === null || _contact$firstName === void 0 ? void 0 : _contact$firstName[0]) || (userType === 'teacher' ? 'P' : 'T')).toUpperCase()\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 419,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"dm-parent-info\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"dm-parent-name\",\n                  children: [contact.firstName || (userType === 'teacher' ? 'Parent' : 'Teacher'), \" \", contact.lastName || '']\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 423,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"dm-parent-id\",\n                  children: [\"ID: \", contact.userID || contact.userId || contact._id]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 426,\n                  columnNumber: 21\n                }, this), contact.grade && contact.class && /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"dm-parent-class\",\n                  children: [\"Grade \", contact.grade, contact.class]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 428,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 422,\n                columnNumber: 19\n              }, this)]\n            }, contact._id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 414,\n              columnNumber: 17\n            }, this);\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 405,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"dm-chat-area\",\n        children: !selectedContact ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"dm-no-chat-selected\",\n          children: [/*#__PURE__*/_jsxDEV(\"i\", {\n            className: \"fas fa-comments\",\n            style: {\n              fontSize: '4rem',\n              color: '#ccc',\n              marginBottom: '1rem'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: userType === 'teacher' ? 'Select a parent to start chatting' : 'Select your class teacher to start chatting'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 442,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dm-chat-header\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"dm-parent-avatar\",\n              children: (((_selectedContact$firs = selectedContact.firstName) === null || _selectedContact$firs === void 0 ? void 0 : _selectedContact$firs[0]) || (userType === 'teacher' ? 'P' : 'T')).toUpperCase()\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 448,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"dm-header-info\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"dm-header-name\",\n                children: [selectedContact.firstName || (userType === 'teacher' ? 'Parent' : 'Teacher'), \" \", selectedContact.lastName || '']\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 452,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"dm-header-id\",\n                children: [\"ID: \", selectedContact.userID || selectedContact.userId || selectedContact._id]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 455,\n                columnNumber: 19\n              }, this), selectedContact.grade && selectedContact.class && /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"dm-header-class\",\n                children: [\"Grade \", selectedContact.grade, selectedContact.class]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 451,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 447,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dm-chat\",\n            ref: chatRef,\n            children: (() => {\n              let lastDate = null;\n              return messages.map((m, i) => {\n                const msgDate = new Date(m.sentAt || m.createdAt).toDateString();\n                const showDate = lastDate !== msgDate;\n                lastDate = msgDate;\n                return /*#__PURE__*/_jsxDEV(React.Fragment, {\n                  children: [showDate && /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: \"dm-date-separator\",\n                    children: formatDate(m.sentAt || m.createdAt)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 473,\n                    columnNumber: 21\n                  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                    className: `dm-message-bubble ${getMessageSide(m.fromUserId)}`,\n                    style: {\n                      alignSelf: getMessageSide(m.fromUserId) === 'right' ? 'flex-end' : 'flex-start'\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                      className: \"dm-message-meta\",\n                      style: {\n                        position: 'relative',\n                        display: 'flex',\n                        flexDirection: 'row',\n                        alignItems: 'center',\n                        gap: '6px'\n                      },\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"dm-sender\",\n                        children: getMessageSide(m.fromUserId) === 'right' ? 'You' : (selectedContact === null || selectedContact === void 0 ? void 0 : selectedContact.firstName) || (userType === 'teacher' ? 'Parent' : 'Teacher')\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 480,\n                        columnNumber: 25\n                      }, this), currentUser && m.fromUserId === currentUser._id && canShowActionsMenu(m) && /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"dm-more-btn\",\n                        style: {\n                          background: 'none',\n                          border: 'none',\n                          color: '#1976d2',\n                          fontSize: '1em',\n                          cursor: 'pointer',\n                          padding: 0,\n                          display: 'none',\n                          verticalAlign: 'middle'\n                        },\n                        onClick: () => setShowActionsId(showActionsId === m._id ? null : m._id),\n                        \"aria-label\": \"Show actions\",\n                        children: \"\\u02C5\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 484,\n                        columnNumber: 25\n                      }, this)]\n                    }, void 0, true, {\n                      fileName: _jsxFileName,\n                      lineNumber: 479,\n                      columnNumber: 21\n                    }, this), editId === m._id ? /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n                        value: editText,\n                        onChange: e => setEditText(e.target.value)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 494,\n                        columnNumber: 25\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"btn-primary\",\n                        onClick: () => handleEditSave(m._id),\n                        children: \"Save\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 495,\n                        columnNumber: 25\n                      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                        className: \"btn-primary\",\n                        onClick: () => setEditId(null),\n                        children: \"Cancel\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 496,\n                        columnNumber: 25\n                      }, this)]\n                    }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n                      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"dm-text\",\n                        children: m.messageContent\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 500,\n                        columnNumber: 25\n                      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                        className: \"dm-time\",\n                        style: {\n                          display: 'block',\n                          marginTop: 2,\n                          textAlign: 'right',\n                          color: '#888',\n                          fontSize: '0.95em'\n                        },\n                        children: formatTime(m.sentAt || m.createdAt)\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 501,\n                        columnNumber: 25\n                      }, this), currentUser && m.fromUserId === currentUser._id && canShowActionsMenu(m) && showActionsId === m._id && /*#__PURE__*/_jsxDEV(\"div\", {\n                        className: \"dm-actions-hover\",\n                        style: {\n                          width: '100%',\n                          display: 'flex',\n                          flexDirection: 'row',\n                          justifyContent: 'center',\n                          gap: '8px',\n                          marginTop: 8\n                        },\n                        children: [canEditMessage(m) && /*#__PURE__*/_jsxDEV(\"button\", {\n                          className: \"btn-primary dm-edit\",\n                          onClick: () => {\n                            setEditId(m._id);\n                            setEditText(m.messageContent);\n                            setShowActionsId(null);\n                          },\n                          children: \"Edit\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 507,\n                          columnNumber: 51\n                        }, this), canDeleteMessage(m) && /*#__PURE__*/_jsxDEV(\"button\", {\n                          className: \"btn-primary dm-delete\",\n                          onClick: () => {\n                            handleDelete(m._id);\n                            setShowActionsId(null);\n                          },\n                          children: \"Delete\"\n                        }, void 0, false, {\n                          fileName: _jsxFileName,\n                          lineNumber: 508,\n                          columnNumber: 53\n                        }, this)]\n                      }, void 0, true, {\n                        fileName: _jsxFileName,\n                        lineNumber: 503,\n                        columnNumber: 27\n                      }, this)]\n                    }, void 0, true)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 475,\n                    columnNumber: 19\n                  }, this)]\n                }, m._id, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 471,\n                  columnNumber: 17\n                }, this);\n              });\n            })()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 463,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"dm-input-row\",\n            children: [/*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              value: input,\n              onChange: e => setInput(e.target.value),\n              placeholder: \"Type your message...\",\n              onKeyDown: e => {\n                if (e.key === 'Enter') handleSend();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 522,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"btn-primary\",\n              onClick: handleSend,\n              children: \"Send\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 529,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 521,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 388,\n    columnNumber: 5\n  }, this);\n};\n_s(DirectMessages, \"eIXsPINRnRx/9r+gI4i8VIKiyRM=\");\n_c = DirectMessages;\nexport default DirectMessages;\nvar _c;\n$RefreshReg$(_c, \"DirectMessages\");","map":{"version":3,"names":["React","useState","useEffect","useRef","axios","api","jsxDEV","_jsxDEV","Fragment","_Fragment","DirectMessages","userType","_s","_selectedContact$firs","parents","setParents","teachers","setTeachers","selectedContact","setSelectedContact","messages","setMessages","input","setInput","searchQuery","setSearchQuery","editId","setEditId","editText","setEditText","showActionsId","setShowActionsId","currentUser","setCurrentUser","loading","setLoading","chatRef","fetchUser","_userData$data","userData","console","log","Object","keys","user","data","_id","id","userID","userId","ID","error","JSON","stringify","err","fetchParents","teacherAcademicRes","teacherAcademic","academicRecord","grade","class","teacherGrade","teacherClass","parentsRes","allParents","users","length","parentsWithAcademic","Promise","all","map","parent","_parent$fullName","_parent$fullName2","academicRes","academicInfo","firstName","fullName","split","lastName","slice","join","validParents","filter","p","matchingParents","matches","fetchTeachers","parentAcademicRes","parentAcademic","parentGrade","parentClass","teachersRes","allTeachers","teachersWithAcademic","teacher","_teacher$fullName","_teacher$fullName2","validTeachers","t","matchingTeachers","getMessageSide","senderId","canEditMessage","msg","now","Date","sent","sentAt","createdAt","getTime","canDeleteMessage","canShowActionsMenu","formatDate","dateStr","d","today","toDateString","toLocaleDateString","undefined","weekday","year","month","day","formatTime","toLocaleTimeString","hour","minute","fetchMessages","res","get","current","scrollTop","scrollHeight","handleSend","trim","alert","classId","fromUserId","toUserId","messageContent","response","post","_err$response","_err$response2","_err$response2$data","message","handleEditSave","put","handleDelete","delete","contactList","filteredContacts","contact","query","toLowerCase","name","includes","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","placeholder","value","onChange","e","target","_contact$firstName","onClick","toUpperCase","style","fontSize","color","marginBottom","ref","lastDate","m","i","msgDate","showDate","alignSelf","position","display","flexDirection","alignItems","gap","background","border","cursor","padding","verticalAlign","marginTop","textAlign","width","justifyContent","onKeyDown","key","_c","$RefreshReg$"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/src/Components/DirectMessages/DirectMessages.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport axios from 'axios';\nimport { api } from '../../utils/api';\nimport './DirectMessages.css';\n\nconst DirectMessages = ({ userType }) => {\n  const [parents, setParents] = useState([]);\n  const [teachers, setTeachers] = useState([]);\n  const [selectedContact, setSelectedContact] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [searchQuery, setSearchQuery] = useState('');\n  const [editId, setEditId] = useState(null);\n  const [editText, setEditText] = useState('');\n  const [showActionsId, setShowActionsId] = useState(null);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const chatRef = useRef(null);\n\n  // Fetch current user data\n  useEffect(() => {\n    const fetchUser = async () => {\n      try {\n        const userData = await api('/auth/me');\n        console.log('User data received:', userData);\n        console.log('User data keys:', Object.keys(userData));\n        \n        // Extract user from different possible response formats\n        let user = userData?.user || userData?.data?.user || userData;\n        console.log('Extracted user:', user);\n        console.log('User keys:', Object.keys(user || {}));\n        \n        // Handle different ID field names\n        if (user && !user._id) {\n          // Try to find ID in different field names\n          if (user.id) {\n            user._id = user.id;\n          } else if (user.userID) {\n            user._id = user.userID;\n          } else if (user.userId) {\n            user._id = user.userId;\n          } else if (user.ID) {\n            user._id = user.ID;\n          }\n          console.log('User after ID mapping:', user);\n        }\n        \n        if (user && user._id) {\n          setCurrentUser(user);\n          console.log('Current user set successfully:', user);\n        } else {\n          console.error('User data missing _id field. Full user object:', JSON.stringify(user, null, 2));\n        }\n      } catch (err) {\n        console.error('Failed to load user:', err);\n      }\n    };\n    fetchUser();\n  }, []);\n\n  // Fetch list of parents (for teacher view) or teachers (for parent view)\n  useEffect(() => {\n    if (userType === 'teacher' && currentUser) {\n      const fetchParents = async () => {\n        console.log('Fetching parents for teacher. Current user:', currentUser);\n        setLoading(false);\n        \n        try {\n          // Step 1: Get teacher's academic info (grade and class)\n          const teacherAcademicRes = await api(`/academic/${currentUser.userID}`);\n          console.log('Teacher academic response:', teacherAcademicRes);\n          \n          const teacherAcademic = teacherAcademicRes?.academicRecord || teacherAcademicRes;\n          console.log('Teacher academic info:', teacherAcademic);\n          \n          if (!teacherAcademic || !teacherAcademic.grade || !teacherAcademic.class) {\n            console.log('Teacher has no academic assignment');\n            setParents([]);\n            return;\n          }\n          \n          const teacherGrade = teacherAcademic.grade;\n          const teacherClass = teacherAcademic.class;\n          console.log(`Teacher is assigned to Grade ${teacherGrade}${teacherClass}`);\n          \n          // Step 2: Get all parents\n          const parentsRes = await api('/users/role/parent');\n          const allParents = parentsRes?.users || parentsRes || [];\n          console.log('All parents:', allParents);\n          \n          if (allParents.length === 0) {\n            console.log('No parents found in system');\n            setParents([]);\n            return;\n          }\n          \n          // Step 3: Get academic info for all parents\n          const parentsWithAcademic = await Promise.all(\n            allParents.map(async (parent) => {\n              try {\n                const academicRes = await api(`/academic/${parent.userID}`);\n                const academicInfo = academicRes?.academicRecord || academicRes;\n                \n                if (!academicInfo || !academicInfo.grade || !academicInfo.class) {\n                  console.log(`No valid academic info for parent ${parent.userID}`);\n                  return null;\n                }\n                \n                return {\n                  ...parent,\n                  _id: parent.userID, // Use userID as _id for consistency\n                  firstName: parent.fullName?.split(' ')[0] || parent.fullName,\n                  lastName: parent.fullName?.split(' ').slice(1).join(' ') || '',\n                  grade: academicInfo.grade,\n                  class: academicInfo.class\n                };\n              } catch (err) {\n                console.log(`Error fetching academic info for parent ${parent.userID}:`, err);\n                return null;\n              }\n            })\n          );\n          \n          // Filter out null values (parents without academic info)\n          const validParents = parentsWithAcademic.filter(p => p !== null);\n          console.log('Parents with academic info:', validParents);\n          \n          // Step 4: Filter parents by matching grade and class\n          const matchingParents = validParents.filter(p => {\n            const matches = p.grade === teacherGrade && p.class === teacherClass;\n            console.log(`Parent ${p.userID} (Grade ${p.grade}${p.class}): ${matches ? 'MATCH' : 'no match'}`);\n            return matches;\n          });\n          \n          console.log('Matching parents:', matchingParents);\n          setParents(matchingParents);\n          \n        } catch (err) {\n          console.error('Failed to load parents:', err);\n          setParents([]);\n        }\n      };\n      fetchParents();\n    } else if (userType === 'parent' && currentUser) {\n      // For parents, fetch their child's class teacher based on Academic table\n      const fetchTeachers = async () => {\n        console.log('Fetching teachers for parent. Current user:', currentUser);\n        setLoading(false);\n        \n        try {\n          // Step 1: Get parent's academic info (grade and class)\n          const parentAcademicRes = await api(`/academic/${currentUser.userID}`);\n          console.log('Parent academic response:', parentAcademicRes);\n          \n          const parentAcademic = parentAcademicRes?.academicRecord || parentAcademicRes;\n          console.log('Parent academic info:', parentAcademic);\n          \n          if (!parentAcademic || !parentAcademic.grade || !parentAcademic.class) {\n            console.log('Parent has no academic assignment');\n            setTeachers([]);\n            return;\n          }\n          \n          const parentGrade = parentAcademic.grade;\n          const parentClass = parentAcademic.class;\n          console.log(`Parent is in Grade ${parentGrade}${parentClass}`);\n          \n          // Step 2: Get all teachers\n          const teachersRes = await api(`/users/role/teacher`);\n          const allTeachers = teachersRes?.users || teachersRes || [];\n          console.log('All teachers:', allTeachers);\n          \n          if (allTeachers.length === 0) {\n            console.log('No teachers found in system');\n            setTeachers([]);\n            return;\n          }\n          \n          // Step 3: Get academic info for all teachers\n          const teachersWithAcademic = await Promise.all(\n            allTeachers.map(async (teacher) => {\n              try {\n                const academicRes = await api(`/academic/${teacher.userID}`);\n                const academicInfo = academicRes?.academicRecord || academicRes;\n                \n                if (!academicInfo || !academicInfo.grade || !academicInfo.class) {\n                  console.log(`No valid academic info for teacher ${teacher.userID}`);\n                  return null;\n                }\n                \n                return {\n                  ...teacher,\n                  _id: teacher.userID, // Use userID as _id for consistency\n                  firstName: teacher.fullName?.split(' ')[0] || teacher.fullName,\n                  lastName: teacher.fullName?.split(' ').slice(1).join(' ') || '',\n                  grade: academicInfo.grade,\n                  class: academicInfo.class\n                };\n              } catch (err) {\n                console.log(`Error fetching academic info for teacher ${teacher.userID}:`, err);\n                return null; // Don't include teachers without academic info\n              }\n            })\n          );\n          \n          // Filter out null values (teachers without academic info)\n          const validTeachers = teachersWithAcademic.filter(t => t !== null);\n          console.log('Teachers with academic info:', validTeachers);\n          \n          // Step 4: Filter teachers by matching grade and class\n          const matchingTeachers = validTeachers.filter(t => {\n            const matches = t.grade === parentGrade && t.class === parentClass;\n            console.log(`Teacher ${t.userID} (Grade ${t.grade}${t.class}): ${matches ? 'MATCH' : 'no match'}`);\n            return matches;\n          });\n          \n          console.log('Matching teachers:', matchingTeachers);\n          setTeachers(matchingTeachers);\n          \n        } catch (err) {\n          console.error('Failed to load teachers:', err);\n          setTeachers([]);\n        }\n      };\n      fetchTeachers();\n    } else if (currentUser) {\n      setLoading(false);\n    }\n  }, [userType, currentUser]);\n\n  // Helper to determine message side based on sender\n  const getMessageSide = (senderId) => {\n    if (!currentUser) return 'left';\n    return senderId === currentUser._id ? 'right' : 'left';\n  };\n\n  // Helper to check edit/delete time limits\n  function canEditMessage(msg) {\n    const now = Date.now();\n    const sent = new Date(msg.sentAt || msg.createdAt).getTime();\n    return (now - sent) <= 10 * 60 * 1000; // 10 minutes\n  }\n  function canDeleteMessage(msg) {\n    const now = Date.now();\n    const sent = new Date(msg.sentAt || msg.createdAt).getTime();\n    return (now - sent) <= 24 * 60 * 60 * 1000; // 24 hours\n  }\n\n  // Show hover actions/drop menu only within 2 hours of sending\n  function canShowActionsMenu(msg) {\n    const now = Date.now();\n    const sent = new Date(msg.sentAt || msg.createdAt).getTime();\n    return (now - sent) <= 2 * 60 * 60 * 1000; // 2 hours\n  }\n\n  // Format date for display\n  function formatDate(dateStr) {\n    const d = new Date(dateStr);\n    const today = new Date();\n    if (d.toDateString() === today.toDateString()) {\n      return 'Today';\n    }\n    return d.toLocaleDateString(undefined, { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });\n  }\n  // Format time for display\n  function formatTime(dateStr) {\n    const d = new Date(dateStr);\n    return d.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });\n  }\n\n  // Fetch messages when a contact is selected\n  useEffect(() => {\n    if (selectedContact && currentUser && currentUser._id) {\n      const fetchMessages = async () => {\n        try {\n          console.log('Fetching messages between:', currentUser._id, 'and', selectedContact._id);\n          // Use the simpler endpoint that works with fromUserId/toUserId\n          const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n          console.log('Messages received:', res.data);\n          setMessages(res.data.messages || res.data || []);\n        } catch (err) {\n          console.error('Failed to load messages:', err);\n          setMessages([]);\n        }\n      };\n      fetchMessages();\n    }\n  }, [selectedContact, currentUser]);\n\n  // Scroll chat to bottom when messages change\n  useEffect(() => {\n    if (chatRef.current) {\n      chatRef.current.scrollTop = chatRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  // Send message to backend\n  const handleSend = async () => {\n    if (input.trim() === '') {\n      alert('Please enter a message');\n      return;\n    }\n    \n    if (!currentUser || !currentUser._id) {\n      alert('User not loaded. Please refresh the page.');\n      console.error('currentUser not loaded:', currentUser);\n      return;\n    }\n    \n    if (!selectedContact || !selectedContact._id) {\n      alert('No contact selected');\n      return;\n    }\n    \n    try {\n      // Build classId from grade and class (e.g., \"3B\")\n      const classId = selectedContact.grade && selectedContact.class \n        ? `${selectedContact.grade}${selectedContact.class}` \n        : 'default';\n      \n      console.log('Sending message:', {\n        fromUserId: currentUser._id,\n        toUserId: selectedContact._id,\n        classId: classId,\n        messageContent: input\n      });\n      \n      const response = await axios.post('/chat', {\n        fromUserId: currentUser._id,\n        toUserId: selectedContact._id,\n        classId: classId,\n        messageContent: input\n      });\n      \n      console.log('Message sent successfully:', response.data);\n      \n      // Refresh messages\n      const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n      setMessages(res.data.messages || res.data || []);\n      setInput('');\n    } catch (err) {\n      console.error('Failed to send message:', err);\n      console.error('Error details:', err.response?.data);\n      alert(`Failed to send message: ${err.response?.data?.message || err.message}`);\n    }\n  };\n\n  // Edit message\n  const handleEditSave = async (id) => {\n    if (!selectedContact || !currentUser) return;\n    try {\n      await axios.put(`/chat/${id}`, { messageContent: editText });\n      const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n      setMessages(res.data.messages || res.data || []);\n      setEditId(null);\n      setEditText('');\n    } catch (err) {\n      console.error('Failed to edit message:', err);\n    }\n  };\n\n  // Delete message\n  const handleDelete = async (id) => {\n    if (!selectedContact || !currentUser) return;\n    try {\n      await axios.delete(`/chat/${id}`);\n      const res = await axios.get(`/chat/${currentUser._id}/${selectedContact._id}`);\n      setMessages(res.data.messages || res.data || []);\n    } catch (err) {\n      console.error('Failed to delete message:', err);\n    }\n  };\n\n  // Filter contacts based on search query\n  const contactList = userType === 'teacher' ? parents : teachers;\n  console.log('Contact list:', contactList, 'userType:', userType, 'parents:', parents, 'teachers:', teachers);\n  \n  const filteredContacts = contactList.filter(contact => {\n    const query = searchQuery.toLowerCase();\n    const name = `${contact.firstName || ''} ${contact.lastName || ''}`.toLowerCase();\n    const userId = (contact.userId || contact._id || '').toLowerCase();\n    return name.includes(query) || userId.includes(query);\n  });\n  \n  console.log('Filtered contacts:', filteredContacts);\n\n  return (\n    <div className=\"container\">\n      <div className=\"section-title\">\n        <h2>Direct Messages</h2>\n        <p>Chat securely between teachers and parents</p>\n      </div>\n      <div className=\"dm-whatsapp-container\">\n        {/* Left sidebar - Contact list (Parents for teachers, Teachers for parents) */}\n        <div className=\"dm-sidebar\">\n          <div className=\"dm-search-bar\">\n            <input\n              type=\"text\"\n              placeholder=\"Search by name or user ID...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              className=\"dm-search-input\"\n            />\n          </div>\n          <div className=\"dm-parent-list\">\n            {loading ? (\n              <p className=\"dm-no-parents\">Loading...</p>\n            ) : filteredContacts.length === 0 ? (\n              <p className=\"dm-no-parents\">\n                {userType === 'teacher' ? 'No parents found' : 'No teachers found'}\n              </p>\n            ) : (\n              filteredContacts.map(contact => (\n                <div\n                  key={contact._id}\n                  className={`dm-parent-item ${selectedContact?._id === contact._id ? 'active' : ''}`}\n                  onClick={() => setSelectedContact(contact)}\n                >\n                  <div className=\"dm-parent-avatar\">\n                    {(contact.firstName?.[0] || (userType === 'teacher' ? 'P' : 'T')).toUpperCase()}\n                  </div>\n                  <div className=\"dm-parent-info\">\n                    <div className=\"dm-parent-name\">\n                      {contact.firstName || (userType === 'teacher' ? 'Parent' : 'Teacher')} {contact.lastName || ''}\n                    </div>\n                    <div className=\"dm-parent-id\">ID: {contact.userID || contact.userId || contact._id}</div>\n                    {(contact.grade && contact.class) && (\n                      <div className=\"dm-parent-class\">Grade {contact.grade}{contact.class}</div>\n                    )}\n                  </div>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n\n        {/* Right side - Chat area */}\n        <div className=\"dm-chat-area\">\n          {!selectedContact ? (\n            <div className=\"dm-no-chat-selected\">\n              <i className=\"fas fa-comments\" style={{ fontSize: '4rem', color: '#ccc', marginBottom: '1rem' }}></i>\n              <p>{userType === 'teacher' ? 'Select a parent to start chatting' : 'Select your class teacher to start chatting'}</p>\n            </div>\n          ) : (\n            <>\n              {/* Chat header */}\n              <div className=\"dm-chat-header\">\n                <div className=\"dm-parent-avatar\">\n                  {(selectedContact.firstName?.[0] || (userType === 'teacher' ? 'P' : 'T')).toUpperCase()}\n                </div>\n                <div className=\"dm-header-info\">\n                  <div className=\"dm-header-name\">\n                    {selectedContact.firstName || (userType === 'teacher' ? 'Parent' : 'Teacher')} {selectedContact.lastName || ''}\n                  </div>\n                  <div className=\"dm-header-id\">ID: {selectedContact.userID || selectedContact.userId || selectedContact._id}</div>\n                  {(selectedContact.grade && selectedContact.class) && (\n                    <div className=\"dm-header-class\">Grade {selectedContact.grade}{selectedContact.class}</div>\n                  )}\n                </div>\n              </div>\n\n              {/* Chat messages */}\n              <div className=\"dm-chat\" ref={chatRef}>\n          {(() => {\n            let lastDate = null;\n            return messages.map((m, i) => {\n              const msgDate = new Date(m.sentAt || m.createdAt).toDateString();\n              const showDate = lastDate !== msgDate;\n              lastDate = msgDate;\n              return (\n                <React.Fragment key={m._id}>\n                  {showDate && (\n                    <div className=\"dm-date-separator\">{formatDate(m.sentAt || m.createdAt)}</div>\n                  )}\n                  <div\n                    className={`dm-message-bubble ${getMessageSide(m.fromUserId)}`}\n                    style={{ alignSelf: getMessageSide(m.fromUserId) === 'right' ? 'flex-end' : 'flex-start' }}\n                  >\n                    <div className=\"dm-message-meta\" style={{ position: 'relative', display: 'flex', flexDirection: 'row', alignItems: 'center', gap: '6px' }}>\n                        <span className=\"dm-sender\">\n                        {getMessageSide(m.fromUserId) === 'right' ? 'You' : selectedContact?.firstName || (userType === 'teacher' ? 'Parent' : 'Teacher')}\n                      </span>\n                      {currentUser && m.fromUserId === currentUser._id && canShowActionsMenu(m) && (\n                        <button\n                          className=\"dm-more-btn\"\n                          style={{ background: 'none', border: 'none', color: '#1976d2', fontSize: '1em', cursor: 'pointer', padding: 0, display: 'none', verticalAlign: 'middle' }}\n                          onClick={() => setShowActionsId(showActionsId === m._id ? null : m._id)}\n                          aria-label=\"Show actions\"\n                        >&#709;</button>\n                      )}\n                    </div>\n                    {editId === m._id ? (\n                      <>\n                        <input value={editText} onChange={e => setEditText(e.target.value)} />\n                        <button className=\"btn-primary\" onClick={() => handleEditSave(m._id)}>Save</button>\n                        <button className=\"btn-primary\" onClick={() => setEditId(null)}>Cancel</button>\n                      </>\n                    ) : (\n                      <>\n                        <span className=\"dm-text\">{m.messageContent}</span>\n                        <span className=\"dm-time\" style={{ display: 'block', marginTop: 2, textAlign: 'right', color: '#888', fontSize: '0.95em' }}>{formatTime(m.sentAt || m.createdAt)}</span>\n                        {currentUser && m.fromUserId === currentUser._id && canShowActionsMenu(m) && showActionsId === m._id && (\n                          <div\n                            className=\"dm-actions-hover\"\n                            style={{ width: '100%', display: 'flex', flexDirection: 'row', justifyContent: 'center', gap: '8px', marginTop: 8 }}\n                          >\n                            {canEditMessage(m) && <button className=\"btn-primary dm-edit\" onClick={() => { setEditId(m._id); setEditText(m.messageContent); setShowActionsId(null); }}>Edit</button>}\n                            {canDeleteMessage(m) && <button className=\"btn-primary dm-delete\" onClick={() => { handleDelete(m._id); setShowActionsId(null); }}>Delete</button>}\n                          </div>\n                        )}\n                      </>\n                    )}\n                  </div>\n                </React.Fragment>\n              );\n            });\n          })()}\n              </div>\n\n              {/* Chat input */}\n              <div className=\"dm-input-row\">\n                <input\n                  type=\"text\"\n                  value={input}\n                  onChange={e => setInput(e.target.value)}\n                  placeholder=\"Type your message...\"\n                  onKeyDown={e => { if (e.key === 'Enter') handleSend(); }}\n                />\n                <button className=\"btn-primary\" onClick={handleSend}>Send</button>\n              </div>\n            </>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DirectMessages;\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,QAAQ,EAAEC,SAAS,EAAEC,MAAM,QAAQ,OAAO;AAC1D,OAAOC,KAAK,MAAM,OAAO;AACzB,SAASC,GAAG,QAAQ,iBAAiB;AACrC,OAAO,sBAAsB;AAAC,SAAAC,MAAA,IAAAC,OAAA,EAAAC,QAAA,IAAAC,SAAA;AAE9B,MAAMC,cAAc,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EAAA,IAAAC,qBAAA;EACvC,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGd,QAAQ,CAAC,EAAE,CAAC;EAC1C,MAAM,CAACe,QAAQ,EAAEC,WAAW,CAAC,GAAGhB,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAACiB,eAAe,EAAEC,kBAAkB,CAAC,GAAGlB,QAAQ,CAAC,IAAI,CAAC;EAC5D,MAAM,CAACmB,QAAQ,EAAEC,WAAW,CAAC,GAAGpB,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAACqB,KAAK,EAAEC,QAAQ,CAAC,GAAGtB,QAAQ,CAAC,EAAE,CAAC;EACtC,MAAM,CAACuB,WAAW,EAAEC,cAAc,CAAC,GAAGxB,QAAQ,CAAC,EAAE,CAAC;EAClD,MAAM,CAACyB,MAAM,EAAEC,SAAS,CAAC,GAAG1B,QAAQ,CAAC,IAAI,CAAC;EAC1C,MAAM,CAAC2B,QAAQ,EAAEC,WAAW,CAAC,GAAG5B,QAAQ,CAAC,EAAE,CAAC;EAC5C,MAAM,CAAC6B,aAAa,EAAEC,gBAAgB,CAAC,GAAG9B,QAAQ,CAAC,IAAI,CAAC;EACxD,MAAM,CAAC+B,WAAW,EAAEC,cAAc,CAAC,GAAGhC,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACiC,OAAO,EAAEC,UAAU,CAAC,GAAGlC,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAMmC,OAAO,GAAGjC,MAAM,CAAC,IAAI,CAAC;;EAE5B;EACAD,SAAS,CAAC,MAAM;IACd,MAAMmC,SAAS,GAAG,MAAAA,CAAA,KAAY;MAC5B,IAAI;QAAA,IAAAC,cAAA;QACF,MAAMC,QAAQ,GAAG,MAAMlC,GAAG,CAAC,UAAU,CAAC;QACtCmC,OAAO,CAACC,GAAG,CAAC,qBAAqB,EAAEF,QAAQ,CAAC;QAC5CC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEC,MAAM,CAACC,IAAI,CAACJ,QAAQ,CAAC,CAAC;;QAErD;QACA,IAAIK,IAAI,GAAG,CAAAL,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEK,IAAI,MAAIL,QAAQ,aAARA,QAAQ,wBAAAD,cAAA,GAARC,QAAQ,CAAEM,IAAI,cAAAP,cAAA,uBAAdA,cAAA,CAAgBM,IAAI,KAAIL,QAAQ;QAC7DC,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEG,IAAI,CAAC;QACpCJ,OAAO,CAACC,GAAG,CAAC,YAAY,EAAEC,MAAM,CAACC,IAAI,CAACC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;;QAElD;QACA,IAAIA,IAAI,IAAI,CAACA,IAAI,CAACE,GAAG,EAAE;UACrB;UACA,IAAIF,IAAI,CAACG,EAAE,EAAE;YACXH,IAAI,CAACE,GAAG,GAAGF,IAAI,CAACG,EAAE;UACpB,CAAC,MAAM,IAAIH,IAAI,CAACI,MAAM,EAAE;YACtBJ,IAAI,CAACE,GAAG,GAAGF,IAAI,CAACI,MAAM;UACxB,CAAC,MAAM,IAAIJ,IAAI,CAACK,MAAM,EAAE;YACtBL,IAAI,CAACE,GAAG,GAAGF,IAAI,CAACK,MAAM;UACxB,CAAC,MAAM,IAAIL,IAAI,CAACM,EAAE,EAAE;YAClBN,IAAI,CAACE,GAAG,GAAGF,IAAI,CAACM,EAAE;UACpB;UACAV,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEG,IAAI,CAAC;QAC7C;QAEA,IAAIA,IAAI,IAAIA,IAAI,CAACE,GAAG,EAAE;UACpBb,cAAc,CAACW,IAAI,CAAC;UACpBJ,OAAO,CAACC,GAAG,CAAC,gCAAgC,EAAEG,IAAI,CAAC;QACrD,CAAC,MAAM;UACLJ,OAAO,CAACW,KAAK,CAAC,gDAAgD,EAAEC,IAAI,CAACC,SAAS,CAACT,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;QAChG;MACF,CAAC,CAAC,OAAOU,GAAG,EAAE;QACZd,OAAO,CAACW,KAAK,CAAC,sBAAsB,EAAEG,GAAG,CAAC;MAC5C;IACF,CAAC;IACDjB,SAAS,CAAC,CAAC;EACb,CAAC,EAAE,EAAE,CAAC;;EAEN;EACAnC,SAAS,CAAC,MAAM;IACd,IAAIS,QAAQ,KAAK,SAAS,IAAIqB,WAAW,EAAE;MACzC,MAAMuB,YAAY,GAAG,MAAAA,CAAA,KAAY;QAC/Bf,OAAO,CAACC,GAAG,CAAC,6CAA6C,EAAET,WAAW,CAAC;QACvEG,UAAU,CAAC,KAAK,CAAC;QAEjB,IAAI;UACF;UACA,MAAMqB,kBAAkB,GAAG,MAAMnD,GAAG,CAAC,aAAa2B,WAAW,CAACgB,MAAM,EAAE,CAAC;UACvER,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEe,kBAAkB,CAAC;UAE7D,MAAMC,eAAe,GAAG,CAAAD,kBAAkB,aAAlBA,kBAAkB,uBAAlBA,kBAAkB,CAAEE,cAAc,KAAIF,kBAAkB;UAChFhB,OAAO,CAACC,GAAG,CAAC,wBAAwB,EAAEgB,eAAe,CAAC;UAEtD,IAAI,CAACA,eAAe,IAAI,CAACA,eAAe,CAACE,KAAK,IAAI,CAACF,eAAe,CAACG,KAAK,EAAE;YACxEpB,OAAO,CAACC,GAAG,CAAC,oCAAoC,CAAC;YACjD1B,UAAU,CAAC,EAAE,CAAC;YACd;UACF;UAEA,MAAM8C,YAAY,GAAGJ,eAAe,CAACE,KAAK;UAC1C,MAAMG,YAAY,GAAGL,eAAe,CAACG,KAAK;UAC1CpB,OAAO,CAACC,GAAG,CAAC,gCAAgCoB,YAAY,GAAGC,YAAY,EAAE,CAAC;;UAE1E;UACA,MAAMC,UAAU,GAAG,MAAM1D,GAAG,CAAC,oBAAoB,CAAC;UAClD,MAAM2D,UAAU,GAAG,CAAAD,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEE,KAAK,KAAIF,UAAU,IAAI,EAAE;UACxDvB,OAAO,CAACC,GAAG,CAAC,cAAc,EAAEuB,UAAU,CAAC;UAEvC,IAAIA,UAAU,CAACE,MAAM,KAAK,CAAC,EAAE;YAC3B1B,OAAO,CAACC,GAAG,CAAC,4BAA4B,CAAC;YACzC1B,UAAU,CAAC,EAAE,CAAC;YACd;UACF;;UAEA;UACA,MAAMoD,mBAAmB,GAAG,MAAMC,OAAO,CAACC,GAAG,CAC3CL,UAAU,CAACM,GAAG,CAAC,MAAOC,MAAM,IAAK;YAC/B,IAAI;cAAA,IAAAC,gBAAA,EAAAC,iBAAA;cACF,MAAMC,WAAW,GAAG,MAAMrE,GAAG,CAAC,aAAakE,MAAM,CAACvB,MAAM,EAAE,CAAC;cAC3D,MAAM2B,YAAY,GAAG,CAAAD,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEhB,cAAc,KAAIgB,WAAW;cAE/D,IAAI,CAACC,YAAY,IAAI,CAACA,YAAY,CAAChB,KAAK,IAAI,CAACgB,YAAY,CAACf,KAAK,EAAE;gBAC/DpB,OAAO,CAACC,GAAG,CAAC,qCAAqC8B,MAAM,CAACvB,MAAM,EAAE,CAAC;gBACjE,OAAO,IAAI;cACb;cAEA,OAAO;gBACL,GAAGuB,MAAM;gBACTzB,GAAG,EAAEyB,MAAM,CAACvB,MAAM;gBAAE;gBACpB4B,SAAS,EAAE,EAAAJ,gBAAA,GAAAD,MAAM,CAACM,QAAQ,cAAAL,gBAAA,uBAAfA,gBAAA,CAAiBM,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAIP,MAAM,CAACM,QAAQ;gBAC5DE,QAAQ,EAAE,EAAAN,iBAAA,GAAAF,MAAM,CAACM,QAAQ,cAAAJ,iBAAA,uBAAfA,iBAAA,CAAiBK,KAAK,CAAC,GAAG,CAAC,CAACE,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC,KAAI,EAAE;gBAC9DtB,KAAK,EAAEgB,YAAY,CAAChB,KAAK;gBACzBC,KAAK,EAAEe,YAAY,CAACf;cACtB,CAAC;YACH,CAAC,CAAC,OAAON,GAAG,EAAE;cACZd,OAAO,CAACC,GAAG,CAAC,2CAA2C8B,MAAM,CAACvB,MAAM,GAAG,EAAEM,GAAG,CAAC;cAC7E,OAAO,IAAI;YACb;UACF,CAAC,CACH,CAAC;;UAED;UACA,MAAM4B,YAAY,GAAGf,mBAAmB,CAACgB,MAAM,CAACC,CAAC,IAAIA,CAAC,KAAK,IAAI,CAAC;UAChE5C,OAAO,CAACC,GAAG,CAAC,6BAA6B,EAAEyC,YAAY,CAAC;;UAExD;UACA,MAAMG,eAAe,GAAGH,YAAY,CAACC,MAAM,CAACC,CAAC,IAAI;YAC/C,MAAME,OAAO,GAAGF,CAAC,CAACzB,KAAK,KAAKE,YAAY,IAAIuB,CAAC,CAACxB,KAAK,KAAKE,YAAY;YACpEtB,OAAO,CAACC,GAAG,CAAC,UAAU2C,CAAC,CAACpC,MAAM,WAAWoC,CAAC,CAACzB,KAAK,GAAGyB,CAAC,CAACxB,KAAK,MAAM0B,OAAO,GAAG,OAAO,GAAG,UAAU,EAAE,CAAC;YACjG,OAAOA,OAAO;UAChB,CAAC,CAAC;UAEF9C,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAE4C,eAAe,CAAC;UACjDtE,UAAU,CAACsE,eAAe,CAAC;QAE7B,CAAC,CAAC,OAAO/B,GAAG,EAAE;UACZd,OAAO,CAACW,KAAK,CAAC,yBAAyB,EAAEG,GAAG,CAAC;UAC7CvC,UAAU,CAAC,EAAE,CAAC;QAChB;MACF,CAAC;MACDwC,YAAY,CAAC,CAAC;IAChB,CAAC,MAAM,IAAI5C,QAAQ,KAAK,QAAQ,IAAIqB,WAAW,EAAE;MAC/C;MACA,MAAMuD,aAAa,GAAG,MAAAA,CAAA,KAAY;QAChC/C,OAAO,CAACC,GAAG,CAAC,6CAA6C,EAAET,WAAW,CAAC;QACvEG,UAAU,CAAC,KAAK,CAAC;QAEjB,IAAI;UACF;UACA,MAAMqD,iBAAiB,GAAG,MAAMnF,GAAG,CAAC,aAAa2B,WAAW,CAACgB,MAAM,EAAE,CAAC;UACtER,OAAO,CAACC,GAAG,CAAC,2BAA2B,EAAE+C,iBAAiB,CAAC;UAE3D,MAAMC,cAAc,GAAG,CAAAD,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAE9B,cAAc,KAAI8B,iBAAiB;UAC7EhD,OAAO,CAACC,GAAG,CAAC,uBAAuB,EAAEgD,cAAc,CAAC;UAEpD,IAAI,CAACA,cAAc,IAAI,CAACA,cAAc,CAAC9B,KAAK,IAAI,CAAC8B,cAAc,CAAC7B,KAAK,EAAE;YACrEpB,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC;YAChDxB,WAAW,CAAC,EAAE,CAAC;YACf;UACF;UAEA,MAAMyE,WAAW,GAAGD,cAAc,CAAC9B,KAAK;UACxC,MAAMgC,WAAW,GAAGF,cAAc,CAAC7B,KAAK;UACxCpB,OAAO,CAACC,GAAG,CAAC,sBAAsBiD,WAAW,GAAGC,WAAW,EAAE,CAAC;;UAE9D;UACA,MAAMC,WAAW,GAAG,MAAMvF,GAAG,CAAC,qBAAqB,CAAC;UACpD,MAAMwF,WAAW,GAAG,CAAAD,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAE3B,KAAK,KAAI2B,WAAW,IAAI,EAAE;UAC3DpD,OAAO,CAACC,GAAG,CAAC,eAAe,EAAEoD,WAAW,CAAC;UAEzC,IAAIA,WAAW,CAAC3B,MAAM,KAAK,CAAC,EAAE;YAC5B1B,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAC;YAC1CxB,WAAW,CAAC,EAAE,CAAC;YACf;UACF;;UAEA;UACA,MAAM6E,oBAAoB,GAAG,MAAM1B,OAAO,CAACC,GAAG,CAC5CwB,WAAW,CAACvB,GAAG,CAAC,MAAOyB,OAAO,IAAK;YACjC,IAAI;cAAA,IAAAC,iBAAA,EAAAC,kBAAA;cACF,MAAMvB,WAAW,GAAG,MAAMrE,GAAG,CAAC,aAAa0F,OAAO,CAAC/C,MAAM,EAAE,CAAC;cAC5D,MAAM2B,YAAY,GAAG,CAAAD,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEhB,cAAc,KAAIgB,WAAW;cAE/D,IAAI,CAACC,YAAY,IAAI,CAACA,YAAY,CAAChB,KAAK,IAAI,CAACgB,YAAY,CAACf,KAAK,EAAE;gBAC/DpB,OAAO,CAACC,GAAG,CAAC,sCAAsCsD,OAAO,CAAC/C,MAAM,EAAE,CAAC;gBACnE,OAAO,IAAI;cACb;cAEA,OAAO;gBACL,GAAG+C,OAAO;gBACVjD,GAAG,EAAEiD,OAAO,CAAC/C,MAAM;gBAAE;gBACrB4B,SAAS,EAAE,EAAAoB,iBAAA,GAAAD,OAAO,CAAClB,QAAQ,cAAAmB,iBAAA,uBAAhBA,iBAAA,CAAkBlB,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,KAAIiB,OAAO,CAAClB,QAAQ;gBAC9DE,QAAQ,EAAE,EAAAkB,kBAAA,GAAAF,OAAO,CAAClB,QAAQ,cAAAoB,kBAAA,uBAAhBA,kBAAA,CAAkBnB,KAAK,CAAC,GAAG,CAAC,CAACE,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC,KAAI,EAAE;gBAC/DtB,KAAK,EAAEgB,YAAY,CAAChB,KAAK;gBACzBC,KAAK,EAAEe,YAAY,CAACf;cACtB,CAAC;YACH,CAAC,CAAC,OAAON,GAAG,EAAE;cACZd,OAAO,CAACC,GAAG,CAAC,4CAA4CsD,OAAO,CAAC/C,MAAM,GAAG,EAAEM,GAAG,CAAC;cAC/E,OAAO,IAAI,CAAC,CAAC;YACf;UACF,CAAC,CACH,CAAC;;UAED;UACA,MAAM4C,aAAa,GAAGJ,oBAAoB,CAACX,MAAM,CAACgB,CAAC,IAAIA,CAAC,KAAK,IAAI,CAAC;UAClE3D,OAAO,CAACC,GAAG,CAAC,8BAA8B,EAAEyD,aAAa,CAAC;;UAE1D;UACA,MAAME,gBAAgB,GAAGF,aAAa,CAACf,MAAM,CAACgB,CAAC,IAAI;YACjD,MAAMb,OAAO,GAAGa,CAAC,CAACxC,KAAK,KAAK+B,WAAW,IAAIS,CAAC,CAACvC,KAAK,KAAK+B,WAAW;YAClEnD,OAAO,CAACC,GAAG,CAAC,WAAW0D,CAAC,CAACnD,MAAM,WAAWmD,CAAC,CAACxC,KAAK,GAAGwC,CAAC,CAACvC,KAAK,MAAM0B,OAAO,GAAG,OAAO,GAAG,UAAU,EAAE,CAAC;YAClG,OAAOA,OAAO;UAChB,CAAC,CAAC;UAEF9C,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAE2D,gBAAgB,CAAC;UACnDnF,WAAW,CAACmF,gBAAgB,CAAC;QAE/B,CAAC,CAAC,OAAO9C,GAAG,EAAE;UACZd,OAAO,CAACW,KAAK,CAAC,0BAA0B,EAAEG,GAAG,CAAC;UAC9CrC,WAAW,CAAC,EAAE,CAAC;QACjB;MACF,CAAC;MACDsE,aAAa,CAAC,CAAC;IACjB,CAAC,MAAM,IAAIvD,WAAW,EAAE;MACtBG,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC,EAAE,CAACxB,QAAQ,EAAEqB,WAAW,CAAC,CAAC;;EAE3B;EACA,MAAMqE,cAAc,GAAIC,QAAQ,IAAK;IACnC,IAAI,CAACtE,WAAW,EAAE,OAAO,MAAM;IAC/B,OAAOsE,QAAQ,KAAKtE,WAAW,CAACc,GAAG,GAAG,OAAO,GAAG,MAAM;EACxD,CAAC;;EAED;EACA,SAASyD,cAAcA,CAACC,GAAG,EAAE;IAC3B,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAME,IAAI,GAAG,IAAID,IAAI,CAACF,GAAG,CAACI,MAAM,IAAIJ,GAAG,CAACK,SAAS,CAAC,CAACC,OAAO,CAAC,CAAC;IAC5D,OAAQL,GAAG,GAAGE,IAAI,IAAK,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;EACzC;EACA,SAASI,gBAAgBA,CAACP,GAAG,EAAE;IAC7B,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAME,IAAI,GAAG,IAAID,IAAI,CAACF,GAAG,CAACI,MAAM,IAAIJ,GAAG,CAACK,SAAS,CAAC,CAACC,OAAO,CAAC,CAAC;IAC5D,OAAQL,GAAG,GAAGE,IAAI,IAAK,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;EAC9C;;EAEA;EACA,SAASK,kBAAkBA,CAACR,GAAG,EAAE;IAC/B,MAAMC,GAAG,GAAGC,IAAI,CAACD,GAAG,CAAC,CAAC;IACtB,MAAME,IAAI,GAAG,IAAID,IAAI,CAACF,GAAG,CAACI,MAAM,IAAIJ,GAAG,CAACK,SAAS,CAAC,CAACC,OAAO,CAAC,CAAC;IAC5D,OAAQL,GAAG,GAAGE,IAAI,IAAK,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,IAAI,CAAC,CAAC;EAC7C;;EAEA;EACA,SAASM,UAAUA,CAACC,OAAO,EAAE;IAC3B,MAAMC,CAAC,GAAG,IAAIT,IAAI,CAACQ,OAAO,CAAC;IAC3B,MAAME,KAAK,GAAG,IAAIV,IAAI,CAAC,CAAC;IACxB,IAAIS,CAAC,CAACE,YAAY,CAAC,CAAC,KAAKD,KAAK,CAACC,YAAY,CAAC,CAAC,EAAE;MAC7C,OAAO,OAAO;IAChB;IACA,OAAOF,CAAC,CAACG,kBAAkB,CAACC,SAAS,EAAE;MAAEC,OAAO,EAAE,MAAM;MAAEC,IAAI,EAAE,SAAS;MAAEC,KAAK,EAAE,MAAM;MAAEC,GAAG,EAAE;IAAU,CAAC,CAAC;EAC7G;EACA;EACA,SAASC,UAAUA,CAACV,OAAO,EAAE;IAC3B,MAAMC,CAAC,GAAG,IAAIT,IAAI,CAACQ,OAAO,CAAC;IAC3B,OAAOC,CAAC,CAACU,kBAAkB,CAACN,SAAS,EAAE;MAAEO,IAAI,EAAE,SAAS;MAAEC,MAAM,EAAE;IAAU,CAAC,CAAC;EAChF;;EAEA;EACA7H,SAAS,CAAC,MAAM;IACd,IAAIgB,eAAe,IAAIc,WAAW,IAAIA,WAAW,CAACc,GAAG,EAAE;MACrD,MAAMkF,aAAa,GAAG,MAAAA,CAAA,KAAY;QAChC,IAAI;UACFxF,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAET,WAAW,CAACc,GAAG,EAAE,KAAK,EAAE5B,eAAe,CAAC4B,GAAG,CAAC;UACtF;UACA,MAAMmF,GAAG,GAAG,MAAM7H,KAAK,CAAC8H,GAAG,CAAC,SAASlG,WAAW,CAACc,GAAG,IAAI5B,eAAe,CAAC4B,GAAG,EAAE,CAAC;UAC9EN,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAEwF,GAAG,CAACpF,IAAI,CAAC;UAC3CxB,WAAW,CAAC4G,GAAG,CAACpF,IAAI,CAACzB,QAAQ,IAAI6G,GAAG,CAACpF,IAAI,IAAI,EAAE,CAAC;QAClD,CAAC,CAAC,OAAOS,GAAG,EAAE;UACZd,OAAO,CAACW,KAAK,CAAC,0BAA0B,EAAEG,GAAG,CAAC;UAC9CjC,WAAW,CAAC,EAAE,CAAC;QACjB;MACF,CAAC;MACD2G,aAAa,CAAC,CAAC;IACjB;EACF,CAAC,EAAE,CAAC9G,eAAe,EAAEc,WAAW,CAAC,CAAC;;EAElC;EACA9B,SAAS,CAAC,MAAM;IACd,IAAIkC,OAAO,CAAC+F,OAAO,EAAE;MACnB/F,OAAO,CAAC+F,OAAO,CAACC,SAAS,GAAGhG,OAAO,CAAC+F,OAAO,CAACE,YAAY;IAC1D;EACF,CAAC,EAAE,CAACjH,QAAQ,CAAC,CAAC;;EAEd;EACA,MAAMkH,UAAU,GAAG,MAAAA,CAAA,KAAY;IAC7B,IAAIhH,KAAK,CAACiH,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;MACvBC,KAAK,CAAC,wBAAwB,CAAC;MAC/B;IACF;IAEA,IAAI,CAACxG,WAAW,IAAI,CAACA,WAAW,CAACc,GAAG,EAAE;MACpC0F,KAAK,CAAC,2CAA2C,CAAC;MAClDhG,OAAO,CAACW,KAAK,CAAC,yBAAyB,EAAEnB,WAAW,CAAC;MACrD;IACF;IAEA,IAAI,CAACd,eAAe,IAAI,CAACA,eAAe,CAAC4B,GAAG,EAAE;MAC5C0F,KAAK,CAAC,qBAAqB,CAAC;MAC5B;IACF;IAEA,IAAI;MACF;MACA,MAAMC,OAAO,GAAGvH,eAAe,CAACyC,KAAK,IAAIzC,eAAe,CAAC0C,KAAK,GAC1D,GAAG1C,eAAe,CAACyC,KAAK,GAAGzC,eAAe,CAAC0C,KAAK,EAAE,GAClD,SAAS;MAEbpB,OAAO,CAACC,GAAG,CAAC,kBAAkB,EAAE;QAC9BiG,UAAU,EAAE1G,WAAW,CAACc,GAAG;QAC3B6F,QAAQ,EAAEzH,eAAe,CAAC4B,GAAG;QAC7B2F,OAAO,EAAEA,OAAO;QAChBG,cAAc,EAAEtH;MAClB,CAAC,CAAC;MAEF,MAAMuH,QAAQ,GAAG,MAAMzI,KAAK,CAAC0I,IAAI,CAAC,OAAO,EAAE;QACzCJ,UAAU,EAAE1G,WAAW,CAACc,GAAG;QAC3B6F,QAAQ,EAAEzH,eAAe,CAAC4B,GAAG;QAC7B2F,OAAO,EAAEA,OAAO;QAChBG,cAAc,EAAEtH;MAClB,CAAC,CAAC;MAEFkB,OAAO,CAACC,GAAG,CAAC,4BAA4B,EAAEoG,QAAQ,CAAChG,IAAI,CAAC;;MAExD;MACA,MAAMoF,GAAG,GAAG,MAAM7H,KAAK,CAAC8H,GAAG,CAAC,SAASlG,WAAW,CAACc,GAAG,IAAI5B,eAAe,CAAC4B,GAAG,EAAE,CAAC;MAC9EzB,WAAW,CAAC4G,GAAG,CAACpF,IAAI,CAACzB,QAAQ,IAAI6G,GAAG,CAACpF,IAAI,IAAI,EAAE,CAAC;MAChDtB,QAAQ,CAAC,EAAE,CAAC;IACd,CAAC,CAAC,OAAO+B,GAAG,EAAE;MAAA,IAAAyF,aAAA,EAAAC,cAAA,EAAAC,mBAAA;MACZzG,OAAO,CAACW,KAAK,CAAC,yBAAyB,EAAEG,GAAG,CAAC;MAC7Cd,OAAO,CAACW,KAAK,CAAC,gBAAgB,GAAA4F,aAAA,GAAEzF,GAAG,CAACuF,QAAQ,cAAAE,aAAA,uBAAZA,aAAA,CAAclG,IAAI,CAAC;MACnD2F,KAAK,CAAC,2BAA2B,EAAAQ,cAAA,GAAA1F,GAAG,CAACuF,QAAQ,cAAAG,cAAA,wBAAAC,mBAAA,GAAZD,cAAA,CAAcnG,IAAI,cAAAoG,mBAAA,uBAAlBA,mBAAA,CAAoBC,OAAO,KAAI5F,GAAG,CAAC4F,OAAO,EAAE,CAAC;IAChF;EACF,CAAC;;EAED;EACA,MAAMC,cAAc,GAAG,MAAOpG,EAAE,IAAK;IACnC,IAAI,CAAC7B,eAAe,IAAI,CAACc,WAAW,EAAE;IACtC,IAAI;MACF,MAAM5B,KAAK,CAACgJ,GAAG,CAAC,SAASrG,EAAE,EAAE,EAAE;QAAE6F,cAAc,EAAEhH;MAAS,CAAC,CAAC;MAC5D,MAAMqG,GAAG,GAAG,MAAM7H,KAAK,CAAC8H,GAAG,CAAC,SAASlG,WAAW,CAACc,GAAG,IAAI5B,eAAe,CAAC4B,GAAG,EAAE,CAAC;MAC9EzB,WAAW,CAAC4G,GAAG,CAACpF,IAAI,CAACzB,QAAQ,IAAI6G,GAAG,CAACpF,IAAI,IAAI,EAAE,CAAC;MAChDlB,SAAS,CAAC,IAAI,CAAC;MACfE,WAAW,CAAC,EAAE,CAAC;IACjB,CAAC,CAAC,OAAOyB,GAAG,EAAE;MACZd,OAAO,CAACW,KAAK,CAAC,yBAAyB,EAAEG,GAAG,CAAC;IAC/C;EACF,CAAC;;EAED;EACA,MAAM+F,YAAY,GAAG,MAAOtG,EAAE,IAAK;IACjC,IAAI,CAAC7B,eAAe,IAAI,CAACc,WAAW,EAAE;IACtC,IAAI;MACF,MAAM5B,KAAK,CAACkJ,MAAM,CAAC,SAASvG,EAAE,EAAE,CAAC;MACjC,MAAMkF,GAAG,GAAG,MAAM7H,KAAK,CAAC8H,GAAG,CAAC,SAASlG,WAAW,CAACc,GAAG,IAAI5B,eAAe,CAAC4B,GAAG,EAAE,CAAC;MAC9EzB,WAAW,CAAC4G,GAAG,CAACpF,IAAI,CAACzB,QAAQ,IAAI6G,GAAG,CAACpF,IAAI,IAAI,EAAE,CAAC;IAClD,CAAC,CAAC,OAAOS,GAAG,EAAE;MACZd,OAAO,CAACW,KAAK,CAAC,2BAA2B,EAAEG,GAAG,CAAC;IACjD;EACF,CAAC;;EAED;EACA,MAAMiG,WAAW,GAAG5I,QAAQ,KAAK,SAAS,GAAGG,OAAO,GAAGE,QAAQ;EAC/DwB,OAAO,CAACC,GAAG,CAAC,eAAe,EAAE8G,WAAW,EAAE,WAAW,EAAE5I,QAAQ,EAAE,UAAU,EAAEG,OAAO,EAAE,WAAW,EAAEE,QAAQ,CAAC;EAE5G,MAAMwI,gBAAgB,GAAGD,WAAW,CAACpE,MAAM,CAACsE,OAAO,IAAI;IACrD,MAAMC,KAAK,GAAGlI,WAAW,CAACmI,WAAW,CAAC,CAAC;IACvC,MAAMC,IAAI,GAAG,GAAGH,OAAO,CAAC7E,SAAS,IAAI,EAAE,IAAI6E,OAAO,CAAC1E,QAAQ,IAAI,EAAE,EAAE,CAAC4E,WAAW,CAAC,CAAC;IACjF,MAAM1G,MAAM,GAAG,CAACwG,OAAO,CAACxG,MAAM,IAAIwG,OAAO,CAAC3G,GAAG,IAAI,EAAE,EAAE6G,WAAW,CAAC,CAAC;IAClE,OAAOC,IAAI,CAACC,QAAQ,CAACH,KAAK,CAAC,IAAIzG,MAAM,CAAC4G,QAAQ,CAACH,KAAK,CAAC;EACvD,CAAC,CAAC;EAEFlH,OAAO,CAACC,GAAG,CAAC,oBAAoB,EAAE+G,gBAAgB,CAAC;EAEnD,oBACEjJ,OAAA;IAAKuJ,SAAS,EAAC,WAAW;IAAAC,QAAA,gBACxBxJ,OAAA;MAAKuJ,SAAS,EAAC,eAAe;MAAAC,QAAA,gBAC5BxJ,OAAA;QAAAwJ,QAAA,EAAI;MAAe;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC,eACxB5J,OAAA;QAAAwJ,QAAA,EAAG;MAA0C;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAG,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAC9C,CAAC,eACN5J,OAAA;MAAKuJ,SAAS,EAAC,uBAAuB;MAAAC,QAAA,gBAEpCxJ,OAAA;QAAKuJ,SAAS,EAAC,YAAY;QAAAC,QAAA,gBACzBxJ,OAAA;UAAKuJ,SAAS,EAAC,eAAe;UAAAC,QAAA,eAC5BxJ,OAAA;YACE6J,IAAI,EAAC,MAAM;YACXC,WAAW,EAAC,8BAA8B;YAC1CC,KAAK,EAAE9I,WAAY;YACnB+I,QAAQ,EAAGC,CAAC,IAAK/I,cAAc,CAAC+I,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE;YAChDR,SAAS,EAAC;UAAiB;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC5B;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACC,CAAC,eACN5J,OAAA;UAAKuJ,SAAS,EAAC,gBAAgB;UAAAC,QAAA,EAC5B7H,OAAO,gBACN3B,OAAA;YAAGuJ,SAAS,EAAC,eAAe;YAAAC,QAAA,EAAC;UAAU;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAG,CAAC,GACzCX,gBAAgB,CAACtF,MAAM,KAAK,CAAC,gBAC/B3D,OAAA;YAAGuJ,SAAS,EAAC,eAAe;YAAAC,QAAA,EACzBpJ,QAAQ,KAAK,SAAS,GAAG,kBAAkB,GAAG;UAAmB;YAAAqJ,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACjE,CAAC,GAEJX,gBAAgB,CAAClF,GAAG,CAACmF,OAAO;YAAA,IAAAiB,kBAAA;YAAA,oBAC1BnK,OAAA;cAEEuJ,SAAS,EAAE,kBAAkB,CAAA5I,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAE4B,GAAG,MAAK2G,OAAO,CAAC3G,GAAG,GAAG,QAAQ,GAAG,EAAE,EAAG;cACpF6H,OAAO,EAAEA,CAAA,KAAMxJ,kBAAkB,CAACsI,OAAO,CAAE;cAAAM,QAAA,gBAE3CxJ,OAAA;gBAAKuJ,SAAS,EAAC,kBAAkB;gBAAAC,QAAA,EAC9B,CAAC,EAAAW,kBAAA,GAAAjB,OAAO,CAAC7E,SAAS,cAAA8F,kBAAA,uBAAjBA,kBAAA,CAAoB,CAAC,CAAC,MAAK/J,QAAQ,KAAK,SAAS,GAAG,GAAG,GAAG,GAAG,CAAC,EAAEiK,WAAW,CAAC;cAAC;gBAAAZ,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC5E,CAAC,eACN5J,OAAA;gBAAKuJ,SAAS,EAAC,gBAAgB;gBAAAC,QAAA,gBAC7BxJ,OAAA;kBAAKuJ,SAAS,EAAC,gBAAgB;kBAAAC,QAAA,GAC5BN,OAAO,CAAC7E,SAAS,KAAKjE,QAAQ,KAAK,SAAS,GAAG,QAAQ,GAAG,SAAS,CAAC,EAAC,GAAC,EAAC8I,OAAO,CAAC1E,QAAQ,IAAI,EAAE;gBAAA;kBAAAiF,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAC3F,CAAC,eACN5J,OAAA;kBAAKuJ,SAAS,EAAC,cAAc;kBAAAC,QAAA,GAAC,MAAI,EAACN,OAAO,CAACzG,MAAM,IAAIyG,OAAO,CAACxG,MAAM,IAAIwG,OAAO,CAAC3G,GAAG;gBAAA;kBAAAkH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAAC,EACvFV,OAAO,CAAC9F,KAAK,IAAI8F,OAAO,CAAC7F,KAAK,iBAC9BrD,OAAA;kBAAKuJ,SAAS,EAAC,iBAAiB;kBAAAC,QAAA,GAAC,QAAM,EAACN,OAAO,CAAC9F,KAAK,EAAE8F,OAAO,CAAC7F,KAAK;gBAAA;kBAAAoG,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAC3E;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACE,CAAC;YAAA,GAfDV,OAAO,CAAC3G,GAAG;cAAAkH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAgBb,CAAC;UAAA,CACP;QACF;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAGN5J,OAAA;QAAKuJ,SAAS,EAAC,cAAc;QAAAC,QAAA,EAC1B,CAAC7I,eAAe,gBACfX,OAAA;UAAKuJ,SAAS,EAAC,qBAAqB;UAAAC,QAAA,gBAClCxJ,OAAA;YAAGuJ,SAAS,EAAC,iBAAiB;YAACe,KAAK,EAAE;cAAEC,QAAQ,EAAE,MAAM;cAAEC,KAAK,EAAE,MAAM;cAAEC,YAAY,EAAE;YAAO;UAAE;YAAAhB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC,eACrG5J,OAAA;YAAAwJ,QAAA,EAAIpJ,QAAQ,KAAK,SAAS,GAAG,mCAAmC,GAAG;UAA6C;YAAAqJ,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAI,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClH,CAAC,gBAEN5J,OAAA,CAAAE,SAAA;UAAAsJ,QAAA,gBAEExJ,OAAA;YAAKuJ,SAAS,EAAC,gBAAgB;YAAAC,QAAA,gBAC7BxJ,OAAA;cAAKuJ,SAAS,EAAC,kBAAkB;cAAAC,QAAA,EAC9B,CAAC,EAAAlJ,qBAAA,GAAAK,eAAe,CAAC0D,SAAS,cAAA/D,qBAAA,uBAAzBA,qBAAA,CAA4B,CAAC,CAAC,MAAKF,QAAQ,KAAK,SAAS,GAAG,GAAG,GAAG,GAAG,CAAC,EAAEiK,WAAW,CAAC;YAAC;cAAAZ,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACpF,CAAC,eACN5J,OAAA;cAAKuJ,SAAS,EAAC,gBAAgB;cAAAC,QAAA,gBAC7BxJ,OAAA;gBAAKuJ,SAAS,EAAC,gBAAgB;gBAAAC,QAAA,GAC5B7I,eAAe,CAAC0D,SAAS,KAAKjE,QAAQ,KAAK,SAAS,GAAG,QAAQ,GAAG,SAAS,CAAC,EAAC,GAAC,EAACO,eAAe,CAAC6D,QAAQ,IAAI,EAAE;cAAA;gBAAAiF,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC3G,CAAC,eACN5J,OAAA;gBAAKuJ,SAAS,EAAC,cAAc;gBAAAC,QAAA,GAAC,MAAI,EAAC7I,eAAe,CAAC8B,MAAM,IAAI9B,eAAe,CAAC+B,MAAM,IAAI/B,eAAe,CAAC4B,GAAG;cAAA;gBAAAkH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,EAC/GjJ,eAAe,CAACyC,KAAK,IAAIzC,eAAe,CAAC0C,KAAK,iBAC9CrD,OAAA;gBAAKuJ,SAAS,EAAC,iBAAiB;gBAAAC,QAAA,GAAC,QAAM,EAAC7I,eAAe,CAACyC,KAAK,EAAEzC,eAAe,CAAC0C,KAAK;cAAA;gBAAAoG,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAC3F;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACH,CAAC,eAGN5J,OAAA;YAAKuJ,SAAS,EAAC,SAAS;YAACmB,GAAG,EAAE7I,OAAQ;YAAA2H,QAAA,EACzC,CAAC,MAAM;cACN,IAAImB,QAAQ,GAAG,IAAI;cACnB,OAAO9J,QAAQ,CAACkD,GAAG,CAAC,CAAC6G,CAAC,EAAEC,CAAC,KAAK;gBAC5B,MAAMC,OAAO,GAAG,IAAI3E,IAAI,CAACyE,CAAC,CAACvE,MAAM,IAAIuE,CAAC,CAACtE,SAAS,CAAC,CAACQ,YAAY,CAAC,CAAC;gBAChE,MAAMiE,QAAQ,GAAGJ,QAAQ,KAAKG,OAAO;gBACrCH,QAAQ,GAAGG,OAAO;gBAClB,oBACE9K,OAAA,CAACP,KAAK,CAACQ,QAAQ;kBAAAuJ,QAAA,GACZuB,QAAQ,iBACP/K,OAAA;oBAAKuJ,SAAS,EAAC,mBAAmB;oBAAAC,QAAA,EAAE9C,UAAU,CAACkE,CAAC,CAACvE,MAAM,IAAIuE,CAAC,CAACtE,SAAS;kBAAC;oBAAAmD,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAM,CAC9E,eACD5J,OAAA;oBACEuJ,SAAS,EAAE,qBAAqBzD,cAAc,CAAC8E,CAAC,CAACzC,UAAU,CAAC,EAAG;oBAC/DmC,KAAK,EAAE;sBAAEU,SAAS,EAAElF,cAAc,CAAC8E,CAAC,CAACzC,UAAU,CAAC,KAAK,OAAO,GAAG,UAAU,GAAG;oBAAa,CAAE;oBAAAqB,QAAA,gBAE3FxJ,OAAA;sBAAKuJ,SAAS,EAAC,iBAAiB;sBAACe,KAAK,EAAE;wBAAEW,QAAQ,EAAE,UAAU;wBAAEC,OAAO,EAAE,MAAM;wBAAEC,aAAa,EAAE,KAAK;wBAAEC,UAAU,EAAE,QAAQ;wBAAEC,GAAG,EAAE;sBAAM,CAAE;sBAAA7B,QAAA,gBACtIxJ,OAAA;wBAAMuJ,SAAS,EAAC,WAAW;wBAAAC,QAAA,EAC1B1D,cAAc,CAAC8E,CAAC,CAACzC,UAAU,CAAC,KAAK,OAAO,GAAG,KAAK,GAAG,CAAAxH,eAAe,aAAfA,eAAe,uBAAfA,eAAe,CAAE0D,SAAS,MAAKjE,QAAQ,KAAK,SAAS,GAAG,QAAQ,GAAG,SAAS;sBAAC;wBAAAqJ,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAC7H,CAAC,EACNnI,WAAW,IAAImJ,CAAC,CAACzC,UAAU,KAAK1G,WAAW,CAACc,GAAG,IAAIkE,kBAAkB,CAACmE,CAAC,CAAC,iBACvE5K,OAAA;wBACEuJ,SAAS,EAAC,aAAa;wBACvBe,KAAK,EAAE;0BAAEgB,UAAU,EAAE,MAAM;0BAAEC,MAAM,EAAE,MAAM;0BAAEf,KAAK,EAAE,SAAS;0BAAED,QAAQ,EAAE,KAAK;0BAAEiB,MAAM,EAAE,SAAS;0BAAEC,OAAO,EAAE,CAAC;0BAAEP,OAAO,EAAE,MAAM;0BAAEQ,aAAa,EAAE;wBAAS,CAAE;wBAC1JtB,OAAO,EAAEA,CAAA,KAAM5I,gBAAgB,CAACD,aAAa,KAAKqJ,CAAC,CAACrI,GAAG,GAAG,IAAI,GAAGqI,CAAC,CAACrI,GAAG,CAAE;wBACxE,cAAW,cAAc;wBAAAiH,QAAA,EAC1B;sBAAM;wBAAAC,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAChB;oBAAA;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OACE,CAAC,EACLzI,MAAM,KAAKyJ,CAAC,CAACrI,GAAG,gBACfvC,OAAA,CAAAE,SAAA;sBAAAsJ,QAAA,gBACExJ,OAAA;wBAAO+J,KAAK,EAAE1I,QAAS;wBAAC2I,QAAQ,EAAEC,CAAC,IAAI3I,WAAW,CAAC2I,CAAC,CAACC,MAAM,CAACH,KAAK;sBAAE;wBAAAN,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAE,CAAC,eACtE5J,OAAA;wBAAQuJ,SAAS,EAAC,aAAa;wBAACa,OAAO,EAAEA,CAAA,KAAMxB,cAAc,CAACgC,CAAC,CAACrI,GAAG,CAAE;wBAAAiH,QAAA,EAAC;sBAAI;wBAAAC,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAAC,eACnF5J,OAAA;wBAAQuJ,SAAS,EAAC,aAAa;wBAACa,OAAO,EAAEA,CAAA,KAAMhJ,SAAS,CAAC,IAAI,CAAE;wBAAAoI,QAAA,EAAC;sBAAM;wBAAAC,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAQ,CAAC;oBAAA,eAC/E,CAAC,gBAEH5J,OAAA,CAAAE,SAAA;sBAAAsJ,QAAA,gBACExJ,OAAA;wBAAMuJ,SAAS,EAAC,SAAS;wBAAAC,QAAA,EAAEoB,CAAC,CAACvC;sBAAc;wBAAAoB,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAO,CAAC,eACnD5J,OAAA;wBAAMuJ,SAAS,EAAC,SAAS;wBAACe,KAAK,EAAE;0BAAEY,OAAO,EAAE,OAAO;0BAAES,SAAS,EAAE,CAAC;0BAAEC,SAAS,EAAE,OAAO;0BAAEpB,KAAK,EAAE,MAAM;0BAAED,QAAQ,EAAE;wBAAS,CAAE;wBAAAf,QAAA,EAAEnC,UAAU,CAACuD,CAAC,CAACvE,MAAM,IAAIuE,CAAC,CAACtE,SAAS;sBAAC;wBAAAmD,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAO,CAAC,EACvKnI,WAAW,IAAImJ,CAAC,CAACzC,UAAU,KAAK1G,WAAW,CAACc,GAAG,IAAIkE,kBAAkB,CAACmE,CAAC,CAAC,IAAIrJ,aAAa,KAAKqJ,CAAC,CAACrI,GAAG,iBAClGvC,OAAA;wBACEuJ,SAAS,EAAC,kBAAkB;wBAC5Be,KAAK,EAAE;0BAAEuB,KAAK,EAAE,MAAM;0BAAEX,OAAO,EAAE,MAAM;0BAAEC,aAAa,EAAE,KAAK;0BAAEW,cAAc,EAAE,QAAQ;0BAAET,GAAG,EAAE,KAAK;0BAAEM,SAAS,EAAE;wBAAE,CAAE;wBAAAnC,QAAA,GAEnHxD,cAAc,CAAC4E,CAAC,CAAC,iBAAI5K,OAAA;0BAAQuJ,SAAS,EAAC,qBAAqB;0BAACa,OAAO,EAAEA,CAAA,KAAM;4BAAEhJ,SAAS,CAACwJ,CAAC,CAACrI,GAAG,CAAC;4BAAEjB,WAAW,CAACsJ,CAAC,CAACvC,cAAc,CAAC;4BAAE7G,gBAAgB,CAAC,IAAI,CAAC;0BAAE,CAAE;0BAAAgI,QAAA,EAAC;wBAAI;0BAAAC,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAAQ,CAAC,EACvKpD,gBAAgB,CAACoE,CAAC,CAAC,iBAAI5K,OAAA;0BAAQuJ,SAAS,EAAC,uBAAuB;0BAACa,OAAO,EAAEA,CAAA,KAAM;4BAAEtB,YAAY,CAAC8B,CAAC,CAACrI,GAAG,CAAC;4BAAEf,gBAAgB,CAAC,IAAI,CAAC;0BAAE,CAAE;0BAAAgI,QAAA,EAAC;wBAAM;0BAAAC,QAAA,EAAAC,YAAA;0BAAAC,UAAA;0BAAAC,YAAA;wBAAA,OAAQ,CAAC;sBAAA;wBAAAH,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAC/I,CACN;oBAAA,eACD,CACH;kBAAA;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACE,CAAC;gBAAA,GA1CagB,CAAC,CAACrI,GAAG;kBAAAkH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OA2CV,CAAC;cAErB,CAAC,CAAC;YACJ,CAAC,EAAE;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACK,CAAC,eAGN5J,OAAA;YAAKuJ,SAAS,EAAC,cAAc;YAAAC,QAAA,gBAC3BxJ,OAAA;cACE6J,IAAI,EAAC,MAAM;cACXE,KAAK,EAAEhJ,KAAM;cACbiJ,QAAQ,EAAEC,CAAC,IAAIjJ,QAAQ,CAACiJ,CAAC,CAACC,MAAM,CAACH,KAAK,CAAE;cACxCD,WAAW,EAAC,sBAAsB;cAClCiC,SAAS,EAAE9B,CAAC,IAAI;gBAAE,IAAIA,CAAC,CAAC+B,GAAG,KAAK,OAAO,EAAEjE,UAAU,CAAC,CAAC;cAAE;YAAE;cAAA0B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC1D,CAAC,eACF5J,OAAA;cAAQuJ,SAAS,EAAC,aAAa;cAACa,OAAO,EAAErC,UAAW;cAAAyB,QAAA,EAAC;YAAI;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC/D,CAAC;QAAA,eACN;MACH;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAACvJ,EAAA,CAnhBIF,cAAc;AAAA8L,EAAA,GAAd9L,cAAc;AAqhBpB,eAAeA,cAAc;AAAC,IAAA8L,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}