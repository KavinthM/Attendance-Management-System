{"ast":null,"code":"// @ts-check\n\nimport { Block } from '../../../abstract/Block.js';\nimport { debounce } from '../../utils/debounce.js';\nimport { throttle } from '../../utils/throttle.js';\nimport { clamp, constraintRect, isRectInsideRect, isRectMatchesAspectRatio, rotateSize, roundRect } from './crop-utils.js';\nimport { CROP_PADDING } from './cropper-constants.js';\nimport { classNames } from './lib/classNames.js';\nimport { pick } from './lib/pick.js';\nimport { preloadImage } from '../../utils/preloadImage.js';\nimport { viewerImageSrc } from './util.js';\n\n/**\n * @typedef {Object} Operations\n * @property {boolean} flip\n * @property {boolean} mirror\n * @property {Number} rotate\n */\n\n/**\n * @param {import('./types.js').Transformations['crop']} crop\n * @returns {boolean}\n */\nfunction validateCrop(crop) {\n  if (!crop) {\n    return true;\n  }\n  /** @type {((arg: NonNullable<typeof crop>) => boolean)[]} */\n  let shouldMatch = [({\n    dimensions,\n    coords\n  }) => [...dimensions, ...coords].every(number => Number.isInteger(number) && Number.isFinite(number)), ({\n    dimensions,\n    coords\n  }) => dimensions.every(d => d > 0) && coords.every(c => c >= 0)];\n  return shouldMatch.every(matcher => matcher(crop));\n}\nexport class EditorImageCropper extends Block {\n  ctxOwner = true;\n  constructor() {\n    super();\n    this.init$ = {\n      ...this.init$,\n      image: null,\n      '*padding': CROP_PADDING,\n      /** @type {Operations} */\n      '*operations': {\n        rotate: 0,\n        mirror: false,\n        flip: false\n      },\n      /** @type {import('./types.js').Rectangle} */\n      '*imageBox': {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n      },\n      /** @type {import('./types.js').Rectangle} */\n      '*cropBox': {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0\n      }\n    };\n\n    /** @private */\n    this._commitDebounced = debounce(this._commit.bind(this), 300);\n\n    /** @private */\n    this._handleResizeThrottled = throttle(this._handleResize.bind(this), 100);\n    this._imageSize = {\n      width: 0,\n      height: 0\n    };\n  }\n\n  /** @private */\n  _handleResize() {\n    if (!this.isConnected || !this._isActive) {\n      return;\n    }\n    this._initCanvas();\n    this._syncTransformations();\n    this._alignImage();\n    this._alignCrop();\n    this._draw();\n  }\n\n  /** @private */\n  _syncTransformations() {\n    let transformations = this.$['*editorTransformations'];\n    let pickedTransformations = pick(transformations, Object.keys(this.$['*operations']));\n    let operations = {\n      ...this.$['*operations'],\n      ...pickedTransformations\n    };\n    this.$['*operations'] = operations;\n  }\n\n  /** @private */\n  _initCanvas() {\n    /** @type {HTMLCanvasElement} */\n    let canvas = this.ref['canvas-el'];\n    let ctx = canvas.getContext('2d');\n    let width = this.offsetWidth;\n    let height = this.offsetHeight;\n    let dpr = window.devicePixelRatio;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    ctx?.scale(dpr, dpr);\n    this._canvas = canvas;\n    this._ctx = ctx;\n  }\n\n  /** @private */\n  _alignImage() {\n    if (!this._isActive || !this.$.image) {\n      return;\n    }\n    let image = this.$.image;\n    let padding = this.$['*padding'];\n    let operations = this.$['*operations'];\n    let {\n      rotate\n    } = operations;\n    let bounds = {\n      width: this.offsetWidth,\n      height: this.offsetHeight\n    };\n    let naturalSize = rotateSize({\n      width: image.naturalWidth,\n      height: image.naturalHeight\n    }, rotate);\n    let imageBox;\n    if (naturalSize.width > bounds.width - padding * 2 || naturalSize.height > bounds.height - padding * 2) {\n      let imageAspectRatio = naturalSize.width / naturalSize.height;\n      let viewportAspectRatio = bounds.width / bounds.height;\n      if (imageAspectRatio > viewportAspectRatio) {\n        let width = bounds.width - padding * 2;\n        let height = width / imageAspectRatio;\n        let x = 0 + padding;\n        let y = padding + (bounds.height - padding * 2) / 2 - height / 2;\n        imageBox = {\n          x,\n          y,\n          width,\n          height\n        };\n      } else {\n        let height = bounds.height - padding * 2;\n        let width = height * imageAspectRatio;\n        let x = padding + (bounds.width - padding * 2) / 2 - width / 2;\n        let y = 0 + padding;\n        imageBox = {\n          x,\n          y,\n          width,\n          height\n        };\n      }\n    } else {\n      let {\n        width,\n        height\n      } = naturalSize;\n      let x = padding + (bounds.width - padding * 2) / 2 - width / 2;\n      let y = padding + (bounds.height - padding * 2) / 2 - height / 2;\n      imageBox = {\n        x,\n        y,\n        width,\n        height\n      };\n    }\n    this.$['*imageBox'] = roundRect(imageBox);\n  }\n\n  /** @private */\n  _alignCrop() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let {\n      rotate\n    } = operations;\n    let cropTransformation = this.$['*editorTransformations']['crop'];\n    let {\n      width: previewWidth,\n      x: previewX,\n      y: previewY\n    } = this.$['*imageBox'];\n    if (cropTransformation) {\n      let {\n        dimensions: [width, height],\n        coords: [x, y]\n      } = cropTransformation;\n      let {\n        width: sourceWidth\n      } = rotateSize(this._imageSize, rotate);\n      let ratio = previewWidth / sourceWidth;\n      cropBox = constraintRect(roundRect({\n        x: previewX + x * ratio,\n        y: previewY + y * ratio,\n        width: width * ratio,\n        height: height * ratio\n      }), this.$['*imageBox']);\n    }\n\n    /** @type {import('./types.js').CropPresetList[0] | undefined} */\n    const cropPreset = this.$['*cropPresetList']?.[0];\n    const cropAspectRatio = cropPreset ? cropPreset.width / cropPreset.height : undefined;\n    if (!isRectInsideRect(cropBox, imageBox) || cropAspectRatio && !isRectMatchesAspectRatio(cropBox, cropAspectRatio)) {\n      const imageAspectRatio = imageBox.width / imageBox.height;\n      let width = imageBox.width;\n      let height = imageBox.height;\n      if (cropAspectRatio) {\n        if (imageAspectRatio > cropAspectRatio) {\n          width = Math.min(imageBox.height * cropAspectRatio, imageBox.width);\n        } else {\n          height = Math.min(imageBox.width / cropAspectRatio, imageBox.height);\n        }\n      }\n      cropBox = {\n        x: imageBox.x + imageBox.width / 2 - width / 2,\n        y: imageBox.y + imageBox.height / 2 - height / 2,\n        width,\n        height\n      };\n    }\n    this.$['*cropBox'] = constraintRect(roundRect(cropBox), this.$['*imageBox']);\n  }\n\n  /** @private */\n  _drawImage() {\n    let ctx = this._ctx;\n    if (!ctx) return;\n    let image = this.$.image;\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let {\n      mirror,\n      flip,\n      rotate\n    } = operations;\n    let rotated = rotateSize({\n      width: imageBox.width,\n      height: imageBox.height\n    }, rotate);\n    ctx.save();\n    ctx.translate(imageBox.x + imageBox.width / 2, imageBox.y + imageBox.height / 2);\n    ctx.rotate(rotate * Math.PI * -1 / 180);\n    ctx.scale(mirror ? -1 : 1, flip ? -1 : 1);\n    ctx.drawImage(image, -rotated.width / 2, -rotated.height / 2, rotated.width, rotated.height);\n    ctx.restore();\n  }\n\n  /** @private */\n  _draw() {\n    if (!this._isActive || !this.$.image || !this._canvas || !this._ctx) {\n      return;\n    }\n    let canvas = this._canvas;\n    let ctx = this._ctx;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    this._drawImage();\n  }\n\n  /**\n   * @private\n   * @param {{ fromViewer?: boolean }} options\n   */\n  _animateIn({\n    fromViewer\n  }) {\n    if (this.$.image) {\n      this.ref['frame-el'].toggleThumbs(true);\n      this._transitionToImage();\n      setTimeout(() => {\n        this.className = classNames({\n          'uc-active_from_viewer': fromViewer,\n          'uc-active_from_editor': !fromViewer,\n          'uc-inactive_to_editor': false\n        });\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {NonNullable<import('./types.js').Transformations['crop']>['dimensions']}\n   */\n  _getCropDimensions() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let {\n      rotate\n    } = operations;\n    let {\n      width: previewWidth,\n      height: previewHeight\n    } = imageBox;\n    let {\n      width: sourceWidth,\n      height: sourceHeight\n    } = rotateSize(this._imageSize, rotate);\n    let {\n      width: cropWidth,\n      height: cropHeight\n    } = cropBox;\n    let ratioW = previewWidth / sourceWidth;\n    let ratioH = previewHeight / sourceHeight;\n\n    /** @type {[Number, Number]} */\n    let dimensions = [clamp(Math.round(cropWidth / ratioW), 1, sourceWidth), clamp(Math.round(cropHeight / ratioH), 1, sourceHeight)];\n    return dimensions;\n  }\n\n  /**\n   * @private\n   * @returns {import('./types.js').Transformations['crop']}\n   */\n  _getCropTransformation() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let {\n      rotate\n    } = operations;\n    let {\n      width: previewWidth,\n      height: previewHeight,\n      x: previewX,\n      y: previewY\n    } = imageBox;\n    let {\n      width: sourceWidth,\n      height: sourceHeight\n    } = rotateSize(this._imageSize, rotate);\n    let {\n      x: cropX,\n      y: cropY\n    } = cropBox;\n    let ratioW = previewWidth / sourceWidth;\n    let ratioH = previewHeight / sourceHeight;\n    let dimensions = this._getCropDimensions();\n    let crop = {\n      dimensions,\n      coords: (/** @type {[Number, Number]} */[clamp(Math.round((cropX - previewX) / ratioW), 0, sourceWidth - dimensions[0]), clamp(Math.round((cropY - previewY) / ratioH), 0, sourceHeight - dimensions[1])])\n    };\n    if (!validateCrop(crop)) {\n      console.error('Cropper is trying to create invalid crop object', {\n        payload: crop\n      });\n      return undefined;\n    }\n    if (dimensions[0] === sourceWidth && dimensions[1] === sourceHeight) {\n      return undefined;\n    }\n    return crop;\n  }\n\n  /** @private */\n  _commit() {\n    if (!this.isConnected || !this._imageSize) {\n      return;\n    }\n    let operations = this.$['*operations'];\n    let {\n      rotate,\n      mirror,\n      flip\n    } = operations;\n    let crop = this._getCropTransformation();\n    /** @type {import('./types.js').Transformations} */\n    let editorTransformations = this.$['*editorTransformations'];\n    let transformations = {\n      ...editorTransformations,\n      crop,\n      rotate,\n      mirror,\n      flip\n    };\n    this.$['*editorTransformations'] = transformations;\n  }\n\n  /**\n   * @param {String} operation\n   * @param {Number} value\n   * @returns {void}\n   */\n  setValue(operation, value) {\n    this.$['*operations'] = {\n      ...this.$['*operations'],\n      [operation]: value\n    };\n    if (!this._isActive) {\n      return;\n    }\n    this._alignImage();\n    this._alignCrop();\n    this._draw();\n  }\n\n  /**\n   * @param {keyof Operations} operation\n   * @returns {Number | boolean}\n   */\n  getValue(operation) {\n    return this.$['*operations'][operation];\n  }\n\n  /**\n   * @param {import('./types.js').ImageSize} imageSize\n   * @param {{ fromViewer?: boolean }} options\n   */\n  async activate(imageSize, {\n    fromViewer\n  } = {}) {\n    if (this._isActive) {\n      return;\n    }\n    this._isActive = true;\n    this._imageSize = imageSize;\n    this.removeEventListener('transitionend', this._reset);\n    try {\n      this.$.image = await this._waitForImage(this.$['*originalUrl'], this.$['*editorTransformations']);\n      this._syncTransformations();\n      this._animateIn({\n        fromViewer\n      });\n    } catch (err) {\n      console.error('Failed to activate cropper', {\n        error: err\n      });\n    }\n    this._observer = new ResizeObserver(([entry]) => {\n      const nonZeroSize = entry.contentRect.width > 0 && entry.contentRect.height > 0;\n      if (nonZeroSize && this._isActive && this.$.image) {\n        this._handleResizeThrottled();\n      }\n    });\n    this._observer.observe(this);\n  }\n  deactivate({\n    reset = false\n  } = {}) {\n    if (!this._isActive) {\n      return;\n    }\n    !reset && this._commit();\n    this._isActive = false;\n    this._transitionToCrop();\n    this.className = classNames({\n      'uc-active_from_viewer': false,\n      'uc-active_from_editor': false,\n      'uc-inactive_to_editor': true\n    });\n    this.ref['frame-el'].toggleThumbs(false);\n    this.addEventListener('transitionend', this._reset, {\n      once: true\n    });\n    this._observer?.disconnect();\n  }\n\n  /** @private */\n  _transitionToCrop() {\n    let dimensions = this._getCropDimensions();\n    let scaleX = Math.min(this.offsetWidth, dimensions[0]) / this.$['*cropBox'].width;\n    let scaleY = Math.min(this.offsetHeight, dimensions[1]) / this.$['*cropBox'].height;\n    let scale = Math.min(scaleX, scaleY);\n    let cropCenterX = this.$['*cropBox'].x + this.$['*cropBox'].width / 2;\n    let cropCenterY = this.$['*cropBox'].y + this.$['*cropBox'].height / 2;\n    this.style.transform = `scale(${scale}) translate(${(this.offsetWidth / 2 - cropCenterX) / scale}px, ${(this.offsetHeight / 2 - cropCenterY) / scale}px)`;\n    this.style.transformOrigin = `${cropCenterX}px ${cropCenterY}px`;\n  }\n\n  /** @private */\n  _transitionToImage() {\n    let cropCenterX = this.$['*cropBox'].x + this.$['*cropBox'].width / 2;\n    let cropCenterY = this.$['*cropBox'].y + this.$['*cropBox'].height / 2;\n    this.style.transform = `scale(1)`;\n    this.style.transformOrigin = `${cropCenterX}px ${cropCenterY}px`;\n  }\n\n  /** @private */\n  _reset() {\n    if (this._isActive) {\n      return;\n    }\n    this.$.image = null;\n  }\n\n  /**\n   * @private\n   * @param {String} originalUrl\n   * @param {import('./types.js').Transformations} transformations\n   * @returns {Promise<HTMLImageElement>}\n   */\n  async _waitForImage(originalUrl, transformations) {\n    let width = this.offsetWidth;\n    transformations = {\n      ...transformations,\n      crop: undefined,\n      rotate: undefined,\n      flip: undefined,\n      mirror: undefined\n    };\n    let src = await this.proxyUrl(viewerImageSrc(originalUrl, width, transformations));\n    let {\n      promise,\n      cancel,\n      image\n    } = preloadImage(src);\n    let stop = this._handleImageLoading(src);\n    image.addEventListener('load', stop, {\n      once: true\n    });\n    image.addEventListener('error', stop, {\n      once: true\n    });\n    this._cancelPreload?.();\n    this._cancelPreload = cancel;\n    return promise.then(() => image).catch(err => {\n      console.error('Failed to load image', {\n        error: err\n      });\n      this.$['*networkProblems'] = true;\n      return Promise.resolve(image);\n    });\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   * @returns {() => void} Destructor\n   */\n  _handleImageLoading(src) {\n    let operation = 'crop';\n    let loadingOperations = this.$['*loadingOperations'];\n    if (!loadingOperations.get(operation)) {\n      loadingOperations.set(operation, new Map());\n    }\n    if (!loadingOperations.get(operation).get(src)) {\n      loadingOperations.set(operation, loadingOperations.get(operation).set(src, true));\n      this.$['*loadingOperations'] = loadingOperations;\n    }\n    return () => {\n      if (loadingOperations?.get(operation)?.has(src)) {\n        loadingOperations.get(operation).delete(src);\n        this.$['*loadingOperations'] = loadingOperations;\n      }\n    };\n  }\n  initCallback() {\n    super.initCallback();\n    this.sub('*imageBox', () => {\n      this._draw();\n    });\n    this.sub('*cropBox', () => {\n      if (this.$.image) {\n        this._commitDebounced();\n      }\n    });\n    this.sub('*cropPresetList', () => {\n      this._alignCrop();\n    });\n    setTimeout(() => {\n      this.sub('*networkProblems', networkProblems => {\n        if (!networkProblems) {\n          this._isActive && this.activate(this._imageSize, {\n            fromViewer: false\n          });\n        }\n      });\n    }, 0);\n  }\n  destroyCallback() {\n    super.destroyCallback();\n    this._observer?.disconnect();\n  }\n}\nEditorImageCropper.template = /* HTML */`\n  <canvas class=\"uc-canvas\" ref=\"canvas-el\"></canvas>\n  <uc-crop-frame ref=\"frame-el\"></uc-crop-frame>\n`;","map":{"version":3,"names":["Block","debounce","throttle","clamp","constraintRect","isRectInsideRect","isRectMatchesAspectRatio","rotateSize","roundRect","CROP_PADDING","classNames","pick","preloadImage","viewerImageSrc","validateCrop","crop","shouldMatch","dimensions","coords","every","number","Number","isInteger","isFinite","d","c","matcher","EditorImageCropper","ctxOwner","constructor","init$","image","rotate","mirror","flip","x","y","width","height","_commitDebounced","_commit","bind","_handleResizeThrottled","_handleResize","_imageSize","isConnected","_isActive","_initCanvas","_syncTransformations","_alignImage","_alignCrop","_draw","transformations","$","pickedTransformations","Object","keys","operations","canvas","ref","ctx","getContext","offsetWidth","offsetHeight","dpr","window","devicePixelRatio","style","scale","_canvas","_ctx","padding","bounds","naturalSize","naturalWidth","naturalHeight","imageBox","imageAspectRatio","viewportAspectRatio","cropBox","cropTransformation","previewWidth","previewX","previewY","sourceWidth","ratio","cropPreset","cropAspectRatio","undefined","Math","min","_drawImage","rotated","save","translate","PI","drawImage","restore","clearRect","_animateIn","fromViewer","toggleThumbs","_transitionToImage","setTimeout","className","_getCropDimensions","previewHeight","sourceHeight","cropWidth","cropHeight","ratioW","ratioH","round","_getCropTransformation","cropX","cropY","console","error","payload","editorTransformations","setValue","operation","value","getValue","activate","imageSize","removeEventListener","_reset","_waitForImage","err","_observer","ResizeObserver","entry","nonZeroSize","contentRect","observe","deactivate","reset","_transitionToCrop","addEventListener","once","disconnect","scaleX","scaleY","cropCenterX","cropCenterY","transform","transformOrigin","originalUrl","src","proxyUrl","promise","cancel","stop","_handleImageLoading","_cancelPreload","then","catch","Promise","resolve","loadingOperations","get","set","Map","has","delete","initCallback","sub","networkProblems","destroyCallback","template"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/blocks/CloudImageEditor/src/EditorImageCropper.js"],"sourcesContent":["// @ts-check\n\nimport { Block } from '../../../abstract/Block.js';\nimport { debounce } from '../../utils/debounce.js';\nimport { throttle } from '../../utils/throttle.js';\nimport {\n  clamp,\n  constraintRect,\n  isRectInsideRect,\n  isRectMatchesAspectRatio,\n  rotateSize,\n  roundRect,\n} from './crop-utils.js';\nimport { CROP_PADDING } from './cropper-constants.js';\nimport { classNames } from './lib/classNames.js';\nimport { pick } from './lib/pick.js';\nimport { preloadImage } from '../../utils/preloadImage.js';\nimport { viewerImageSrc } from './util.js';\n\n/**\n * @typedef {Object} Operations\n * @property {boolean} flip\n * @property {boolean} mirror\n * @property {Number} rotate\n */\n\n/**\n * @param {import('./types.js').Transformations['crop']} crop\n * @returns {boolean}\n */\nfunction validateCrop(crop) {\n  if (!crop) {\n    return true;\n  }\n  /** @type {((arg: NonNullable<typeof crop>) => boolean)[]} */\n  let shouldMatch = [\n    ({ dimensions, coords }) =>\n      [...dimensions, ...coords].every((number) => Number.isInteger(number) && Number.isFinite(number)),\n    ({ dimensions, coords }) => dimensions.every((d) => d > 0) && coords.every((c) => c >= 0),\n  ];\n  return shouldMatch.every((matcher) => matcher(crop));\n}\n\nexport class EditorImageCropper extends Block {\n  ctxOwner = true;\n  constructor() {\n    super();\n\n    this.init$ = {\n      ...this.init$,\n      image: null,\n      '*padding': CROP_PADDING,\n      /** @type {Operations} */\n      '*operations': {\n        rotate: 0,\n        mirror: false,\n        flip: false,\n      },\n      /** @type {import('./types.js').Rectangle} */\n      '*imageBox': {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n      },\n      /** @type {import('./types.js').Rectangle} */\n      '*cropBox': {\n        x: 0,\n        y: 0,\n        width: 0,\n        height: 0,\n      },\n    };\n\n    /** @private */\n    this._commitDebounced = debounce(this._commit.bind(this), 300);\n\n    /** @private */\n    this._handleResizeThrottled = throttle(this._handleResize.bind(this), 100);\n\n    this._imageSize = { width: 0, height: 0 };\n  }\n\n  /** @private */\n  _handleResize() {\n    if (!this.isConnected || !this._isActive) {\n      return;\n    }\n    this._initCanvas();\n    this._syncTransformations();\n    this._alignImage();\n    this._alignCrop();\n    this._draw();\n  }\n\n  /** @private */\n  _syncTransformations() {\n    let transformations = this.$['*editorTransformations'];\n    let pickedTransformations = pick(transformations, Object.keys(this.$['*operations']));\n    let operations = { ...this.$['*operations'], ...pickedTransformations };\n    this.$['*operations'] = operations;\n  }\n\n  /** @private */\n  _initCanvas() {\n    /** @type {HTMLCanvasElement} */\n    let canvas = this.ref['canvas-el'];\n    let ctx = canvas.getContext('2d');\n\n    let width = this.offsetWidth;\n    let height = this.offsetHeight;\n    let dpr = window.devicePixelRatio;\n    canvas.style.width = `${width}px`;\n    canvas.style.height = `${height}px`;\n    canvas.width = width * dpr;\n    canvas.height = height * dpr;\n    ctx?.scale(dpr, dpr);\n\n    this._canvas = canvas;\n    this._ctx = ctx;\n  }\n\n  /** @private */\n  _alignImage() {\n    if (!this._isActive || !this.$.image) {\n      return;\n    }\n\n    let image = this.$.image;\n    let padding = this.$['*padding'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n\n    let bounds = { width: this.offsetWidth, height: this.offsetHeight };\n    let naturalSize = rotateSize({ width: image.naturalWidth, height: image.naturalHeight }, rotate);\n    let imageBox;\n\n    if (naturalSize.width > bounds.width - padding * 2 || naturalSize.height > bounds.height - padding * 2) {\n      let imageAspectRatio = naturalSize.width / naturalSize.height;\n      let viewportAspectRatio = bounds.width / bounds.height;\n\n      if (imageAspectRatio > viewportAspectRatio) {\n        let width = bounds.width - padding * 2;\n        let height = width / imageAspectRatio;\n        let x = 0 + padding;\n        let y = padding + (bounds.height - padding * 2) / 2 - height / 2;\n        imageBox = { x, y, width, height };\n      } else {\n        let height = bounds.height - padding * 2;\n        let width = height * imageAspectRatio;\n        let x = padding + (bounds.width - padding * 2) / 2 - width / 2;\n        let y = 0 + padding;\n        imageBox = { x, y, width, height };\n      }\n    } else {\n      let { width, height } = naturalSize;\n      let x = padding + (bounds.width - padding * 2) / 2 - width / 2;\n      let y = padding + (bounds.height - padding * 2) / 2 - height / 2;\n      imageBox = { x, y, width, height };\n    }\n\n    this.$['*imageBox'] = roundRect(imageBox);\n  }\n\n  /** @private */\n  _alignCrop() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n    let cropTransformation = this.$['*editorTransformations']['crop'];\n    let { width: previewWidth, x: previewX, y: previewY } = this.$['*imageBox'];\n\n    if (cropTransformation) {\n      let {\n        dimensions: [width, height],\n        coords: [x, y],\n      } = cropTransformation;\n      let { width: sourceWidth } = rotateSize(this._imageSize, rotate);\n      let ratio = previewWidth / sourceWidth;\n      cropBox = constraintRect(\n        roundRect({\n          x: previewX + x * ratio,\n          y: previewY + y * ratio,\n          width: width * ratio,\n          height: height * ratio,\n        }),\n        this.$['*imageBox'],\n      );\n    }\n\n    /** @type {import('./types.js').CropPresetList[0] | undefined} */\n    const cropPreset = this.$['*cropPresetList']?.[0];\n    const cropAspectRatio = cropPreset ? cropPreset.width / cropPreset.height : undefined;\n\n    if (\n      !isRectInsideRect(cropBox, imageBox) ||\n      (cropAspectRatio && !isRectMatchesAspectRatio(cropBox, cropAspectRatio))\n    ) {\n      const imageAspectRatio = imageBox.width / imageBox.height;\n      let width = imageBox.width;\n      let height = imageBox.height;\n      if (cropAspectRatio) {\n        if (imageAspectRatio > cropAspectRatio) {\n          width = Math.min(imageBox.height * cropAspectRatio, imageBox.width);\n        } else {\n          height = Math.min(imageBox.width / cropAspectRatio, imageBox.height);\n        }\n      }\n      cropBox = {\n        x: imageBox.x + imageBox.width / 2 - width / 2,\n        y: imageBox.y + imageBox.height / 2 - height / 2,\n        width,\n        height,\n      };\n    }\n\n    this.$['*cropBox'] = constraintRect(roundRect(cropBox), this.$['*imageBox']);\n  }\n\n  /** @private */\n  _drawImage() {\n    let ctx = this._ctx;\n    if (!ctx) return;\n    let image = this.$.image;\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { mirror, flip, rotate } = operations;\n    let rotated = rotateSize({ width: imageBox.width, height: imageBox.height }, rotate);\n    ctx.save();\n    ctx.translate(imageBox.x + imageBox.width / 2, imageBox.y + imageBox.height / 2);\n    ctx.rotate((rotate * Math.PI * -1) / 180);\n    ctx.scale(mirror ? -1 : 1, flip ? -1 : 1);\n    ctx.drawImage(image, -rotated.width / 2, -rotated.height / 2, rotated.width, rotated.height);\n    ctx.restore();\n  }\n\n  /** @private */\n  _draw() {\n    if (!this._isActive || !this.$.image || !this._canvas || !this._ctx) {\n      return;\n    }\n    let canvas = this._canvas;\n    let ctx = this._ctx;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    this._drawImage();\n  }\n\n  /**\n   * @private\n   * @param {{ fromViewer?: boolean }} options\n   */\n  _animateIn({ fromViewer }) {\n    if (this.$.image) {\n      this.ref['frame-el'].toggleThumbs(true);\n      this._transitionToImage();\n      setTimeout(() => {\n        this.className = classNames({\n          'uc-active_from_viewer': fromViewer,\n          'uc-active_from_editor': !fromViewer,\n          'uc-inactive_to_editor': false,\n        });\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {NonNullable<import('./types.js').Transformations['crop']>['dimensions']}\n   */\n  _getCropDimensions() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n    let { width: previewWidth, height: previewHeight } = imageBox;\n    let { width: sourceWidth, height: sourceHeight } = rotateSize(this._imageSize, rotate);\n    let { width: cropWidth, height: cropHeight } = cropBox;\n    let ratioW = previewWidth / sourceWidth;\n    let ratioH = previewHeight / sourceHeight;\n\n    /** @type {[Number, Number]} */\n    let dimensions = [\n      clamp(Math.round(cropWidth / ratioW), 1, sourceWidth),\n      clamp(Math.round(cropHeight / ratioH), 1, sourceHeight),\n    ];\n\n    return dimensions;\n  }\n\n  /**\n   * @private\n   * @returns {import('./types.js').Transformations['crop']}\n   */\n  _getCropTransformation() {\n    let cropBox = this.$['*cropBox'];\n    let imageBox = this.$['*imageBox'];\n    let operations = this.$['*operations'];\n    let { rotate } = operations;\n    let { width: previewWidth, height: previewHeight, x: previewX, y: previewY } = imageBox;\n    let { width: sourceWidth, height: sourceHeight } = rotateSize(this._imageSize, rotate);\n    let { x: cropX, y: cropY } = cropBox;\n    let ratioW = previewWidth / sourceWidth;\n    let ratioH = previewHeight / sourceHeight;\n\n    let dimensions = this._getCropDimensions();\n    let crop = {\n      dimensions,\n      coords: /** @type {[Number, Number]} */ ([\n        clamp(Math.round((cropX - previewX) / ratioW), 0, sourceWidth - dimensions[0]),\n        clamp(Math.round((cropY - previewY) / ratioH), 0, sourceHeight - dimensions[1]),\n      ]),\n    };\n    if (!validateCrop(crop)) {\n      console.error('Cropper is trying to create invalid crop object', {\n        payload: crop,\n      });\n      return undefined;\n    }\n    if (dimensions[0] === sourceWidth && dimensions[1] === sourceHeight) {\n      return undefined;\n    }\n\n    return crop;\n  }\n\n  /** @private */\n  _commit() {\n    if (!this.isConnected || !this._imageSize) {\n      return;\n    }\n    let operations = this.$['*operations'];\n    let { rotate, mirror, flip } = operations;\n    let crop = this._getCropTransformation();\n    /** @type {import('./types.js').Transformations} */\n    let editorTransformations = this.$['*editorTransformations'];\n    let transformations = {\n      ...editorTransformations,\n      crop,\n      rotate,\n      mirror,\n      flip,\n    };\n\n    this.$['*editorTransformations'] = transformations;\n  }\n\n  /**\n   * @param {String} operation\n   * @param {Number} value\n   * @returns {void}\n   */\n  setValue(operation, value) {\n    this.$['*operations'] = {\n      ...this.$['*operations'],\n      [operation]: value,\n    };\n\n    if (!this._isActive) {\n      return;\n    }\n\n    this._alignImage();\n    this._alignCrop();\n    this._draw();\n  }\n\n  /**\n   * @param {keyof Operations} operation\n   * @returns {Number | boolean}\n   */\n  getValue(operation) {\n    return this.$['*operations'][operation];\n  }\n\n  /**\n   * @param {import('./types.js').ImageSize} imageSize\n   * @param {{ fromViewer?: boolean }} options\n   */\n  async activate(imageSize, { fromViewer } = {}) {\n    if (this._isActive) {\n      return;\n    }\n    this._isActive = true;\n    this._imageSize = imageSize;\n    this.removeEventListener('transitionend', this._reset);\n\n    try {\n      this.$.image = await this._waitForImage(this.$['*originalUrl'], this.$['*editorTransformations']);\n      this._syncTransformations();\n      this._animateIn({ fromViewer });\n    } catch (err) {\n      console.error('Failed to activate cropper', { error: err });\n    }\n\n    this._observer = new ResizeObserver(([entry]) => {\n      const nonZeroSize = entry.contentRect.width > 0 && entry.contentRect.height > 0;\n      if (nonZeroSize && this._isActive && this.$.image) {\n        this._handleResizeThrottled();\n      }\n    });\n    this._observer.observe(this);\n  }\n  deactivate({ reset = false } = {}) {\n    if (!this._isActive) {\n      return;\n    }\n    !reset && this._commit();\n    this._isActive = false;\n\n    this._transitionToCrop();\n\n    this.className = classNames({\n      'uc-active_from_viewer': false,\n      'uc-active_from_editor': false,\n      'uc-inactive_to_editor': true,\n    });\n\n    this.ref['frame-el'].toggleThumbs(false);\n    this.addEventListener('transitionend', this._reset, { once: true });\n    this._observer?.disconnect();\n  }\n\n  /** @private */\n  _transitionToCrop() {\n    let dimensions = this._getCropDimensions();\n    let scaleX = Math.min(this.offsetWidth, dimensions[0]) / this.$['*cropBox'].width;\n    let scaleY = Math.min(this.offsetHeight, dimensions[1]) / this.$['*cropBox'].height;\n    let scale = Math.min(scaleX, scaleY);\n    let cropCenterX = this.$['*cropBox'].x + this.$['*cropBox'].width / 2;\n    let cropCenterY = this.$['*cropBox'].y + this.$['*cropBox'].height / 2;\n\n    this.style.transform = `scale(${scale}) translate(${(this.offsetWidth / 2 - cropCenterX) / scale}px, ${\n      (this.offsetHeight / 2 - cropCenterY) / scale\n    }px)`;\n    this.style.transformOrigin = `${cropCenterX}px ${cropCenterY}px`;\n  }\n\n  /** @private */\n  _transitionToImage() {\n    let cropCenterX = this.$['*cropBox'].x + this.$['*cropBox'].width / 2;\n    let cropCenterY = this.$['*cropBox'].y + this.$['*cropBox'].height / 2;\n\n    this.style.transform = `scale(1)`;\n    this.style.transformOrigin = `${cropCenterX}px ${cropCenterY}px`;\n  }\n\n  /** @private */\n  _reset() {\n    if (this._isActive) {\n      return;\n    }\n    this.$.image = null;\n  }\n\n  /**\n   * @private\n   * @param {String} originalUrl\n   * @param {import('./types.js').Transformations} transformations\n   * @returns {Promise<HTMLImageElement>}\n   */\n  async _waitForImage(originalUrl, transformations) {\n    let width = this.offsetWidth;\n    transformations = {\n      ...transformations,\n      crop: undefined,\n      rotate: undefined,\n      flip: undefined,\n      mirror: undefined,\n    };\n    let src = await this.proxyUrl(viewerImageSrc(originalUrl, width, transformations));\n    let { promise, cancel, image } = preloadImage(src);\n\n    let stop = this._handleImageLoading(src);\n    image.addEventListener('load', stop, { once: true });\n    image.addEventListener('error', stop, { once: true });\n    this._cancelPreload?.();\n    this._cancelPreload = cancel;\n\n    return promise\n      .then(() => image)\n      .catch((err) => {\n        console.error('Failed to load image', { error: err });\n        this.$['*networkProblems'] = true;\n        return Promise.resolve(image);\n      });\n  }\n\n  /**\n   * @private\n   * @param {String} src\n   * @returns {() => void} Destructor\n   */\n  _handleImageLoading(src) {\n    let operation = 'crop';\n    let loadingOperations = this.$['*loadingOperations'];\n    if (!loadingOperations.get(operation)) {\n      loadingOperations.set(operation, new Map());\n    }\n\n    if (!loadingOperations.get(operation).get(src)) {\n      loadingOperations.set(operation, loadingOperations.get(operation).set(src, true));\n      this.$['*loadingOperations'] = loadingOperations;\n    }\n\n    return () => {\n      if (loadingOperations?.get(operation)?.has(src)) {\n        loadingOperations.get(operation).delete(src);\n        this.$['*loadingOperations'] = loadingOperations;\n      }\n    };\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.sub('*imageBox', () => {\n      this._draw();\n    });\n\n    this.sub('*cropBox', () => {\n      if (this.$.image) {\n        this._commitDebounced();\n      }\n    });\n\n    this.sub('*cropPresetList', () => {\n      this._alignCrop();\n    });\n\n    setTimeout(() => {\n      this.sub('*networkProblems', (networkProblems) => {\n        if (!networkProblems) {\n          this._isActive && this.activate(this._imageSize, { fromViewer: false });\n        }\n      });\n    }, 0);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    this._observer?.disconnect();\n  }\n}\n\nEditorImageCropper.template = /* HTML */ `\n  <canvas class=\"uc-canvas\" ref=\"canvas-el\"></canvas>\n  <uc-crop-frame ref=\"frame-el\"></uc-crop-frame>\n`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}