{"ast":null,"code":"// @ts-check\nimport { ActivityBlock } from './ActivityBlock.js';\nimport { Data } from '@symbiotejs/symbiote';\nimport { uploadFileGroup } from '@uploadcare/upload-client';\nimport { calculateMaxCenteredCropFrame } from '../blocks/CloudImageEditor/src/crop-utils.js';\nimport { parseCropPreset } from '../blocks/CloudImageEditor/src/lib/parseCropPreset.js';\nimport { EventType } from '../blocks/UploadCtxProvider/EventEmitter.js';\nimport { debounce } from '../blocks/utils/debounce.js';\nimport { customUserAgent } from '../blocks/utils/userAgent.js';\nimport { createCdnUrl, createCdnUrlModifiers } from '../utils/cdn-utils.js';\nimport { uploaderBlockCtx } from './CTX.js';\nimport { SecureUploadsManager } from './SecureUploadsManager.js';\nimport { TypedCollection } from './TypedCollection.js';\nimport { UploaderPublicApi } from './UploaderPublicApi.js';\nimport { ValidationManager } from './ValidationManager.js';\nimport { uploadEntrySchema } from './uploadEntrySchema.js';\nimport { ExternalUploadSource, UploadSource } from '../blocks/utils/UploadSource.js';\nexport class UploaderBlock extends ActivityBlock {\n  /** @protected */\n  couldBeCtxOwner = false;\n\n  /** @private */\n  isCtxOwner = false;\n  init$ = uploaderBlockCtx(this);\n\n  /** @private */\n  get hasCtxOwner() {\n    return this.hasBlockInCtx(block => {\n      if (block instanceof UploaderBlock) {\n        return block.isCtxOwner && block.isConnected && block !== this;\n      }\n      return false;\n    });\n  }\n\n  /** @protected */\n  initCallback() {\n    super.initCallback();\n    if (!this.has('*uploadCollection')) {\n      let uploadCollection = new TypedCollection({\n        typedSchema: uploadEntrySchema,\n        watchList: ['uploadProgress', 'uploadError', 'fileInfo', 'errors', 'cdnUrl', 'isUploading']\n      });\n      this.add('*uploadCollection', uploadCollection);\n    }\n    if (!this.has('*publicApi')) {\n      this.add('*publicApi', new UploaderPublicApi(this));\n    }\n    if (!this.has('*validationManager')) {\n      this.add('*validationManager', new ValidationManager(this));\n    }\n    if (!this.hasCtxOwner && this.couldBeCtxOwner) {\n      this.initCtxOwner();\n    }\n  }\n\n  /**\n   * @returns {ValidationManager}\n   * @protected\n   */\n  get validationManager() {\n    if (!this.has('*validationManager')) {\n      throw new Error('Unexpected error: ValidationManager is not initialized');\n    }\n    return this.$['*validationManager'];\n  }\n\n  /** @returns {UploaderPublicApi} */\n  get api() {\n    if (!this.has('*publicApi')) {\n      throw new Error('Unexpected error: UploaderPublicApi is not initialized');\n    }\n    return this.$['*publicApi'];\n  }\n  getAPI() {\n    return this.api;\n  }\n\n  /** @returns {TypedCollection<typeof uploadEntrySchema>} */\n  get uploadCollection() {\n    if (!this.has('*uploadCollection')) {\n      throw new Error('Unexpected error: TypedCollection is not initialized');\n    }\n    return this.$['*uploadCollection'];\n  }\n\n  /** @protected */\n  destroyCtxCallback() {\n    this._unobserveCollectionProperties?.();\n    this._unobserveCollection?.();\n    this.uploadCollection.destroy();\n    this.$['*uploadCollection'] = null;\n    super.destroyCtxCallback();\n  }\n  destroyCallback() {\n    super.destroyCallback();\n    this._flushOutputItems.cancel();\n  }\n\n  /** @private */\n  initCtxOwner() {\n    this.isCtxOwner = true;\n\n    /** @private */\n    this._unobserveCollection = this.uploadCollection.observeCollection(this._handleCollectionUpdate);\n\n    /** @private */\n    this._unobserveCollectionProperties = this.uploadCollection.observeProperties(this._handleCollectionPropertiesUpdate);\n    this.subConfigValue('maxConcurrentRequests', value => {\n      this.$['*uploadQueue'].concurrency = Number(value) || 1;\n    });\n    if (!this.$['*secureUploadsManager']) {\n      this.$['*secureUploadsManager'] = new SecureUploadsManager(this);\n    }\n  }\n\n  /**\n   * @private\n   * @param {import('../types').OutputCollectionState} collectionState\n   */\n  async _createGroup(collectionState) {\n    const uploadClientOptions = await this.getUploadClientOptions();\n    const uuidList = collectionState.allEntries.map(entry => {\n      return entry.uuid + (entry.cdnUrlModifiers ? `/${entry.cdnUrlModifiers}` : '');\n    });\n    const abortController = new AbortController();\n    const resp = await uploadFileGroup(uuidList, {\n      ...uploadClientOptions,\n      signal: abortController.signal\n    });\n    if (this.$['*collectionState'] !== collectionState) {\n      abortController.abort();\n      return;\n    }\n    this.$['*groupInfo'] = resp;\n    const collectionStateWithGroup = /** @type {import('../types').OutputCollectionState<'success', 'has-group'>} */\n    this.api.getOutputCollectionState();\n    this.emit(EventType.GROUP_CREATED, collectionStateWithGroup);\n    this.emit(EventType.CHANGE, () => this.api.getOutputCollectionState(), {\n      debounce: true\n    });\n    this.$['*collectionState'] = collectionStateWithGroup;\n  }\n\n  /** @private */\n  _flushOutputItems = debounce(async () => {\n    const data = this.getOutputData();\n    if (data.length !== this.uploadCollection.size) {\n      return;\n    }\n    const collectionState = this.api.getOutputCollectionState();\n    this.$['*collectionState'] = collectionState;\n    this.emit(EventType.CHANGE, () => this.api.getOutputCollectionState(), {\n      debounce: true\n    });\n    if (this.cfg.groupOutput && collectionState.totalCount > 0 && collectionState.status === 'success') {\n      this._createGroup(collectionState);\n    }\n  }, 300);\n\n  /**\n   * @private\n   * @type {import('./TypedCollection.js').TypedCollectionObserverHandler<typeof uploadEntrySchema>}\n   */\n  _handleCollectionUpdate = (entries, added, removed) => {\n    if (added.size || removed.size) {\n      this.$['*groupInfo'] = null;\n    }\n    this.validationManager.runFileValidators();\n    this.validationManager.runCollectionValidators();\n    for (const entry of added) {\n      if (!entry.getValue('silent')) {\n        this.emit(EventType.FILE_ADDED, this.api.getOutputItem(entry.uid));\n      }\n    }\n    for (const entry of removed) {\n      /** @type {Set<string>} */this.$['*uploadTrigger'].delete(entry.uid);\n      entry.getValue('abortController')?.abort();\n      entry.setMultipleValues({\n        isRemoved: true,\n        abortController: null,\n        isUploading: false,\n        uploadProgress: 0\n      });\n      const thumbUrl = entry?.getValue('thumbUrl');\n      thumbUrl && URL.revokeObjectURL(thumbUrl);\n      this.emit(EventType.FILE_REMOVED, this.api.getOutputItem(entry.uid));\n    }\n    this.$['*uploadList'] = entries.map(uid => {\n      return {\n        uid\n      };\n    });\n    this._flushCommonUploadProgress();\n    this._flushOutputItems();\n  };\n\n  /**\n   * @private\n   * @param {Record<keyof import('./uploadEntrySchema.js').UploadEntryData, Set<string>>} changeMap\n   */\n  _handleCollectionPropertiesUpdate = changeMap => {\n    this._flushOutputItems();\n    const uploadCollection = this.uploadCollection;\n    const entriesToRunValidation = [...new Set(Object.entries(changeMap).filter(([key]) => ['uploadError', 'fileInfo'].includes(key)).map(([, ids]) => [...ids]).flat())];\n    entriesToRunValidation.length > 0 && setTimeout(() => {\n      // We can't modify entry properties in the same tick, so we need to wait a bit\n      this.validationManager.runFileValidators(entriesToRunValidation);\n    });\n    if (changeMap.uploadProgress) {\n      for (const entryId of changeMap.uploadProgress) {\n        const {\n          isUploading,\n          silent\n        } = Data.getCtx(entryId).store;\n        if (isUploading && !silent) {\n          this.emit(EventType.FILE_UPLOAD_PROGRESS, this.api.getOutputItem(entryId));\n        }\n      }\n      this._flushCommonUploadProgress();\n    }\n    if (changeMap.isUploading) {\n      for (const entryId of changeMap.isUploading) {\n        const {\n          isUploading,\n          silent\n        } = Data.getCtx(entryId).store;\n        if (isUploading && !silent) {\n          this.emit(EventType.FILE_UPLOAD_START, this.api.getOutputItem(entryId));\n        }\n      }\n    }\n    if (changeMap.fileInfo) {\n      for (const entryId of changeMap.fileInfo) {\n        const {\n          fileInfo,\n          silent\n        } = Data.getCtx(entryId).store;\n        if (fileInfo && !silent) {\n          this.emit(EventType.FILE_UPLOAD_SUCCESS, this.api.getOutputItem(entryId));\n        }\n      }\n      if (this.cfg.cropPreset) {\n        this.setInitialCrop();\n      }\n      if (this.cfg.cloudImageEditorAutoOpen) {\n        this.openCloudImageEditor();\n      }\n    }\n    if (changeMap.errors) {\n      for (const entryId of changeMap.errors) {\n        const {\n          errors\n        } = Data.getCtx(entryId).store;\n        if (errors.length > 0) {\n          this.emit(EventType.FILE_UPLOAD_FAILED, this.api.getOutputItem(entryId));\n          this.emit(EventType.COMMON_UPLOAD_FAILED, () => (/** @type {import('../types').OutputCollectionState<'failed'>} */this.api.getOutputCollectionState()), {\n            debounce: true\n          });\n        }\n      }\n      const loadedItems = uploadCollection.findItems(entry => {\n        return !!entry.getValue('fileInfo');\n      });\n      const errorItems = uploadCollection.findItems(entry => {\n        return entry.getValue('errors').length > 0;\n      });\n      if (uploadCollection.size > 0 && errorItems.length === 0 && uploadCollection.size === loadedItems.length && this.$['*collectionErrors'].length === 0) {\n        this.emit(EventType.COMMON_UPLOAD_SUCCESS, /** @type {import('../types').OutputCollectionState<'success'>} */this.api.getOutputCollectionState());\n      }\n    }\n    if (changeMap.cdnUrl) {\n      const uids = [...changeMap.cdnUrl].filter(uid => {\n        return !!this.uploadCollection.read(uid)?.getValue('cdnUrl');\n      });\n      uids.forEach(uid => {\n        this.emit(EventType.FILE_URL_CHANGED, this.api.getOutputItem(uid));\n      });\n      this.$['*groupInfo'] = null;\n    }\n  };\n\n  /** @private */\n  _flushCommonUploadProgress = () => {\n    let commonProgress = 0;\n    /** @type {Set<string>} */\n    const uploadTrigger = this.$['*uploadTrigger'];\n    const items = [...uploadTrigger].filter(id => !!this.uploadCollection.read(id));\n    items.forEach(id => {\n      const uploadProgress = this.uploadCollection.readProp(id, 'uploadProgress');\n      if (typeof uploadProgress === 'number') {\n        commonProgress += uploadProgress;\n      }\n    });\n    const progress = items.length ? Math.round(commonProgress / items.length) : 0;\n    if (this.$['*commonProgress'] === progress) {\n      return;\n    }\n    this.$['*commonProgress'] = progress;\n    this.emit(EventType.COMMON_UPLOAD_PROGRESS, /** @type {import('../types').OutputCollectionState<'uploading'>} */this.api.getOutputCollectionState());\n  };\n  openCloudImageEditor() {\n    const [entry] = this.uploadCollection.findItems(entry => !!entry.getValue('fileInfo') && entry.getValue('isImage')).map(id => this.uploadCollection.read(id));\n    if (entry && this.uploadCollection.size === 1 && this.cfg.useCloudImageEditor && this.hasBlockInCtx(block => block.activityType === ActivityBlock.activities.CLOUD_IMG_EDIT)) {\n      this.$['*currentActivityParams'] = {\n        internalId: entry.uid\n      };\n      this.$['*currentActivity'] = ActivityBlock.activities.CLOUD_IMG_EDIT;\n      this.modalManager.open(ActivityBlock.activities.CLOUD_IMG_EDIT);\n    }\n  }\n\n  /** @private */\n  setInitialCrop() {\n    const cropPreset = parseCropPreset(this.cfg.cropPreset);\n    if (cropPreset) {\n      const [aspectRatioPreset] = cropPreset;\n      const entries = this.uploadCollection.findItems(entry => !!entry.getValue('fileInfo') && entry.getValue('isImage') && !entry.getValue('cdnUrlModifiers')?.includes('/crop/')).map(id => this.uploadCollection.read(id)).filter(Boolean);\n      for (const entry of entries) {\n        const fileInfo = entry.getValue('fileInfo');\n        if (!fileInfo || !fileInfo.imageInfo) {\n          console.warn('Failed to get image info for entry', entry.uid);\n          continue;\n        }\n        const {\n          width,\n          height\n        } = fileInfo.imageInfo;\n        const expectedAspectRatio = aspectRatioPreset.width / aspectRatioPreset.height;\n        const crop = calculateMaxCenteredCropFrame(width, height, expectedAspectRatio);\n        const cdnUrlModifiers = createCdnUrlModifiers(`crop/${crop.width}x${crop.height}/${crop.x},${crop.y}`, 'preview');\n        const cdnUrl = entry.getValue('cdnUrl');\n        if (!cdnUrl) {\n          console.warn('Failed to get cdnUrl for entry', entry.uid);\n          continue;\n        }\n        entry.setMultipleValues({\n          cdnUrlModifiers,\n          cdnUrl: createCdnUrl(cdnUrl, cdnUrlModifiers)\n        });\n        if (this.uploadCollection.size === 1 && this.cfg.useCloudImageEditor && this.hasBlockInCtx(block => block.activityType === ActivityBlock.activities.CLOUD_IMG_EDIT)) {\n          this.$['*currentActivityParams'] = {\n            internalId: entry.uid\n          };\n          this.$['*currentActivity'] = ActivityBlock.activities.CLOUD_IMG_EDIT;\n          this.modalManager.open(ActivityBlock.activities.CLOUD_IMG_EDIT);\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {string} entryId\n   * @protected\n   */\n  async getMetadataFor(entryId) {\n    const configValue = this.cfg.metadata || undefined;\n    if (typeof configValue === 'function') {\n      const outputFileEntry = this.api.getOutputItem(entryId);\n      const metadata = await configValue(outputFileEntry);\n      return metadata;\n    }\n    return configValue;\n  }\n\n  /**\n   * @returns {Promise<import('@uploadcare/upload-client').FileFromOptions>}\n   * @protected\n   */\n  async getUploadClientOptions() {\n    /** @type {SecureUploadsManager} */\n    const secureUploadsManager = this.$['*secureUploadsManager'];\n    const secureToken = await secureUploadsManager.getSecureToken().catch(() => null);\n    let options = {\n      store: this.cfg.store,\n      publicKey: this.cfg.pubkey,\n      baseCDN: this.cfg.cdnCname,\n      baseURL: this.cfg.baseUrl,\n      userAgent: customUserAgent,\n      integration: this.cfg.userAgentIntegration,\n      secureSignature: secureToken?.secureSignature,\n      secureExpire: secureToken?.secureExpire,\n      retryThrottledRequestMaxTimes: this.cfg.retryThrottledRequestMaxTimes,\n      retryNetworkErrorMaxTimes: this.cfg.retryNetworkErrorMaxTimes,\n      multipartMinFileSize: this.cfg.multipartMinFileSize,\n      multipartChunkSize: this.cfg.multipartChunkSize,\n      maxConcurrentRequests: this.cfg.multipartMaxConcurrentRequests,\n      multipartMaxAttempts: this.cfg.multipartMaxAttempts,\n      checkForUrlDuplicates: !!this.cfg.checkForUrlDuplicates,\n      saveUrlForRecurrentUploads: !!this.cfg.saveUrlForRecurrentUploads\n    };\n    return options;\n  }\n\n  /** @returns {import('../types/exported.js').OutputFileEntry[]} */\n  getOutputData() {\n    const entriesIds = this.uploadCollection.items();\n    const data = entriesIds.map(itemId => this.api.getOutputItem(itemId));\n    return data;\n  }\n}\n\n/**\n * @deprecated Use list sources ExternalUploadSource from from blocks/utils/UploadSource.js\n * @enum {String}\n */\nUploaderBlock.extSrcList = Object.freeze({\n  ...ExternalUploadSource\n});\n\n/**\n * @deprecated Use list sources UploadSource from from blocks/utils/UploadSource.js\n * @enum {String}\n */\nUploaderBlock.sourceTypes = Object.freeze({\n  ...UploadSource\n});","map":{"version":3,"names":["ActivityBlock","Data","uploadFileGroup","calculateMaxCenteredCropFrame","parseCropPreset","EventType","debounce","customUserAgent","createCdnUrl","createCdnUrlModifiers","uploaderBlockCtx","SecureUploadsManager","TypedCollection","UploaderPublicApi","ValidationManager","uploadEntrySchema","ExternalUploadSource","UploadSource","UploaderBlock","couldBeCtxOwner","isCtxOwner","init$","hasCtxOwner","hasBlockInCtx","block","isConnected","initCallback","has","uploadCollection","typedSchema","watchList","add","initCtxOwner","validationManager","Error","$","api","getAPI","destroyCtxCallback","_unobserveCollectionProperties","_unobserveCollection","destroy","destroyCallback","_flushOutputItems","cancel","observeCollection","_handleCollectionUpdate","observeProperties","_handleCollectionPropertiesUpdate","subConfigValue","value","concurrency","Number","_createGroup","collectionState","uploadClientOptions","getUploadClientOptions","uuidList","allEntries","map","entry","uuid","cdnUrlModifiers","abortController","AbortController","resp","signal","abort","collectionStateWithGroup","getOutputCollectionState","emit","GROUP_CREATED","CHANGE","data","getOutputData","length","size","cfg","groupOutput","totalCount","status","entries","added","removed","runFileValidators","runCollectionValidators","getValue","FILE_ADDED","getOutputItem","uid","delete","setMultipleValues","isRemoved","isUploading","uploadProgress","thumbUrl","URL","revokeObjectURL","FILE_REMOVED","_flushCommonUploadProgress","changeMap","entriesToRunValidation","Set","Object","filter","key","includes","ids","flat","setTimeout","entryId","silent","getCtx","store","FILE_UPLOAD_PROGRESS","FILE_UPLOAD_START","fileInfo","FILE_UPLOAD_SUCCESS","cropPreset","setInitialCrop","cloudImageEditorAutoOpen","openCloudImageEditor","errors","FILE_UPLOAD_FAILED","COMMON_UPLOAD_FAILED","loadedItems","findItems","errorItems","COMMON_UPLOAD_SUCCESS","cdnUrl","uids","read","forEach","FILE_URL_CHANGED","commonProgress","uploadTrigger","items","id","readProp","progress","Math","round","COMMON_UPLOAD_PROGRESS","useCloudImageEditor","activityType","activities","CLOUD_IMG_EDIT","internalId","modalManager","open","aspectRatioPreset","Boolean","imageInfo","console","warn","width","height","expectedAspectRatio","crop","x","y","getMetadataFor","configValue","metadata","undefined","outputFileEntry","secureUploadsManager","secureToken","getSecureToken","catch","options","publicKey","pubkey","baseCDN","cdnCname","baseURL","baseUrl","userAgent","integration","userAgentIntegration","secureSignature","secureExpire","retryThrottledRequestMaxTimes","retryNetworkErrorMaxTimes","multipartMinFileSize","multipartChunkSize","maxConcurrentRequests","multipartMaxConcurrentRequests","multipartMaxAttempts","checkForUrlDuplicates","saveUrlForRecurrentUploads","entriesIds","itemId","extSrcList","freeze","sourceTypes"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/abstract/UploaderBlock.js"],"sourcesContent":["// @ts-check\nimport { ActivityBlock } from './ActivityBlock.js';\n\nimport { Data } from '@symbiotejs/symbiote';\nimport { uploadFileGroup } from '@uploadcare/upload-client';\nimport { calculateMaxCenteredCropFrame } from '../blocks/CloudImageEditor/src/crop-utils.js';\nimport { parseCropPreset } from '../blocks/CloudImageEditor/src/lib/parseCropPreset.js';\nimport { EventType } from '../blocks/UploadCtxProvider/EventEmitter.js';\nimport { debounce } from '../blocks/utils/debounce.js';\nimport { customUserAgent } from '../blocks/utils/userAgent.js';\nimport { createCdnUrl, createCdnUrlModifiers } from '../utils/cdn-utils.js';\nimport { uploaderBlockCtx } from './CTX.js';\nimport { SecureUploadsManager } from './SecureUploadsManager.js';\nimport { TypedCollection } from './TypedCollection.js';\nimport { UploaderPublicApi } from './UploaderPublicApi.js';\nimport { ValidationManager } from './ValidationManager.js';\nimport { uploadEntrySchema } from './uploadEntrySchema.js';\nimport { ExternalUploadSource, UploadSource } from '../blocks/utils/UploadSource.js';\n\nexport class UploaderBlock extends ActivityBlock {\n  /** @protected */\n  couldBeCtxOwner = false;\n\n  /** @private */\n  isCtxOwner = false;\n\n  init$ = uploaderBlockCtx(this);\n\n  /** @private */\n  get hasCtxOwner() {\n    return this.hasBlockInCtx((block) => {\n      if (block instanceof UploaderBlock) {\n        return block.isCtxOwner && block.isConnected && block !== this;\n      }\n      return false;\n    });\n  }\n\n  /** @protected */\n  initCallback() {\n    super.initCallback();\n\n    if (!this.has('*uploadCollection')) {\n      let uploadCollection = new TypedCollection({\n        typedSchema: uploadEntrySchema,\n        watchList: ['uploadProgress', 'uploadError', 'fileInfo', 'errors', 'cdnUrl', 'isUploading'],\n      });\n      this.add('*uploadCollection', uploadCollection);\n    }\n\n    if (!this.has('*publicApi')) {\n      this.add('*publicApi', new UploaderPublicApi(this));\n    }\n\n    if (!this.has('*validationManager')) {\n      this.add('*validationManager', new ValidationManager(this));\n    }\n\n    if (!this.hasCtxOwner && this.couldBeCtxOwner) {\n      this.initCtxOwner();\n    }\n  }\n\n  /**\n   * @returns {ValidationManager}\n   * @protected\n   */\n  get validationManager() {\n    if (!this.has('*validationManager')) {\n      throw new Error('Unexpected error: ValidationManager is not initialized');\n    }\n    return this.$['*validationManager'];\n  }\n\n  /** @returns {UploaderPublicApi} */\n  get api() {\n    if (!this.has('*publicApi')) {\n      throw new Error('Unexpected error: UploaderPublicApi is not initialized');\n    }\n    return this.$['*publicApi'];\n  }\n\n  getAPI() {\n    return this.api;\n  }\n\n  /** @returns {TypedCollection<typeof uploadEntrySchema>} */\n  get uploadCollection() {\n    if (!this.has('*uploadCollection')) {\n      throw new Error('Unexpected error: TypedCollection is not initialized');\n    }\n    return this.$['*uploadCollection'];\n  }\n\n  /** @protected */\n  destroyCtxCallback() {\n    this._unobserveCollectionProperties?.();\n    this._unobserveCollection?.();\n    this.uploadCollection.destroy();\n    this.$['*uploadCollection'] = null;\n\n    super.destroyCtxCallback();\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n\n    this._flushOutputItems.cancel();\n  }\n\n  /** @private */\n  initCtxOwner() {\n    this.isCtxOwner = true;\n\n    /** @private */\n    this._unobserveCollection = this.uploadCollection.observeCollection(this._handleCollectionUpdate);\n\n    /** @private */\n    this._unobserveCollectionProperties = this.uploadCollection.observeProperties(\n      this._handleCollectionPropertiesUpdate,\n    );\n\n    this.subConfigValue('maxConcurrentRequests', (value) => {\n      this.$['*uploadQueue'].concurrency = Number(value) || 1;\n    });\n\n    if (!this.$['*secureUploadsManager']) {\n      this.$['*secureUploadsManager'] = new SecureUploadsManager(this);\n    }\n  }\n\n  /**\n   * @private\n   * @param {import('../types').OutputCollectionState} collectionState\n   */\n  async _createGroup(collectionState) {\n    const uploadClientOptions = await this.getUploadClientOptions();\n    const uuidList = collectionState.allEntries.map((entry) => {\n      return entry.uuid + (entry.cdnUrlModifiers ? `/${entry.cdnUrlModifiers}` : '');\n    });\n    const abortController = new AbortController();\n    const resp = await uploadFileGroup(uuidList, { ...uploadClientOptions, signal: abortController.signal });\n    if (this.$['*collectionState'] !== collectionState) {\n      abortController.abort();\n      return;\n    }\n    this.$['*groupInfo'] = resp;\n    const collectionStateWithGroup = /** @type {import('../types').OutputCollectionState<'success', 'has-group'>} */ (\n      this.api.getOutputCollectionState()\n    );\n    this.emit(EventType.GROUP_CREATED, collectionStateWithGroup);\n    this.emit(EventType.CHANGE, () => this.api.getOutputCollectionState(), { debounce: true });\n    this.$['*collectionState'] = collectionStateWithGroup;\n  }\n\n  /** @private */\n  _flushOutputItems = debounce(async () => {\n    const data = this.getOutputData();\n    if (data.length !== this.uploadCollection.size) {\n      return;\n    }\n    const collectionState = this.api.getOutputCollectionState();\n    this.$['*collectionState'] = collectionState;\n    this.emit(EventType.CHANGE, () => this.api.getOutputCollectionState(), { debounce: true });\n\n    if (this.cfg.groupOutput && collectionState.totalCount > 0 && collectionState.status === 'success') {\n      this._createGroup(collectionState);\n    }\n  }, 300);\n\n  /**\n   * @private\n   * @type {import('./TypedCollection.js').TypedCollectionObserverHandler<typeof uploadEntrySchema>}\n   */\n  _handleCollectionUpdate = (entries, added, removed) => {\n    if (added.size || removed.size) {\n      this.$['*groupInfo'] = null;\n    }\n    this.validationManager.runFileValidators();\n    this.validationManager.runCollectionValidators();\n\n    for (const entry of added) {\n      if (!entry.getValue('silent')) {\n        this.emit(EventType.FILE_ADDED, this.api.getOutputItem(entry.uid));\n      }\n    }\n\n    for (const entry of removed) {\n      /** @type {Set<string>} */ (this.$['*uploadTrigger']).delete(entry.uid);\n\n      entry.getValue('abortController')?.abort();\n      entry.setMultipleValues({\n        isRemoved: true,\n        abortController: null,\n        isUploading: false,\n        uploadProgress: 0,\n      });\n      const thumbUrl = entry?.getValue('thumbUrl');\n      thumbUrl && URL.revokeObjectURL(thumbUrl);\n      this.emit(EventType.FILE_REMOVED, this.api.getOutputItem(entry.uid));\n    }\n\n    this.$['*uploadList'] = entries.map((uid) => {\n      return { uid };\n    });\n\n    this._flushCommonUploadProgress();\n    this._flushOutputItems();\n  };\n\n  /**\n   * @private\n   * @param {Record<keyof import('./uploadEntrySchema.js').UploadEntryData, Set<string>>} changeMap\n   */\n  _handleCollectionPropertiesUpdate = (changeMap) => {\n    this._flushOutputItems();\n\n    const uploadCollection = this.uploadCollection;\n    const entriesToRunValidation = [\n      ...new Set(\n        Object.entries(changeMap)\n          .filter(([key]) => ['uploadError', 'fileInfo'].includes(key))\n          .map(([, ids]) => [...ids])\n          .flat(),\n      ),\n    ];\n\n    entriesToRunValidation.length > 0 &&\n      setTimeout(() => {\n        // We can't modify entry properties in the same tick, so we need to wait a bit\n        this.validationManager.runFileValidators(entriesToRunValidation);\n      });\n\n    if (changeMap.uploadProgress) {\n      for (const entryId of changeMap.uploadProgress) {\n        const { isUploading, silent } = Data.getCtx(entryId).store;\n        if (isUploading && !silent) {\n          this.emit(EventType.FILE_UPLOAD_PROGRESS, this.api.getOutputItem(entryId));\n        }\n      }\n\n      this._flushCommonUploadProgress();\n    }\n    if (changeMap.isUploading) {\n      for (const entryId of changeMap.isUploading) {\n        const { isUploading, silent } = Data.getCtx(entryId).store;\n        if (isUploading && !silent) {\n          this.emit(EventType.FILE_UPLOAD_START, this.api.getOutputItem(entryId));\n        }\n      }\n    }\n    if (changeMap.fileInfo) {\n      for (const entryId of changeMap.fileInfo) {\n        const { fileInfo, silent } = Data.getCtx(entryId).store;\n        if (fileInfo && !silent) {\n          this.emit(EventType.FILE_UPLOAD_SUCCESS, this.api.getOutputItem(entryId));\n        }\n      }\n      if (this.cfg.cropPreset) {\n        this.setInitialCrop();\n      }\n\n      if (this.cfg.cloudImageEditorAutoOpen) {\n        this.openCloudImageEditor();\n      }\n    }\n    if (changeMap.errors) {\n      for (const entryId of changeMap.errors) {\n        const { errors } = Data.getCtx(entryId).store;\n        if (errors.length > 0) {\n          this.emit(EventType.FILE_UPLOAD_FAILED, this.api.getOutputItem(entryId));\n          this.emit(\n            EventType.COMMON_UPLOAD_FAILED,\n            () =>\n              /** @type {import('../types').OutputCollectionState<'failed'>} */ (this.api.getOutputCollectionState()),\n            { debounce: true },\n          );\n        }\n      }\n      const loadedItems = uploadCollection.findItems((entry) => {\n        return !!entry.getValue('fileInfo');\n      });\n      const errorItems = uploadCollection.findItems((entry) => {\n        return entry.getValue('errors').length > 0;\n      });\n      if (\n        uploadCollection.size > 0 &&\n        errorItems.length === 0 &&\n        uploadCollection.size === loadedItems.length &&\n        this.$['*collectionErrors'].length === 0\n      ) {\n        this.emit(\n          EventType.COMMON_UPLOAD_SUCCESS,\n          /** @type {import('../types').OutputCollectionState<'success'>} */ (this.api.getOutputCollectionState()),\n        );\n      }\n    }\n    if (changeMap.cdnUrl) {\n      const uids = [...changeMap.cdnUrl].filter((uid) => {\n        return !!this.uploadCollection.read(uid)?.getValue('cdnUrl');\n      });\n      uids.forEach((uid) => {\n        this.emit(EventType.FILE_URL_CHANGED, this.api.getOutputItem(uid));\n      });\n\n      this.$['*groupInfo'] = null;\n    }\n  };\n\n  /** @private */\n  _flushCommonUploadProgress = () => {\n    let commonProgress = 0;\n    /** @type {Set<string>} */\n    const uploadTrigger = this.$['*uploadTrigger'];\n    const items = [...uploadTrigger].filter((id) => !!this.uploadCollection.read(id));\n    items.forEach((id) => {\n      const uploadProgress = this.uploadCollection.readProp(id, 'uploadProgress');\n      if (typeof uploadProgress === 'number') {\n        commonProgress += uploadProgress;\n      }\n    });\n    const progress = items.length ? Math.round(commonProgress / items.length) : 0;\n\n    if (this.$['*commonProgress'] === progress) {\n      return;\n    }\n\n    this.$['*commonProgress'] = progress;\n    this.emit(\n      EventType.COMMON_UPLOAD_PROGRESS,\n      /** @type {import('../types').OutputCollectionState<'uploading'>} */ (this.api.getOutputCollectionState()),\n    );\n  };\n\n  openCloudImageEditor() {\n    const [entry] = this.uploadCollection\n      .findItems((entry) => !!entry.getValue('fileInfo') && entry.getValue('isImage'))\n      .map((id) => this.uploadCollection.read(id));\n\n    if (\n      entry &&\n      this.uploadCollection.size === 1 &&\n      this.cfg.useCloudImageEditor &&\n      this.hasBlockInCtx((block) => block.activityType === ActivityBlock.activities.CLOUD_IMG_EDIT)\n    ) {\n      this.$['*currentActivityParams'] = {\n        internalId: entry.uid,\n      };\n      this.$['*currentActivity'] = ActivityBlock.activities.CLOUD_IMG_EDIT;\n      this.modalManager.open(ActivityBlock.activities.CLOUD_IMG_EDIT);\n    }\n  }\n\n  /** @private */\n  setInitialCrop() {\n    const cropPreset = parseCropPreset(this.cfg.cropPreset);\n    if (cropPreset) {\n      const [aspectRatioPreset] = cropPreset;\n\n      const entries = this.uploadCollection\n        .findItems(\n          (entry) =>\n            !!entry.getValue('fileInfo') &&\n            entry.getValue('isImage') &&\n            !entry.getValue('cdnUrlModifiers')?.includes('/crop/'),\n        )\n        .map((id) => this.uploadCollection.read(id))\n        .filter(Boolean);\n\n      for (const entry of entries) {\n        const fileInfo = entry.getValue('fileInfo');\n        if (!fileInfo || !fileInfo.imageInfo) {\n          console.warn('Failed to get image info for entry', entry.uid);\n          continue;\n        }\n        const { width, height } = fileInfo.imageInfo;\n        const expectedAspectRatio = aspectRatioPreset.width / aspectRatioPreset.height;\n        const crop = calculateMaxCenteredCropFrame(width, height, expectedAspectRatio);\n        const cdnUrlModifiers = createCdnUrlModifiers(\n          `crop/${crop.width}x${crop.height}/${crop.x},${crop.y}`,\n          'preview',\n        );\n        const cdnUrl = entry.getValue('cdnUrl');\n        if (!cdnUrl) {\n          console.warn('Failed to get cdnUrl for entry', entry.uid);\n          continue;\n        }\n        entry.setMultipleValues({\n          cdnUrlModifiers,\n          cdnUrl: createCdnUrl(cdnUrl, cdnUrlModifiers),\n        });\n        if (\n          this.uploadCollection.size === 1 &&\n          this.cfg.useCloudImageEditor &&\n          this.hasBlockInCtx((block) => block.activityType === ActivityBlock.activities.CLOUD_IMG_EDIT)\n        ) {\n          this.$['*currentActivityParams'] = {\n            internalId: entry.uid,\n          };\n          this.$['*currentActivity'] = ActivityBlock.activities.CLOUD_IMG_EDIT;\n          this.modalManager.open(ActivityBlock.activities.CLOUD_IMG_EDIT);\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {string} entryId\n   * @protected\n   */\n  async getMetadataFor(entryId) {\n    const configValue = this.cfg.metadata || undefined;\n    if (typeof configValue === 'function') {\n      const outputFileEntry = this.api.getOutputItem(entryId);\n      const metadata = await configValue(outputFileEntry);\n      return metadata;\n    }\n    return configValue;\n  }\n\n  /**\n   * @returns {Promise<import('@uploadcare/upload-client').FileFromOptions>}\n   * @protected\n   */\n  async getUploadClientOptions() {\n    /** @type {SecureUploadsManager} */\n    const secureUploadsManager = this.$['*secureUploadsManager'];\n    const secureToken = await secureUploadsManager.getSecureToken().catch(() => null);\n\n    let options = {\n      store: this.cfg.store,\n      publicKey: this.cfg.pubkey,\n      baseCDN: this.cfg.cdnCname,\n      baseURL: this.cfg.baseUrl,\n      userAgent: customUserAgent,\n      integration: this.cfg.userAgentIntegration,\n      secureSignature: secureToken?.secureSignature,\n      secureExpire: secureToken?.secureExpire,\n      retryThrottledRequestMaxTimes: this.cfg.retryThrottledRequestMaxTimes,\n      retryNetworkErrorMaxTimes: this.cfg.retryNetworkErrorMaxTimes,\n      multipartMinFileSize: this.cfg.multipartMinFileSize,\n      multipartChunkSize: this.cfg.multipartChunkSize,\n      maxConcurrentRequests: this.cfg.multipartMaxConcurrentRequests,\n      multipartMaxAttempts: this.cfg.multipartMaxAttempts,\n      checkForUrlDuplicates: !!this.cfg.checkForUrlDuplicates,\n      saveUrlForRecurrentUploads: !!this.cfg.saveUrlForRecurrentUploads,\n    };\n\n    return options;\n  }\n\n  /** @returns {import('../types/exported.js').OutputFileEntry[]} */\n  getOutputData() {\n    const entriesIds = this.uploadCollection.items();\n    const data = entriesIds.map((itemId) => this.api.getOutputItem(itemId));\n    return data;\n  }\n}\n\n/**\n * @deprecated Use list sources ExternalUploadSource from from blocks/utils/UploadSource.js\n * @enum {String}\n */\nUploaderBlock.extSrcList = Object.freeze({\n  ...ExternalUploadSource,\n});\n\n/**\n * @deprecated Use list sources UploadSource from from blocks/utils/UploadSource.js\n * @enum {String}\n */\nUploaderBlock.sourceTypes = Object.freeze({\n  ...UploadSource,\n});\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}