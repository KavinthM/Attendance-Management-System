{"ast":null,"code":"// @ts-check\nimport { createCdnUrl, createCdnUrlModifiers } from '../../../utils/cdn-utils.js';\nimport { EditorButtonControl } from './EditorButtonControl.js';\nimport { FAKE_ORIGINAL_FILTER } from './EditorSlider.js';\nimport { COMMON_OPERATIONS, transformationsToOperations } from './lib/transformationUtils.js';\nimport { preloadImage } from '../../utils/preloadImage.js';\nexport class EditorFilterControl extends EditorButtonControl {\n  constructor() {\n    super();\n    this.init$ = {\n      ...this.init$,\n      active: false,\n      title: '',\n      icon: '',\n      isOriginal: false,\n      iconSize: '20',\n      'on.click': null\n    };\n  }\n  _previewSrc() {\n    let previewSize = parseInt(window.getComputedStyle(this).getPropertyValue('--l-base-min-width'), 10);\n    let dpr = window.devicePixelRatio;\n    let size = Math.ceil(dpr * previewSize);\n    let quality = dpr >= 2 ? 'lightest' : 'normal';\n    let filterValue = 100;\n\n    /** @type {import('./types.js').Transformations} */\n    let transformations = {\n      ...this.$['*editorTransformations']\n    };\n    // @ts-expect-error FIXME: fix this\n    transformations[this._operation] = this._filter !== FAKE_ORIGINAL_FILTER ? {\n      name: this._filter,\n      amount: filterValue\n    } : undefined;\n    return createCdnUrl(this._originalUrl, createCdnUrlModifiers(COMMON_OPERATIONS, transformationsToOperations(transformations), `quality/${quality}`, `scale_crop/${size}x${size}/center`));\n  }\n\n  /**\n   * @param {IntersectionObserverEntry[]} entries\n   * @param {IntersectionObserver} observer\n   */\n  async _observerCallback(entries, observer) {\n    let intersectionEntry = entries[0];\n    if (intersectionEntry.isIntersecting) {\n      let src = await this.proxyUrl(this._previewSrc());\n      let previewEl = this.ref['preview-el'];\n      let {\n        promise,\n        cancel\n      } = preloadImage(src);\n      this._cancelPreload = cancel;\n      promise.catch(err => {\n        this.$['*networkProblems'] = true;\n        console.error('Failed to load image', {\n          error: err\n        });\n      }).finally(() => {\n        previewEl.style.backgroundImage = `url(${src})`;\n        previewEl.setAttribute('loaded', '');\n        observer.unobserve(this);\n      });\n    } else {\n      this._cancelPreload?.();\n    }\n  }\n  initCallback() {\n    super.initCallback();\n    this.$['on.click'] = () => {\n      if (!this.$.active) {\n        this.$['*sliderEl'].setOperation(this._operation, this._filter);\n        this.$['*sliderEl'].apply();\n      } else if (!this.$.isOriginal) {\n        this.$['*sliderEl'].setOperation(this._operation, this._filter);\n        this.$['*showSlider'] = true;\n      }\n      this.$['*currentFilter'] = this._filter;\n    };\n    this.defineAccessor('filter', /** @param {string} filter */\n    filter => {\n      this._operation = 'filter';\n      this._filter = filter;\n      this.$.isOriginal = filter === FAKE_ORIGINAL_FILTER;\n      this.$.icon = this.$.isOriginal ? 'original' : 'slider';\n      this.bindL10n('title-prop', () => this.l10n('a11y-cloud-editor-apply-filter', {\n        name: filter.toLowerCase()\n      }));\n    });\n    this._observer = new window.IntersectionObserver(this._observerCallback.bind(this), {\n      threshold: [0, 1]\n    });\n    let originalUrl = this.$['*originalUrl'];\n    this._originalUrl = originalUrl;\n    if (this.$.isOriginal) {\n      this.ref['icon-el'].classList.add('uc-original-icon');\n    } else {\n      this._observer.observe(this);\n    }\n    this.sub('*currentFilter', currentFilter => {\n      this.$.active = currentFilter && currentFilter === this._filter;\n    });\n    this.sub('isOriginal', isOriginal => {\n      this.$.iconSize = isOriginal ? 40 : 20;\n    });\n    this.sub('active', active => {\n      if (this.$.isOriginal) {\n        return;\n      }\n      let iconEl = this.ref['icon-el'];\n      iconEl.style.opacity = active ? '1' : '0';\n      let previewEl = this.ref['preview-el'];\n      if (active) {\n        previewEl.style.opacity = '0';\n      } else if (previewEl.style.backgroundImage) {\n        previewEl.style.opacity = '1';\n      }\n    });\n    this.sub('*networkProblems', async networkProblems => {\n      if (!networkProblems) {\n        let src = await this.proxyUrl(this._previewSrc());\n        let previewEl = this.ref['preview-el'];\n        if (previewEl.style.backgroundImage) {\n          previewEl.style.backgroundImage = 'none';\n          previewEl.style.backgroundImage = `url(${src})`;\n        }\n      }\n    });\n  }\n  destroyCallback() {\n    super.destroyCallback();\n    this._observer?.disconnect();\n    this._cancelPreload?.();\n  }\n}\nEditorFilterControl.template = /* HTML */`\n  <button type=\"button\" role=\"option\" l10n=\"@title:title-prop;@aria-label:title-prop\">\n    <div class=\"uc-preview\" ref=\"preview-el\"></div>\n    <uc-icon ref=\"icon-el\" set=\"@name: icon; @size: iconSize;\"></uc-icon>\n  </button>\n`;","map":{"version":3,"names":["createCdnUrl","createCdnUrlModifiers","EditorButtonControl","FAKE_ORIGINAL_FILTER","COMMON_OPERATIONS","transformationsToOperations","preloadImage","EditorFilterControl","constructor","init$","active","title","icon","isOriginal","iconSize","_previewSrc","previewSize","parseInt","window","getComputedStyle","getPropertyValue","dpr","devicePixelRatio","size","Math","ceil","quality","filterValue","transformations","$","_operation","_filter","name","amount","undefined","_originalUrl","_observerCallback","entries","observer","intersectionEntry","isIntersecting","src","proxyUrl","previewEl","ref","promise","cancel","_cancelPreload","catch","err","console","error","finally","style","backgroundImage","setAttribute","unobserve","initCallback","setOperation","apply","defineAccessor","filter","bindL10n","l10n","toLowerCase","_observer","IntersectionObserver","bind","threshold","originalUrl","classList","add","observe","sub","currentFilter","iconEl","opacity","networkProblems","destroyCallback","disconnect","template"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/blocks/CloudImageEditor/src/EditorFilterControl.js"],"sourcesContent":["// @ts-check\nimport { createCdnUrl, createCdnUrlModifiers } from '../../../utils/cdn-utils.js';\nimport { EditorButtonControl } from './EditorButtonControl.js';\nimport { FAKE_ORIGINAL_FILTER } from './EditorSlider.js';\nimport { COMMON_OPERATIONS, transformationsToOperations } from './lib/transformationUtils.js';\nimport { preloadImage } from '../../utils/preloadImage.js';\n\nexport class EditorFilterControl extends EditorButtonControl {\n  constructor() {\n    super();\n\n    this.init$ = {\n      ...this.init$,\n      active: false,\n      title: '',\n      icon: '',\n      isOriginal: false,\n      iconSize: '20',\n      'on.click': null,\n    };\n  }\n\n  _previewSrc() {\n    let previewSize = parseInt(window.getComputedStyle(this).getPropertyValue('--l-base-min-width'), 10);\n    let dpr = window.devicePixelRatio;\n    let size = Math.ceil(dpr * previewSize);\n    let quality = dpr >= 2 ? 'lightest' : 'normal';\n    let filterValue = 100;\n\n    /** @type {import('./types.js').Transformations} */\n    let transformations = { ...this.$['*editorTransformations'] };\n    // @ts-expect-error FIXME: fix this\n    transformations[this._operation] =\n      this._filter !== FAKE_ORIGINAL_FILTER\n        ? {\n            name: this._filter,\n            amount: filterValue,\n          }\n        : undefined;\n\n    return createCdnUrl(\n      this._originalUrl,\n      createCdnUrlModifiers(\n        COMMON_OPERATIONS,\n        transformationsToOperations(transformations),\n        `quality/${quality}`,\n        `scale_crop/${size}x${size}/center`,\n      ),\n    );\n  }\n\n  /**\n   * @param {IntersectionObserverEntry[]} entries\n   * @param {IntersectionObserver} observer\n   */\n  async _observerCallback(entries, observer) {\n    let intersectionEntry = entries[0];\n    if (intersectionEntry.isIntersecting) {\n      let src = await this.proxyUrl(this._previewSrc());\n      let previewEl = this.ref['preview-el'];\n      let { promise, cancel } = preloadImage(src);\n      this._cancelPreload = cancel;\n      promise\n        .catch((err) => {\n          this.$['*networkProblems'] = true;\n          console.error('Failed to load image', { error: err });\n        })\n        .finally(() => {\n          previewEl.style.backgroundImage = `url(${src})`;\n          previewEl.setAttribute('loaded', '');\n\n          observer.unobserve(this);\n        });\n    } else {\n      this._cancelPreload?.();\n    }\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this.$['on.click'] = () => {\n      if (!this.$.active) {\n        this.$['*sliderEl'].setOperation(this._operation, this._filter);\n        this.$['*sliderEl'].apply();\n      } else if (!this.$.isOriginal) {\n        this.$['*sliderEl'].setOperation(this._operation, this._filter);\n        this.$['*showSlider'] = true;\n      }\n\n      this.$['*currentFilter'] = this._filter;\n    };\n\n    this.defineAccessor(\n      'filter',\n      /** @param {string} filter */\n      (filter) => {\n        this._operation = 'filter';\n        this._filter = filter;\n        this.$.isOriginal = filter === FAKE_ORIGINAL_FILTER;\n        this.$.icon = this.$.isOriginal ? 'original' : 'slider';\n\n        this.bindL10n('title-prop', () =>\n          this.l10n('a11y-cloud-editor-apply-filter', {\n            name: filter.toLowerCase(),\n          }),\n        );\n      },\n    );\n\n    this._observer = new window.IntersectionObserver(this._observerCallback.bind(this), {\n      threshold: [0, 1],\n    });\n\n    let originalUrl = this.$['*originalUrl'];\n    this._originalUrl = originalUrl;\n\n    if (this.$.isOriginal) {\n      this.ref['icon-el'].classList.add('uc-original-icon');\n    } else {\n      this._observer.observe(this);\n    }\n\n    this.sub('*currentFilter', (currentFilter) => {\n      this.$.active = currentFilter && currentFilter === this._filter;\n    });\n\n    this.sub('isOriginal', (isOriginal) => {\n      this.$.iconSize = isOriginal ? 40 : 20;\n    });\n\n    this.sub('active', (active) => {\n      if (this.$.isOriginal) {\n        return;\n      }\n      let iconEl = this.ref['icon-el'];\n      iconEl.style.opacity = active ? '1' : '0';\n\n      let previewEl = this.ref['preview-el'];\n      if (active) {\n        previewEl.style.opacity = '0';\n      } else if (previewEl.style.backgroundImage) {\n        previewEl.style.opacity = '1';\n      }\n    });\n\n    this.sub('*networkProblems', async (networkProblems) => {\n      if (!networkProblems) {\n        let src = await this.proxyUrl(this._previewSrc());\n        let previewEl = this.ref['preview-el'];\n        if (previewEl.style.backgroundImage) {\n          previewEl.style.backgroundImage = 'none';\n          previewEl.style.backgroundImage = `url(${src})`;\n        }\n      }\n    });\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n    this._observer?.disconnect();\n    this._cancelPreload?.();\n  }\n}\n\nEditorFilterControl.template = /* HTML */ `\n  <button type=\"button\" role=\"option\" l10n=\"@title:title-prop;@aria-label:title-prop\">\n    <div class=\"uc-preview\" ref=\"preview-el\"></div>\n    <uc-icon ref=\"icon-el\" set=\"@name: icon; @size: iconSize;\"></uc-icon>\n  </button>\n`;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}