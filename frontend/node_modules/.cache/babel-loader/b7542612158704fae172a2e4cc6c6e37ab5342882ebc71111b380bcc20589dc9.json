{"ast":null,"code":"// @ts-check\nimport { joinCdnOperations } from '../../../../utils/cdn-utils.js';\nimport { stringToArray } from '../../../../utils/stringToArray.js';\n\n/** @type {Record<keyof import('../types').Transformations, unknown>} */\nexport const OPERATIONS_DEFAULTS = Object.freeze({\n  brightness: 0,\n  exposure: 0,\n  gamma: 100,\n  contrast: 0,\n  saturation: 0,\n  vibrance: 0,\n  warmth: 0,\n  enhance: 0,\n  filter: 0,\n  rotate: 0,\n  mirror: false,\n  flip: false,\n  crop: undefined\n});\n\n/** @type {readonly (keyof import('../types').Transformations)[]} */\nconst SUPPORTED_OPERATIONS_ORDERED = /** @type {const} */['enhance', 'brightness', 'exposure', 'gamma', 'contrast', 'saturation', 'vibrance', 'warmth', 'filter', 'mirror', 'flip', 'rotate', 'crop'];\n\n/**\n * @template {keyof import('../types').Transformations} T\n * @param {T} operation\n * @param {import('../types').Transformations[T]} options\n */\nfunction transformationToStr(operation, options) {\n  if (typeof options === 'number') {\n    const value = options;\n    return OPERATIONS_DEFAULTS[operation] !== value ? `${operation}/${value}` : '';\n  }\n  if (typeof options === 'boolean') {\n    const value = options;\n    return OPERATIONS_DEFAULTS[operation] !== value ? `${operation}` : '';\n  }\n  if (operation === 'filter' && options) {\n    const {\n      name,\n      amount\n    } = /** @type {NonNullable<import('../types').Transformations['filter']>} */options;\n    if (OPERATIONS_DEFAULTS.filter === amount) {\n      return '';\n    }\n    return `${operation}/${name}/${amount}`;\n  }\n  if (operation === 'crop' && options) {\n    let {\n      dimensions,\n      coords\n    } = /** @type {NonNullable<import('../types').Transformations['crop']>} */options;\n    return `${operation}/${dimensions.join('x')}/${coords.join(',')}`;\n  }\n  return '';\n}\n\n/**\n * @param {import('../types').Transformations} transformations\n * @returns {string}\n */\nexport function transformationsToOperations(transformations) {\n  return joinCdnOperations(...SUPPORTED_OPERATIONS_ORDERED.filter(operation => typeof transformations[operation] !== 'undefined' && transformations[operation] !== null).map(operation => {\n    let options = transformations[operation];\n    return transformationToStr(operation, options);\n  }).filter(str => !!str));\n}\nexport const COMMON_OPERATIONS = joinCdnOperations('format/auto', 'progressive/yes');\n\n/** @param {[unknown]} arg */\nconst asNumber = ([value]) => typeof value !== 'undefined' ? Number(value) : undefined;\nconst asBoolean = () => true;\n/** @param {[string, unknown]} arg */\nconst asFilter = ([name, amount]) => ({\n  name,\n  amount: typeof amount !== 'undefined' ? Number(amount) : 100\n});\n\n/**\n * Docs: https://uploadcare.com/docs/transformations/image/resize-crop/#operation-crop We don't support percentages and\n * alignment presets, Because it's unclear how to handle them in the Editor UI TODO: add support for percentages and\n * alignment presets\n *\n * @param {[string, string]} arg\n */\nconst asCrop = ([dimensions, alignment]) => {\n  if (!/\\d+x\\d+/.test(dimensions) || !/\\d+,\\d+/.test(alignment)) {\n    throw new Error('Crop by aspect ratio, percentage or alignment shortcuts is not supported.');\n  }\n  return /** @type {{ dimensions: [number, number]; coords: [number, number] }} */{\n    dimensions: stringToArray(dimensions, 'x').map(Number),\n    coords: stringToArray(alignment).map(Number)\n  };\n};\n\n/**\n * @type {{\n *   [K in keyof Required<import('../types').Transformations>]: (args: any) => import('../types').Transformations[K];\n * }}\n */\nconst OPERATION_PROCESSORS = Object.freeze({\n  enhance: asNumber,\n  brightness: asNumber,\n  exposure: asNumber,\n  gamma: asNumber,\n  contrast: asNumber,\n  saturation: asNumber,\n  vibrance: asNumber,\n  warmth: asNumber,\n  filter: asFilter,\n  mirror: asBoolean,\n  flip: asBoolean,\n  rotate: asNumber,\n  crop: asCrop\n});\n\n/**\n * @param {string[]} operations\n * @returns {import('../types.js').Transformations}\n */\nexport function operationsToTransformations(operations) {\n  /** @type {Record<string, unknown>} */\n  const transformations = {};\n  for (const operation of operations) {\n    const [name, ...args] = operation.split('/');\n    if (!SUPPORTED_OPERATIONS_ORDERED.includes(name)) {\n      continue;\n    }\n    const operationName = /** @type {(typeof SUPPORTED_OPERATIONS_ORDERED)[number]} */name;\n    const processor = OPERATION_PROCESSORS[operationName];\n    try {\n      const value = processor(args);\n      transformations[operationName] = value;\n    } catch (err) {\n      console.warn([`Failed to parse URL operation \"${operation}\". It will be ignored.`, err instanceof Error ? `Error message: \"${err.message}\"` : err, 'If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new'].join('\\n'));\n    }\n  }\n  return /** @type {import('../types.js').Transformations} */transformations;\n}","map":{"version":3,"names":["joinCdnOperations","stringToArray","OPERATIONS_DEFAULTS","Object","freeze","brightness","exposure","gamma","contrast","saturation","vibrance","warmth","enhance","filter","rotate","mirror","flip","crop","undefined","SUPPORTED_OPERATIONS_ORDERED","transformationToStr","operation","options","value","name","amount","dimensions","coords","join","transformationsToOperations","transformations","map","str","COMMON_OPERATIONS","asNumber","Number","asBoolean","asFilter","asCrop","alignment","test","Error","OPERATION_PROCESSORS","operationsToTransformations","operations","args","split","includes","operationName","processor","err","console","warn","message"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/blocks/CloudImageEditor/src/lib/transformationUtils.js"],"sourcesContent":["// @ts-check\nimport { joinCdnOperations } from '../../../../utils/cdn-utils.js';\nimport { stringToArray } from '../../../../utils/stringToArray.js';\n\n/** @type {Record<keyof import('../types').Transformations, unknown>} */\nexport const OPERATIONS_DEFAULTS = Object.freeze({\n  brightness: 0,\n  exposure: 0,\n  gamma: 100,\n  contrast: 0,\n  saturation: 0,\n  vibrance: 0,\n  warmth: 0,\n  enhance: 0,\n  filter: 0,\n  rotate: 0,\n  mirror: false,\n  flip: false,\n  crop: undefined,\n});\n\n/** @type {readonly (keyof import('../types').Transformations)[]} */\nconst SUPPORTED_OPERATIONS_ORDERED = /** @type {const} */ ([\n  'enhance',\n  'brightness',\n  'exposure',\n  'gamma',\n  'contrast',\n  'saturation',\n  'vibrance',\n  'warmth',\n  'filter',\n  'mirror',\n  'flip',\n  'rotate',\n  'crop',\n]);\n\n/**\n * @template {keyof import('../types').Transformations} T\n * @param {T} operation\n * @param {import('../types').Transformations[T]} options\n */\nfunction transformationToStr(operation, options) {\n  if (typeof options === 'number') {\n    const value = options;\n    return OPERATIONS_DEFAULTS[operation] !== value ? `${operation}/${value}` : '';\n  }\n\n  if (typeof options === 'boolean') {\n    const value = options;\n    return OPERATIONS_DEFAULTS[operation] !== value ? `${operation}` : '';\n  }\n\n  if (operation === 'filter' && options) {\n    const { name, amount } = /** @type {NonNullable<import('../types').Transformations['filter']>} */ (options);\n    if (OPERATIONS_DEFAULTS.filter === amount) {\n      return '';\n    }\n    return `${operation}/${name}/${amount}`;\n  }\n\n  if (operation === 'crop' && options) {\n    let { dimensions, coords } = /** @type {NonNullable<import('../types').Transformations['crop']>} */ (options);\n    return `${operation}/${dimensions.join('x')}/${coords.join(',')}`;\n  }\n\n  return '';\n}\n\n/**\n * @param {import('../types').Transformations} transformations\n * @returns {string}\n */\nexport function transformationsToOperations(transformations) {\n  return joinCdnOperations(\n    ...SUPPORTED_OPERATIONS_ORDERED.filter(\n      (operation) => typeof transformations[operation] !== 'undefined' && transformations[operation] !== null,\n    )\n      .map((operation) => {\n        let options = transformations[operation];\n        return transformationToStr(operation, options);\n      })\n      .filter((str) => !!str),\n  );\n}\n\nexport const COMMON_OPERATIONS = joinCdnOperations('format/auto', 'progressive/yes');\n\n/** @param {[unknown]} arg */\nconst asNumber = ([value]) => (typeof value !== 'undefined' ? Number(value) : undefined);\nconst asBoolean = () => true;\n/** @param {[string, unknown]} arg */\nconst asFilter = ([name, amount]) => ({\n  name,\n  amount: typeof amount !== 'undefined' ? Number(amount) : 100,\n});\n\n/**\n * Docs: https://uploadcare.com/docs/transformations/image/resize-crop/#operation-crop We don't support percentages and\n * alignment presets, Because it's unclear how to handle them in the Editor UI TODO: add support for percentages and\n * alignment presets\n *\n * @param {[string, string]} arg\n */\nconst asCrop = ([dimensions, alignment]) => {\n  if (!/\\d+x\\d+/.test(dimensions) || !/\\d+,\\d+/.test(alignment)) {\n    throw new Error('Crop by aspect ratio, percentage or alignment shortcuts is not supported.');\n  }\n\n  return /** @type {{ dimensions: [number, number]; coords: [number, number] }} */ ({\n    dimensions: stringToArray(dimensions, 'x').map(Number),\n    coords: stringToArray(alignment).map(Number),\n  });\n};\n\n/**\n * @type {{\n *   [K in keyof Required<import('../types').Transformations>]: (args: any) => import('../types').Transformations[K];\n * }}\n */\nconst OPERATION_PROCESSORS = Object.freeze({\n  enhance: asNumber,\n  brightness: asNumber,\n  exposure: asNumber,\n  gamma: asNumber,\n  contrast: asNumber,\n  saturation: asNumber,\n  vibrance: asNumber,\n  warmth: asNumber,\n  filter: asFilter,\n  mirror: asBoolean,\n  flip: asBoolean,\n  rotate: asNumber,\n  crop: asCrop,\n});\n\n/**\n * @param {string[]} operations\n * @returns {import('../types.js').Transformations}\n */\nexport function operationsToTransformations(operations) {\n  /** @type {Record<string, unknown>} */\n  const transformations = {};\n  for (const operation of operations) {\n    const [name, ...args] = operation.split('/');\n    if (!SUPPORTED_OPERATIONS_ORDERED.includes(name)) {\n      continue;\n    }\n    const operationName = /** @type {(typeof SUPPORTED_OPERATIONS_ORDERED)[number]} */ (name);\n    const processor = OPERATION_PROCESSORS[operationName];\n    try {\n      const value = processor(args);\n      transformations[operationName] = value;\n    } catch (err) {\n      console.warn(\n        [\n          `Failed to parse URL operation \"${operation}\". It will be ignored.`,\n          err instanceof Error ? `Error message: \"${err.message}\"` : err,\n          'If you need this functionality, please feel free to open an issue at https://github.com/uploadcare/blocks/issues/new',\n        ].join('\\n'),\n      );\n    }\n  }\n\n  return /** @type {import('../types.js').Transformations} */ (transformations);\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}