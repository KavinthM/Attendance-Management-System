{"ast":null,"code":"// @ts-check\nimport { ActivityBlock } from './ActivityBlock.js';\nimport { applyStyles, Data } from '@symbiotejs/symbiote';\nimport { calcCameraModes } from '../blocks/CameraSource/calcCameraModes.js';\nimport { CameraSourceTypes } from '../blocks/CameraSource/constants.js';\nimport { EventType } from '../blocks/UploadCtxProvider/EventEmitter.js';\nimport { UploadSource } from '../blocks/utils/UploadSource.js';\nimport { serializeCsv } from '../blocks/utils/comma-separated.js';\nimport { browserFeatures } from '../utils/browser-info.js';\nimport { BASIC_IMAGE_WILDCARD, BASIC_VIDEO_WILDCARD, fileIsImage, IMAGE_ACCEPT_LIST, mergeFileTypes } from '../utils/fileTypes.js';\nimport { parseCdnUrl } from '../utils/parseCdnUrl.js';\nimport { stringToArray } from '../utils/stringToArray.js';\nimport { buildOutputCollectionState } from './buildOutputCollectionState.js';\nexport class UploaderPublicApi {\n  /**\n   * @private\n   * @type {import('./UploaderBlock.js').UploaderBlock}\n   */\n  _ctx;\n\n  /** @param {import('./UploaderBlock.js').UploaderBlock} ctx */\n  constructor(ctx) {\n    this._ctx = ctx;\n  }\n\n  /** @private */\n  get _uploadCollection() {\n    return this._ctx.uploadCollection;\n  }\n  get cfg() {\n    return this._ctx.cfg;\n  }\n  get l10n() {\n    return this._ctx.l10n.bind(this._ctx);\n  }\n\n  /**\n   * TODO: Probably we should not allow user to override `source` property\n   *\n   * @param {string} url\n   * @param {{ silent?: boolean; fileName?: string; source?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromUrl = (url, {\n    silent,\n    fileName,\n    source\n  } = {}) => {\n    const internalId = this._uploadCollection.add({\n      externalUrl: url,\n      fileName: fileName ?? null,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /**\n   * @param {string} uuid\n   * @param {{ silent?: boolean; fileName?: string; source?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromUuid = (uuid, {\n    silent,\n    fileName,\n    source\n  } = {}) => {\n    const internalId = this._uploadCollection.add({\n      uuid,\n      fileName: fileName ?? null,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /**\n   * @param {string} cdnUrl\n   * @param {{ silent?: boolean; fileName?: string; source?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromCdnUrl = (cdnUrl, {\n    silent,\n    fileName,\n    source\n  } = {}) => {\n    const parsedCdnUrl = parseCdnUrl({\n      url: cdnUrl,\n      cdnBase: this.cfg.cdnCname\n    });\n    if (!parsedCdnUrl) {\n      throw new Error('Invalid CDN URL');\n    }\n    const internalId = this._uploadCollection.add({\n      uuid: parsedCdnUrl.uuid,\n      cdnUrl,\n      cdnUrlModifiers: parsedCdnUrl.cdnUrlModifiers,\n      fileName: fileName ?? parsedCdnUrl.filename ?? null,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /**\n   * @param {File} file\n   * @param {{ silent?: boolean; fileName?: string; source?: string; fullPath?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromObject = (file, {\n    silent,\n    fileName,\n    source,\n    fullPath\n  } = {}) => {\n    const internalId = this._uploadCollection.add({\n      file,\n      isImage: fileIsImage(file),\n      mimeType: file.type,\n      fileName: fileName ?? file.name,\n      fileSize: file.size,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API,\n      fullPath: fullPath ?? null\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /** @param {string} internalId */\n  removeFileByInternalId = internalId => {\n    if (!this._uploadCollection.read(internalId)) {\n      throw new Error(`File with internalId ${internalId} not found`);\n    }\n    this._uploadCollection.remove(internalId);\n  };\n  removeAllFiles() {\n    this._uploadCollection.clearAll();\n  }\n  uploadAll = () => {\n    const itemsToUpload = this._uploadCollection.items().filter(id => {\n      const entry = this._uploadCollection.read(id);\n      if (!entry) return false;\n      return !entry.getValue('isRemoved') && !entry.getValue('isUploading') && !entry.getValue('fileInfo');\n    });\n    if (itemsToUpload.length === 0) {\n      return;\n    }\n    this._ctx.$['*uploadTrigger'] = new Set(itemsToUpload);\n    this._ctx.emit(EventType.COMMON_UPLOAD_START, /** @type {import('../types').OutputCollectionState<'uploading'>} */this.getOutputCollectionState());\n  };\n\n  /** @param {{ captureCamera?: boolean; modeCamera?: import('../blocks/CameraSource/constants.js').ModeCameraType }} options */\n  openSystemDialog = (options = {}) => {\n    const accept = serializeCsv(mergeFileTypes([this.cfg.accept ?? '', ...(this.cfg.imgOnly ? IMAGE_ACCEPT_LIST : [])]));\n    const INPUT_ATTR_NAME = 'uploadcare-file-input';\n    const fileInput = document.createElement('input');\n    fileInput.setAttribute(INPUT_ATTR_NAME, '');\n    applyStyles(fileInput, {\n      opacity: 0,\n      height: 0,\n      width: 0,\n      visibility: 'hidden',\n      position: 'absolute',\n      top: 0,\n      left: 0\n    });\n    fileInput.type = 'file';\n    fileInput.multiple = this.cfg.multiple;\n    if (options.captureCamera) {\n      fileInput.capture = this.cfg.cameraCapture;\n      const {\n        isPhotoEnabled,\n        isVideoRecordingEnabled\n      } = calcCameraModes(this.cfg);\n      if (options.modeCamera === CameraSourceTypes.PHOTO && isPhotoEnabled) {\n        fileInput.accept = BASIC_IMAGE_WILDCARD;\n      } else if (options.modeCamera === CameraSourceTypes.VIDEO && isVideoRecordingEnabled) {\n        fileInput.accept = BASIC_VIDEO_WILDCARD;\n      } else {\n        fileInput.accept = [BASIC_IMAGE_WILDCARD, isVideoRecordingEnabled && BASIC_VIDEO_WILDCARD].filter(Boolean).join(',');\n      }\n    } else {\n      fileInput.accept = accept;\n    }\n    fileInput.addEventListener('change', () => {\n      if (!fileInput.files) {\n        return;\n      }\n      [...fileInput.files].forEach(file => this.addFileFromObject(file, {\n        source: options.captureCamera ? UploadSource.CAMERA : UploadSource.LOCAL\n      }));\n      // To call uploadTrigger UploadList should draw file items first:\n      this._ctx.modalManager.open(ActivityBlock.activities.UPLOAD_LIST);\n      this._ctx.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n      fileInput.remove();\n    }, {\n      once: true\n    });\n    document.querySelectorAll(`[${INPUT_ATTR_NAME}]`).forEach(el => el.remove());\n\n    /**\n     * Some browsers (e.g. Safari) require the file input to be in the DOM to work properly. Without it the file input\n     * will open system dialog but won't trigger the change event sometimes.\n     */\n    document.body.appendChild(fileInput);\n    fileInput.dispatchEvent(new MouseEvent('click'));\n  };\n\n  /**\n   * @template {import('../types').OutputFileStatus} TStatus\n   * @param {string} entryId\n   * @returns {import('../types/exported.js').OutputFileEntry<TStatus>}\n   */\n  getOutputItem(entryId) {\n    const uploadEntryData = /** @type {import('./uploadEntrySchema.js').UploadEntryData} */\n    Data.getCtx(entryId).store;\n\n    /** @type {import('@uploadcare/upload-client').UploadcareFile?} */\n    const fileInfo = uploadEntryData.fileInfo;\n\n    /** @type {import('../types').OutputFileEntry['status']} */\n    let status = uploadEntryData.isRemoved ? 'removed' : uploadEntryData.errors.length > 0 ? 'failed' : !!uploadEntryData.fileInfo ? 'success' : uploadEntryData.isUploading ? 'uploading' : 'idle';\n\n    /** @type {unknown} */\n    const outputItem = {\n      uuid: fileInfo?.uuid ?? uploadEntryData.uuid ?? null,\n      internalId: entryId,\n      name: fileInfo?.originalFilename ?? uploadEntryData.fileName,\n      size: fileInfo?.size ?? uploadEntryData.fileSize,\n      isImage: fileInfo?.isImage ?? uploadEntryData.isImage,\n      mimeType: fileInfo?.mimeType ?? uploadEntryData.mimeType,\n      file: uploadEntryData.file,\n      externalUrl: uploadEntryData.externalUrl,\n      cdnUrlModifiers: uploadEntryData.cdnUrlModifiers,\n      cdnUrl: uploadEntryData.cdnUrl ?? fileInfo?.cdnUrl ?? null,\n      fullPath: uploadEntryData.fullPath,\n      uploadProgress: uploadEntryData.uploadProgress,\n      fileInfo: fileInfo ?? null,\n      metadata: uploadEntryData.metadata ?? fileInfo?.metadata ?? null,\n      isSuccess: status === 'success',\n      isUploading: status === 'uploading',\n      isFailed: status === 'failed',\n      isRemoved: status === 'removed',\n      errors: (/** @type {import('../types/exported.js').OutputFileEntry['errors']} */uploadEntryData.errors),\n      status,\n      source: uploadEntryData?.source\n    };\n    return /** @type {import('../types/exported.js').OutputFileEntry<TStatus>} */outputItem;\n  }\n\n  /** @template {import('../types').OutputCollectionStatus} TStatus */\n  getOutputCollectionState() {\n    return /** @type {ReturnType<typeof buildOutputCollectionState<TStatus>>} */buildOutputCollectionState(this._ctx);\n  }\n\n  /** @param {Boolean} [force] */\n  initFlow = (force = false) => {\n    if (this._uploadCollection.size > 0 && !force) {\n      this._ctx.modalManager?.open(ActivityBlock.activities.UPLOAD_LIST);\n      this._ctx.set$({\n        '*currentActivity': ActivityBlock.activities.UPLOAD_LIST\n      });\n    } else {\n      if (this._sourceList?.length === 1) {\n        const srcKey = this._sourceList[0];\n\n        // TODO: We should refactor those handlers\n        if (srcKey === 'local') {\n          this._ctx.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n          this.openSystemDialog();\n          return;\n        }\n        if (srcKey === 'camera' && browserFeatures.htmlMediaCapture) {\n          const {\n            isPhotoEnabled,\n            isVideoRecordingEnabled\n          } = calcCameraModes(this.cfg);\n          if (isPhotoEnabled && isVideoRecordingEnabled) {\n            this._ctx.set$({\n              '*currentActivity': ActivityBlock.activities.START_FROM\n            });\n            return;\n          } else if (isPhotoEnabled || isVideoRecordingEnabled) {\n            this.openSystemDialog({\n              captureCamera: true,\n              modeCamera: isPhotoEnabled ? CameraSourceTypes.PHOTO : CameraSourceTypes.VIDEO\n            });\n            return;\n          } else {\n            this.openSystemDialog({\n              captureCamera: true,\n              modeCamera: CameraSourceTypes.PHOTO\n            });\n          }\n        }\n\n        /** @type {Set<import('./Block').Block>} */\n        const blocksRegistry = this._ctx.$['*blocksRegistry'];\n        /**\n         * @param {import('./Block').Block} block\n         * @returns {block is import('../blocks/SourceBtn/SourceBtn.js').SourceBtn}\n         */\n        const isSourceBtn = block => 'type' in block && block.type === srcKey;\n        const sourceBtnBlock = [...blocksRegistry].find(isSourceBtn);\n        // TODO: This is weird that we have this logic inside UI component, we should consider to move it somewhere else\n        sourceBtnBlock?.activate();\n        if (this._ctx.$['*currentActivity']) {\n          this._ctx.modalManager?.open(this._ctx.$['*currentActivity']);\n        }\n      } else {\n        // Multiple sources case:\n        this._ctx.modalManager?.open(ActivityBlock.activities.START_FROM);\n        this._ctx.set$({\n          '*currentActivity': ActivityBlock.activities.START_FROM\n        });\n      }\n    }\n  };\n  doneFlow = () => {\n    this._ctx.set$({\n      '*currentActivity': this._ctx.doneActivity,\n      '*history': this._ctx.doneActivity ? [this._ctx.doneActivity] : []\n    });\n    if (!this._ctx.$['*currentActivity']) {\n      this._ctx.modalManager.closeAll();\n    }\n  };\n\n  /**\n   * @type {<T extends import('./ActivityBlock.js').ActivityType>(\n   *   activityType: T,\n   *   ...params: T extends keyof import('./ActivityBlock.js').ActivityParamsMap\n   *     ? [import('./ActivityBlock.js').ActivityParamsMap[T]]\n   *     : T extends import('./ActivityBlock.js').RegisteredActivityType\n   *       ? [undefined?]\n   *       : [any?]\n   * ) => void}\n   */\n  setCurrentActivity = (activityType, params = undefined) => {\n    if (this._ctx.hasBlockInCtx(b => b.activityType === activityType)) {\n      this._ctx.set$({\n        '*currentActivityParams': params ?? {},\n        '*currentActivity': activityType\n      });\n      return;\n    }\n    console.warn(`Activity type \"${activityType}\" not found in the context`);\n  };\n\n  /** @returns {import('./ActivityBlock.js').ActivityType} */\n  getCurrentActivity = () => {\n    return this._ctx.$['*currentActivity'];\n  };\n\n  /** @param {boolean} opened */\n  setModalState = opened => {\n    if (opened && !this._ctx.$['*currentActivity']) {\n      console.warn(`Can't open modal without current activity. Please use \"setCurrentActivity\" method first.`);\n      return;\n    }\n    if (opened) {\n      this._ctx.modalManager?.open(this._ctx.$['*currentActivity']);\n    } else {\n      this._ctx.modalManager?.close(this._ctx.$['*currentActivity']);\n      this._ctx.$['*currentActivity'] = null;\n    }\n  };\n\n  /**\n   * @private\n   * @type {string[]}\n   */\n  get _sourceList() {\n    /** @type {string[]} */\n    let list = [];\n    if (this.cfg.sourceList) {\n      list = stringToArray(this.cfg.sourceList);\n    }\n    return list;\n  }\n}","map":{"version":3,"names":["ActivityBlock","applyStyles","Data","calcCameraModes","CameraSourceTypes","EventType","UploadSource","serializeCsv","browserFeatures","BASIC_IMAGE_WILDCARD","BASIC_VIDEO_WILDCARD","fileIsImage","IMAGE_ACCEPT_LIST","mergeFileTypes","parseCdnUrl","stringToArray","buildOutputCollectionState","UploaderPublicApi","_ctx","constructor","ctx","_uploadCollection","uploadCollection","cfg","l10n","bind","addFileFromUrl","url","silent","fileName","source","internalId","add","externalUrl","API","getOutputItem","addFileFromUuid","uuid","addFileFromCdnUrl","cdnUrl","parsedCdnUrl","cdnBase","cdnCname","Error","cdnUrlModifiers","filename","addFileFromObject","file","fullPath","isImage","mimeType","type","name","fileSize","size","removeFileByInternalId","read","remove","removeAllFiles","clearAll","uploadAll","itemsToUpload","items","filter","id","entry","getValue","length","$","Set","emit","COMMON_UPLOAD_START","getOutputCollectionState","openSystemDialog","options","accept","imgOnly","INPUT_ATTR_NAME","fileInput","document","createElement","setAttribute","opacity","height","width","visibility","position","top","left","multiple","captureCamera","capture","cameraCapture","isPhotoEnabled","isVideoRecordingEnabled","modeCamera","PHOTO","VIDEO","Boolean","join","addEventListener","files","forEach","CAMERA","LOCAL","modalManager","open","activities","UPLOAD_LIST","once","querySelectorAll","el","body","appendChild","dispatchEvent","MouseEvent","entryId","uploadEntryData","getCtx","store","fileInfo","status","isRemoved","errors","isUploading","outputItem","originalFilename","uploadProgress","metadata","isSuccess","isFailed","initFlow","force","set$","_sourceList","srcKey","htmlMediaCapture","START_FROM","blocksRegistry","isSourceBtn","block","sourceBtnBlock","find","activate","doneFlow","doneActivity","closeAll","setCurrentActivity","activityType","params","undefined","hasBlockInCtx","b","console","warn","getCurrentActivity","setModalState","opened","close","list","sourceList"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/abstract/UploaderPublicApi.js"],"sourcesContent":["// @ts-check\nimport { ActivityBlock } from './ActivityBlock.js';\n\nimport { applyStyles, Data } from '@symbiotejs/symbiote';\nimport { calcCameraModes } from '../blocks/CameraSource/calcCameraModes.js';\nimport { CameraSourceTypes } from '../blocks/CameraSource/constants.js';\nimport { EventType } from '../blocks/UploadCtxProvider/EventEmitter.js';\nimport { UploadSource } from '../blocks/utils/UploadSource.js';\nimport { serializeCsv } from '../blocks/utils/comma-separated.js';\nimport { browserFeatures } from '../utils/browser-info.js';\nimport {\n  BASIC_IMAGE_WILDCARD,\n  BASIC_VIDEO_WILDCARD,\n  fileIsImage,\n  IMAGE_ACCEPT_LIST,\n  mergeFileTypes,\n} from '../utils/fileTypes.js';\nimport { parseCdnUrl } from '../utils/parseCdnUrl.js';\nimport { stringToArray } from '../utils/stringToArray.js';\nimport { buildOutputCollectionState } from './buildOutputCollectionState.js';\n\nexport class UploaderPublicApi {\n  /**\n   * @private\n   * @type {import('./UploaderBlock.js').UploaderBlock}\n   */\n  _ctx;\n\n  /** @param {import('./UploaderBlock.js').UploaderBlock} ctx */\n  constructor(ctx) {\n    this._ctx = ctx;\n  }\n\n  /** @private */\n  get _uploadCollection() {\n    return this._ctx.uploadCollection;\n  }\n\n  get cfg() {\n    return this._ctx.cfg;\n  }\n\n  get l10n() {\n    return this._ctx.l10n.bind(this._ctx);\n  }\n\n  /**\n   * TODO: Probably we should not allow user to override `source` property\n   *\n   * @param {string} url\n   * @param {{ silent?: boolean; fileName?: string; source?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromUrl = (url, { silent, fileName, source } = {}) => {\n    const internalId = this._uploadCollection.add({\n      externalUrl: url,\n      fileName: fileName ?? null,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API,\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /**\n   * @param {string} uuid\n   * @param {{ silent?: boolean; fileName?: string; source?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromUuid = (uuid, { silent, fileName, source } = {}) => {\n    const internalId = this._uploadCollection.add({\n      uuid,\n      fileName: fileName ?? null,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API,\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /**\n   * @param {string} cdnUrl\n   * @param {{ silent?: boolean; fileName?: string; source?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromCdnUrl = (cdnUrl, { silent, fileName, source } = {}) => {\n    const parsedCdnUrl = parseCdnUrl({ url: cdnUrl, cdnBase: this.cfg.cdnCname });\n    if (!parsedCdnUrl) {\n      throw new Error('Invalid CDN URL');\n    }\n    const internalId = this._uploadCollection.add({\n      uuid: parsedCdnUrl.uuid,\n      cdnUrl,\n      cdnUrlModifiers: parsedCdnUrl.cdnUrlModifiers,\n      fileName: fileName ?? parsedCdnUrl.filename ?? null,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API,\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /**\n   * @param {File} file\n   * @param {{ silent?: boolean; fileName?: string; source?: string; fullPath?: string }} [options]\n   * @returns {import('../types').OutputFileEntry<'idle'>}\n   */\n  addFileFromObject = (file, { silent, fileName, source, fullPath } = {}) => {\n    const internalId = this._uploadCollection.add({\n      file,\n      isImage: fileIsImage(file),\n      mimeType: file.type,\n      fileName: fileName ?? file.name,\n      fileSize: file.size,\n      silent: silent ?? false,\n      source: source ?? UploadSource.API,\n      fullPath: fullPath ?? null,\n    });\n    return this.getOutputItem(internalId);\n  };\n\n  /** @param {string} internalId */\n  removeFileByInternalId = (internalId) => {\n    if (!this._uploadCollection.read(internalId)) {\n      throw new Error(`File with internalId ${internalId} not found`);\n    }\n    this._uploadCollection.remove(internalId);\n  };\n\n  removeAllFiles() {\n    this._uploadCollection.clearAll();\n  }\n\n  uploadAll = () => {\n    const itemsToUpload = this._uploadCollection.items().filter((id) => {\n      const entry = this._uploadCollection.read(id);\n      if (!entry) return false;\n      return !entry.getValue('isRemoved') && !entry.getValue('isUploading') && !entry.getValue('fileInfo');\n    });\n\n    if (itemsToUpload.length === 0) {\n      return;\n    }\n\n    this._ctx.$['*uploadTrigger'] = new Set(itemsToUpload);\n    this._ctx.emit(\n      EventType.COMMON_UPLOAD_START,\n      /** @type {import('../types').OutputCollectionState<'uploading'>} */ (this.getOutputCollectionState()),\n    );\n  };\n\n  /** @param {{ captureCamera?: boolean; modeCamera?: import('../blocks/CameraSource/constants.js').ModeCameraType }} options */\n  openSystemDialog = (options = {}) => {\n    const accept = serializeCsv(\n      mergeFileTypes([this.cfg.accept ?? '', ...(this.cfg.imgOnly ? IMAGE_ACCEPT_LIST : [])]),\n    );\n    const INPUT_ATTR_NAME = 'uploadcare-file-input';\n    const fileInput = document.createElement('input');\n    fileInput.setAttribute(INPUT_ATTR_NAME, '');\n    applyStyles(fileInput, {\n      opacity: 0,\n      height: 0,\n      width: 0,\n      visibility: 'hidden',\n      position: 'absolute',\n      top: 0,\n      left: 0,\n    });\n    fileInput.type = 'file';\n    fileInput.multiple = this.cfg.multiple;\n    if (options.captureCamera) {\n      fileInput.capture = this.cfg.cameraCapture;\n      const { isPhotoEnabled, isVideoRecordingEnabled } = calcCameraModes(this.cfg);\n\n      if (options.modeCamera === CameraSourceTypes.PHOTO && isPhotoEnabled) {\n        fileInput.accept = BASIC_IMAGE_WILDCARD;\n      } else if (options.modeCamera === CameraSourceTypes.VIDEO && isVideoRecordingEnabled) {\n        fileInput.accept = BASIC_VIDEO_WILDCARD;\n      } else {\n        fileInput.accept = [BASIC_IMAGE_WILDCARD, isVideoRecordingEnabled && BASIC_VIDEO_WILDCARD]\n          .filter(Boolean)\n          .join(',');\n      }\n    } else {\n      fileInput.accept = accept;\n    }\n    fileInput.addEventListener(\n      'change',\n      () => {\n        if (!fileInput.files) {\n          return;\n        }\n        [...fileInput.files].forEach((file) =>\n          this.addFileFromObject(file, { source: options.captureCamera ? UploadSource.CAMERA : UploadSource.LOCAL }),\n        );\n        // To call uploadTrigger UploadList should draw file items first:\n        this._ctx.modalManager.open(ActivityBlock.activities.UPLOAD_LIST);\n        this._ctx.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n        fileInput.remove();\n      },\n      {\n        once: true,\n      },\n    );\n\n    document.querySelectorAll(`[${INPUT_ATTR_NAME}]`).forEach((el) => el.remove());\n\n    /**\n     * Some browsers (e.g. Safari) require the file input to be in the DOM to work properly. Without it the file input\n     * will open system dialog but won't trigger the change event sometimes.\n     */\n    document.body.appendChild(fileInput);\n    fileInput.dispatchEvent(new MouseEvent('click'));\n  };\n\n  /**\n   * @template {import('../types').OutputFileStatus} TStatus\n   * @param {string} entryId\n   * @returns {import('../types/exported.js').OutputFileEntry<TStatus>}\n   */\n  getOutputItem(entryId) {\n    const uploadEntryData = /** @type {import('./uploadEntrySchema.js').UploadEntryData} */ (\n      Data.getCtx(entryId).store\n    );\n\n    /** @type {import('@uploadcare/upload-client').UploadcareFile?} */\n    const fileInfo = uploadEntryData.fileInfo;\n\n    /** @type {import('../types').OutputFileEntry['status']} */\n    let status = uploadEntryData.isRemoved\n      ? 'removed'\n      : uploadEntryData.errors.length > 0\n        ? 'failed'\n        : !!uploadEntryData.fileInfo\n          ? 'success'\n          : uploadEntryData.isUploading\n            ? 'uploading'\n            : 'idle';\n\n    /** @type {unknown} */\n    const outputItem = {\n      uuid: fileInfo?.uuid ?? uploadEntryData.uuid ?? null,\n      internalId: entryId,\n      name: fileInfo?.originalFilename ?? uploadEntryData.fileName,\n      size: fileInfo?.size ?? uploadEntryData.fileSize,\n      isImage: fileInfo?.isImage ?? uploadEntryData.isImage,\n      mimeType: fileInfo?.mimeType ?? uploadEntryData.mimeType,\n      file: uploadEntryData.file,\n      externalUrl: uploadEntryData.externalUrl,\n      cdnUrlModifiers: uploadEntryData.cdnUrlModifiers,\n      cdnUrl: uploadEntryData.cdnUrl ?? fileInfo?.cdnUrl ?? null,\n      fullPath: uploadEntryData.fullPath,\n      uploadProgress: uploadEntryData.uploadProgress,\n      fileInfo: fileInfo ?? null,\n      metadata: uploadEntryData.metadata ?? fileInfo?.metadata ?? null,\n      isSuccess: status === 'success',\n      isUploading: status === 'uploading',\n      isFailed: status === 'failed',\n      isRemoved: status === 'removed',\n      errors: /** @type {import('../types/exported.js').OutputFileEntry['errors']} */ (uploadEntryData.errors),\n      status,\n      source: uploadEntryData?.source,\n    };\n\n    return /** @type {import('../types/exported.js').OutputFileEntry<TStatus>} */ (outputItem);\n  }\n\n  /** @template {import('../types').OutputCollectionStatus} TStatus */\n  getOutputCollectionState() {\n    return /** @type {ReturnType<typeof buildOutputCollectionState<TStatus>>} */ (\n      buildOutputCollectionState(this._ctx)\n    );\n  }\n\n  /** @param {Boolean} [force] */\n  initFlow = (force = false) => {\n    if (this._uploadCollection.size > 0 && !force) {\n      this._ctx.modalManager?.open(ActivityBlock.activities.UPLOAD_LIST);\n      this._ctx.set$({\n        '*currentActivity': ActivityBlock.activities.UPLOAD_LIST,\n      });\n    } else {\n      if (this._sourceList?.length === 1) {\n        const srcKey = this._sourceList[0];\n\n        // TODO: We should refactor those handlers\n        if (srcKey === 'local') {\n          this._ctx.$['*currentActivity'] = ActivityBlock.activities.UPLOAD_LIST;\n          this.openSystemDialog();\n          return;\n        }\n\n        if (srcKey === 'camera' && browserFeatures.htmlMediaCapture) {\n          const { isPhotoEnabled, isVideoRecordingEnabled } = calcCameraModes(this.cfg);\n\n          if (isPhotoEnabled && isVideoRecordingEnabled) {\n            this._ctx.set$({\n              '*currentActivity': ActivityBlock.activities.START_FROM,\n            });\n            return;\n          } else if (isPhotoEnabled || isVideoRecordingEnabled) {\n            this.openSystemDialog({\n              captureCamera: true,\n              modeCamera: isPhotoEnabled ? CameraSourceTypes.PHOTO : CameraSourceTypes.VIDEO,\n            });\n            return;\n          } else {\n            this.openSystemDialog({\n              captureCamera: true,\n              modeCamera: CameraSourceTypes.PHOTO,\n            });\n          }\n        }\n\n        /** @type {Set<import('./Block').Block>} */\n        const blocksRegistry = this._ctx.$['*blocksRegistry'];\n        /**\n         * @param {import('./Block').Block} block\n         * @returns {block is import('../blocks/SourceBtn/SourceBtn.js').SourceBtn}\n         */\n        const isSourceBtn = (block) => 'type' in block && block.type === srcKey;\n        const sourceBtnBlock = [...blocksRegistry].find(isSourceBtn);\n        // TODO: This is weird that we have this logic inside UI component, we should consider to move it somewhere else\n        sourceBtnBlock?.activate();\n\n        if (this._ctx.$['*currentActivity']) {\n          this._ctx.modalManager?.open(this._ctx.$['*currentActivity']);\n        }\n      } else {\n        // Multiple sources case:\n        this._ctx.modalManager?.open(ActivityBlock.activities.START_FROM);\n        this._ctx.set$({\n          '*currentActivity': ActivityBlock.activities.START_FROM,\n        });\n      }\n    }\n  };\n\n  doneFlow = () => {\n    this._ctx.set$({\n      '*currentActivity': this._ctx.doneActivity,\n      '*history': this._ctx.doneActivity ? [this._ctx.doneActivity] : [],\n    });\n    if (!this._ctx.$['*currentActivity']) {\n      this._ctx.modalManager.closeAll();\n    }\n  };\n\n  /**\n   * @type {<T extends import('./ActivityBlock.js').ActivityType>(\n   *   activityType: T,\n   *   ...params: T extends keyof import('./ActivityBlock.js').ActivityParamsMap\n   *     ? [import('./ActivityBlock.js').ActivityParamsMap[T]]\n   *     : T extends import('./ActivityBlock.js').RegisteredActivityType\n   *       ? [undefined?]\n   *       : [any?]\n   * ) => void}\n   */\n  setCurrentActivity = (activityType, params = undefined) => {\n    if (this._ctx.hasBlockInCtx((b) => b.activityType === activityType)) {\n      this._ctx.set$({\n        '*currentActivityParams': params ?? {},\n        '*currentActivity': activityType,\n      });\n      return;\n    }\n    console.warn(`Activity type \"${activityType}\" not found in the context`);\n  };\n\n  /** @returns {import('./ActivityBlock.js').ActivityType} */\n  getCurrentActivity = () => {\n    return this._ctx.$['*currentActivity'];\n  };\n\n  /** @param {boolean} opened */\n  setModalState = (opened) => {\n    if (opened && !this._ctx.$['*currentActivity']) {\n      console.warn(`Can't open modal without current activity. Please use \"setCurrentActivity\" method first.`);\n      return;\n    }\n\n    if (opened) {\n      this._ctx.modalManager?.open(this._ctx.$['*currentActivity']);\n    } else {\n      this._ctx.modalManager?.close(this._ctx.$['*currentActivity']);\n      this._ctx.$['*currentActivity'] = null;\n    }\n  };\n\n  /**\n   * @private\n   * @type {string[]}\n   */\n  get _sourceList() {\n    /** @type {string[]} */\n    let list = [];\n    if (this.cfg.sourceList) {\n      list = stringToArray(this.cfg.sourceList);\n    }\n    return list;\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}