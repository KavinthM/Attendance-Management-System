{"ast":null,"code":"// @ts-check\nimport { Block } from '../../../abstract/Block.js';\nimport { clamp, constraintRect, cornerPath, createSvgNode, moveRect, rectContainsPoint, resizeRect, roundRect, setSvgNodeAttrs, sidePath, thumbCursor } from './crop-utils.js';\nimport { GUIDE_STROKE_WIDTH, GUIDE_THIRD, MAX_INTERACTION_SIZE, MIN_CROP_SIZE, MIN_INTERACTION_SIZE, THUMB_CORNER_SIZE, THUMB_SIDE_SIZE, THUMB_STROKE_WIDTH } from './cropper-constants.js';\nimport { classNames } from './lib/classNames.js';\nexport class CropFrame extends Block {\n  constructor() {\n    super();\n    this.init$ = {\n      ...this.init$,\n      dragging: false\n    };\n\n    /** @private */\n    this._handlePointerUp = this._handlePointerUp_.bind(this);\n\n    /** @private */\n    this._handlePointerMove = this._handlePointerMove_.bind(this);\n\n    /** @private */\n    this._handleSvgPointerMove = this._handleSvgPointerMove_.bind(this);\n  }\n\n  /**\n   * @private\n   * @param {import('./types.js').Direction} direction\n   */\n  _shouldThumbBeDisabled(direction) {\n    let imageBox = this.$['*imageBox'];\n    if (!imageBox) {\n      return;\n    }\n    if (direction === '' && imageBox.height <= MIN_CROP_SIZE && imageBox.width <= MIN_CROP_SIZE) {\n      return true;\n    }\n    let tooHigh = imageBox.height <= MIN_CROP_SIZE && (direction.includes('n') || direction.includes('s'));\n    let tooWide = imageBox.width <= MIN_CROP_SIZE && (direction.includes('e') || direction.includes('w'));\n    return tooHigh || tooWide;\n  }\n\n  /** @private */\n  _createBackdrop() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    let {\n      x,\n      y,\n      width,\n      height\n    } = cropBox;\n    let svg = this.ref['svg-el'];\n    let mask = createSvgNode('mask', {\n      id: 'backdrop-mask'\n    });\n    let maskRectOuter = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'white'\n    });\n    let maskRectInner = createSvgNode('rect', {\n      x,\n      y,\n      width,\n      height,\n      fill: 'black'\n    });\n    mask.appendChild(maskRectOuter);\n    mask.appendChild(maskRectInner);\n    let backdropRect = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'var(--color-image-background)',\n      'fill-opacity': 0.85,\n      mask: 'url(#backdrop-mask)'\n    });\n    svg.appendChild(backdropRect);\n    svg.appendChild(mask);\n    this._backdropMask = mask;\n    this._backdropMaskInner = maskRectInner;\n  }\n\n  /**\n   * @private Super Tricky workaround for the chromium bug See\n   *   https://bugs.chromium.org/p/chromium/issues/detail?id=330815\n   */\n  _resizeBackdrop() {\n    if (!this._backdropMask) {\n      return;\n    }\n    this._backdropMask.style.display = 'none';\n    window.requestAnimationFrame(() => {\n      if (this._backdropMask) {\n        this._backdropMask.style.display = 'block';\n      }\n    });\n  }\n\n  /** @private */\n  _updateBackdrop() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    let {\n      x,\n      y,\n      width,\n      height\n    } = cropBox;\n    this._backdropMaskInner && setSvgNodeAttrs(this._backdropMaskInner, {\n      x,\n      y,\n      width,\n      height\n    });\n  }\n\n  /** @private */\n  _updateFrame() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox || !this._frameGuides || !this._frameThumbs) {\n      return;\n    }\n    for (let thumb of Object.values(this._frameThumbs)) {\n      let {\n        direction,\n        pathNode,\n        interactionNode,\n        groupNode\n      } = thumb;\n      let isCenter = direction === '';\n      let isCorner = direction.length === 2;\n      let {\n        x,\n        y,\n        width,\n        height\n      } = cropBox;\n      if (isCenter) {\n        const moveThumbRect = {\n          x,\n          y,\n          width,\n          height\n        };\n        setSvgNodeAttrs(interactionNode, moveThumbRect);\n      } else {\n        const thumbSizeMultiplier = clamp(Math.min(width, height) / (THUMB_CORNER_SIZE * 2 + THUMB_SIDE_SIZE) / 2, 0, 1);\n        let {\n          d,\n          center\n        } = isCorner ? cornerPath(cropBox, direction, thumbSizeMultiplier) : sidePath(cropBox, /** @type {Extract<import('./types.js').Direction, 'n' | 's' | 'w' | 'e'>} */direction, thumbSizeMultiplier);\n        const size = Math.max(MAX_INTERACTION_SIZE * clamp(Math.min(width, height) / MAX_INTERACTION_SIZE / 3, 0, 1), MIN_INTERACTION_SIZE);\n        setSvgNodeAttrs(interactionNode, {\n          x: center[0] - size,\n          y: center[1] - size,\n          width: size * 2,\n          height: size * 2\n        });\n        setSvgNodeAttrs(pathNode, {\n          d\n        });\n      }\n      let disableThumb = this._shouldThumbBeDisabled(direction);\n      groupNode.setAttribute('class', classNames('uc-thumb', {\n        'uc-thumb--hidden': disableThumb,\n        'uc-thumb--visible': !disableThumb\n      }));\n    }\n    setSvgNodeAttrs(this._frameGuides, {\n      x: cropBox.x - GUIDE_STROKE_WIDTH * 0.5,\n      y: cropBox.y - GUIDE_STROKE_WIDTH * 0.5,\n      width: cropBox.width + GUIDE_STROKE_WIDTH,\n      height: cropBox.height + GUIDE_STROKE_WIDTH\n    });\n  }\n\n  /**\n   * @param {import('./types.js').FrameThumbs} frameThumbs\n   * @param {import('./types.js').Direction} direction\n   */\n  _createThumb(frameThumbs, direction) {\n    let groupNode = createSvgNode('g');\n    groupNode.classList.add('uc-thumb');\n    groupNode.setAttribute('with-effects', '');\n    let interactionNode = createSvgNode('rect', {\n      fill: 'transparent'\n    });\n    let pathNode = createSvgNode('path', {\n      stroke: 'currentColor',\n      fill: 'none',\n      'stroke-width': THUMB_STROKE_WIDTH\n    });\n    groupNode.appendChild(pathNode);\n    groupNode.appendChild(interactionNode);\n    frameThumbs[direction] = {\n      direction,\n      pathNode,\n      interactionNode,\n      groupNode\n    };\n    if (direction === '') {\n      groupNode.style.cursor = 'move';\n    }\n    interactionNode.addEventListener('pointerdown', this._handlePointerDown.bind(this, direction));\n  }\n\n  /** @private */\n  _createThumbs() {\n    /** @type {import('./types.js').FrameThumbs} */\n    const frameThumbs = {};\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        let direction = /** @type {import('./types.js').Direction} */`${['n', '', 's'][i]}${['w', '', 'e'][j]}`;\n        if (direction === '') {\n          continue;\n        }\n        this._createThumb(frameThumbs, direction);\n      }\n    }\n    this._createThumb(frameThumbs, '');\n    return frameThumbs;\n  }\n\n  /** @private */\n  _createGuides() {\n    let svg = createSvgNode('svg');\n    let rect = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'none',\n      stroke: 'currentColor',\n      'stroke-width': GUIDE_STROKE_WIDTH,\n      'stroke-opacity': 0.5\n    });\n    svg.appendChild(rect);\n    for (let i = 1; i <= 2; i++) {\n      let line = createSvgNode('line', {\n        x1: `${GUIDE_THIRD * i}%`,\n        y1: `0%`,\n        x2: `${GUIDE_THIRD * i}%`,\n        y2: `100%`,\n        stroke: 'currentColor',\n        'stroke-width': GUIDE_STROKE_WIDTH,\n        'stroke-opacity': 0.3\n      });\n      svg.appendChild(line);\n    }\n    for (let i = 1; i <= 2; i++) {\n      let line = createSvgNode('line', {\n        x1: `0%`,\n        y1: `${GUIDE_THIRD * i}%`,\n        x2: `100%`,\n        y2: `${GUIDE_THIRD * i}%`,\n        stroke: 'currentColor',\n        'stroke-width': GUIDE_STROKE_WIDTH,\n        'stroke-opacity': 0.3\n      });\n      svg.appendChild(line);\n    }\n    svg.classList.add('uc-guides', 'uc-guides--semi-hidden');\n    return svg;\n  }\n\n  /** @private */\n  _createFrame() {\n    let svg = this.ref['svg-el'];\n    let fr = document.createDocumentFragment();\n    let frameGuides = this._createGuides();\n    fr.appendChild(frameGuides);\n    let frameThumbs = this._createThumbs();\n    for (let {\n      groupNode\n    } of Object.values(frameThumbs)) {\n      fr.appendChild(groupNode);\n    }\n    svg.appendChild(fr);\n    this._frameThumbs = frameThumbs;\n    this._frameGuides = frameGuides;\n  }\n\n  /**\n   * @private\n   * @param {import('./types.js').Direction} direction\n   * @param {PointerEvent} e\n   */\n  _handlePointerDown(direction, e) {\n    if (!this._frameThumbs) return;\n    let thumb = this._frameThumbs[direction];\n    if (this._shouldThumbBeDisabled(direction)) {\n      return;\n    }\n    let cropBox = this.$['*cropBox'];\n    let {\n      x: svgX,\n      y: svgY\n    } = this.ref['svg-el'].getBoundingClientRect();\n    let x = e.x - svgX;\n    let y = e.y - svgY;\n    this.$.dragging = true;\n    this._draggingThumb = thumb;\n    this._dragStartPoint = [x, y];\n    /** @type {import('./types.js').Rectangle} */\n    this._dragStartCrop = {\n      ...cropBox\n    };\n  }\n\n  /**\n   * @private\n   * @param {PointerEvent} e\n   */\n  _handlePointerUp_(e) {\n    this._updateCursor();\n    if (!this.$.dragging) {\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n    this.$.dragging = false;\n  }\n\n  /**\n   * @private\n   * @param {PointerEvent} e\n   */\n  _handlePointerMove_(e) {\n    if (!this.$.dragging || !this._dragStartPoint || !this._draggingThumb) {\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n    let svg = this.ref['svg-el'];\n    let {\n      x: svgX,\n      y: svgY\n    } = svg.getBoundingClientRect();\n    let x = e.x - svgX;\n    let y = e.y - svgY;\n    let dx = x - this._dragStartPoint[0];\n    let dy = y - this._dragStartPoint[1];\n    let {\n      direction\n    } = this._draggingThumb;\n    const movedCropBox = this._calcCropBox(direction, [dx, dy]);\n    if (movedCropBox) {\n      this.$['*cropBox'] = movedCropBox;\n    }\n  }\n\n  /**\n   * @private\n   * @param {import('./types.js').Direction} direction\n   * @param {[Number, Number]} delta\n   */\n  _calcCropBox(direction, delta) {\n    const [dx, dy] = delta;\n    /** @type {import('./types.js').Rectangle} */\n    let imageBox = this.$['*imageBox'];\n    let rect = /** @type {import('./types.js').Rectangle} */this._dragStartCrop ?? this.$['*cropBox'];\n    /** @type {import('./types.js').CropPresetList[0]} */\n    const cropPreset = this.$['*cropPresetList']?.[0];\n    const aspectRatio = cropPreset ? cropPreset.width / cropPreset.height : undefined;\n    if (direction === '') {\n      rect = moveRect({\n        rect,\n        delta: [dx, dy],\n        imageBox\n      });\n    } else {\n      rect = resizeRect({\n        rect,\n        delta: [dx, dy],\n        direction,\n        aspectRatio,\n        imageBox\n      });\n    }\n    if (!Object.values(rect).every(number => Number.isFinite(number) && number >= 0)) {\n      console.error('CropFrame is trying to create invalid rectangle', {\n        payload: rect\n      });\n      return;\n    }\n    return constraintRect(roundRect(rect), this.$['*imageBox']);\n  }\n\n  /**\n   * @private\n   * @param {PointerEvent} e\n   */\n  _handleSvgPointerMove_(e) {\n    if (!this._frameThumbs) return;\n    let hoverThumb = Object.values(this._frameThumbs).find(thumb => {\n      if (this._shouldThumbBeDisabled(thumb.direction)) {\n        return false;\n      }\n      let node = thumb.interactionNode;\n      let bounds = node.getBoundingClientRect();\n      let rect = {\n        x: bounds.x,\n        y: bounds.y,\n        width: bounds.width,\n        height: bounds.height\n      };\n      let hover = rectContainsPoint(rect, [e.x, e.y]);\n      return hover;\n    });\n    this._hoverThumb = hoverThumb;\n    this._updateCursor();\n  }\n\n  /** @private */\n  _updateCursor() {\n    let hoverThumb = this._hoverThumb;\n    this.ref['svg-el'].style.cursor = hoverThumb ? thumbCursor(hoverThumb.direction) : 'initial';\n  }\n\n  /**\n   * @private\n   * @param {String} href\n   */\n  _createMask(href) {\n    if (this._frameImage) {\n      this._frameImage.setAttribute('href', href);\n      return;\n    }\n    let svg = this.ref['svg-el'];\n    let fr = document.createDocumentFragment();\n    let imageNode = createSvgNode('image', {\n      href\n    });\n    imageNode.setAttribute('class', 'uc-cloud-mask');\n    fr.appendChild(imageNode);\n    svg.appendChild(fr);\n    this._frameImage = imageNode;\n  }\n  _updateMask() {\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox || !this._frameImage) {\n      return;\n    }\n    let {\n      x,\n      y,\n      width,\n      height\n    } = cropBox;\n    setSvgNodeAttrs(this._frameImage, {\n      x,\n      y,\n      height,\n      width\n    });\n  }\n\n  /** @private */\n  _render() {\n    this._updateBackdrop();\n    this._updateFrame();\n    this._updateMask();\n  }\n\n  /** @param {boolean} visible */\n  toggleThumbs(visible) {\n    if (!this._frameThumbs) return;\n    Object.values(this._frameThumbs).map(({\n      groupNode\n    }) => groupNode).forEach(groupNode => {\n      groupNode.setAttribute('class', classNames('uc-thumb', {\n        'uc-thumb--hidden': !visible,\n        'uc-thumb--visible': visible\n      }));\n    });\n  }\n  initCallback() {\n    super.initCallback();\n    this._createBackdrop();\n    this._createFrame();\n    this.sub('*imageBox', () => {\n      this._resizeBackdrop();\n      window.requestAnimationFrame(() => {\n        this._render();\n      });\n    });\n    this.sub('*cropBox', cropBox => {\n      if (!cropBox) {\n        return;\n      }\n      this._guidesHidden = cropBox.height <= MIN_CROP_SIZE || cropBox.width <= MIN_CROP_SIZE;\n      window.requestAnimationFrame(() => {\n        this._render();\n      });\n    });\n    this.subConfigValue('cloudImageEditorMaskHref', maskHref => {\n      if (maskHref) {\n        this._createMask(maskHref);\n      }\n    });\n    this.sub('dragging', dragging => {\n      if (!this._frameGuides) return;\n      this._frameGuides.setAttribute('class', classNames({\n        'uc-guides--hidden': this._guidesHidden,\n        'uc-guides--visible': !this._guidesHidden && dragging,\n        'uc-guides--semi-hidden': !this._guidesHidden && !dragging\n      }));\n    });\n    this.ref['svg-el'].addEventListener('pointermove', this._handleSvgPointerMove, true);\n    document.addEventListener('pointermove', this._handlePointerMove, true);\n    document.addEventListener('pointerup', this._handlePointerUp, true);\n  }\n  destroyCallback() {\n    super.destroyCallback();\n    document.removeEventListener('pointermove', this._handlePointerMove);\n    document.removeEventListener('pointerup', this._handlePointerUp);\n  }\n}\nCropFrame.template = /* HTML */` <svg class=\"uc-svg\" ref=\"svg-el\" xmlns=\"http://www.w3.org/2000/svg\"></svg> `;","map":{"version":3,"names":["Block","clamp","constraintRect","cornerPath","createSvgNode","moveRect","rectContainsPoint","resizeRect","roundRect","setSvgNodeAttrs","sidePath","thumbCursor","GUIDE_STROKE_WIDTH","GUIDE_THIRD","MAX_INTERACTION_SIZE","MIN_CROP_SIZE","MIN_INTERACTION_SIZE","THUMB_CORNER_SIZE","THUMB_SIDE_SIZE","THUMB_STROKE_WIDTH","classNames","CropFrame","constructor","init$","dragging","_handlePointerUp","_handlePointerUp_","bind","_handlePointerMove","_handlePointerMove_","_handleSvgPointerMove","_handleSvgPointerMove_","_shouldThumbBeDisabled","direction","imageBox","$","height","width","tooHigh","includes","tooWide","_createBackdrop","cropBox","x","y","svg","ref","mask","id","maskRectOuter","fill","maskRectInner","appendChild","backdropRect","_backdropMask","_backdropMaskInner","_resizeBackdrop","style","display","window","requestAnimationFrame","_updateBackdrop","_updateFrame","_frameGuides","_frameThumbs","thumb","Object","values","pathNode","interactionNode","groupNode","isCenter","isCorner","length","moveThumbRect","thumbSizeMultiplier","Math","min","d","center","size","max","disableThumb","setAttribute","_createThumb","frameThumbs","classList","add","stroke","cursor","addEventListener","_handlePointerDown","_createThumbs","i","j","_createGuides","rect","line","x1","y1","x2","y2","_createFrame","fr","document","createDocumentFragment","frameGuides","e","svgX","svgY","getBoundingClientRect","_draggingThumb","_dragStartPoint","_dragStartCrop","_updateCursor","stopPropagation","preventDefault","dx","dy","movedCropBox","_calcCropBox","delta","cropPreset","aspectRatio","undefined","every","number","Number","isFinite","console","error","payload","hoverThumb","find","node","bounds","hover","_hoverThumb","_createMask","href","_frameImage","imageNode","_updateMask","_render","toggleThumbs","visible","map","forEach","initCallback","sub","_guidesHidden","subConfigValue","maskHref","destroyCallback","removeEventListener","template"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/node_modules/@uploadcare/file-uploader/blocks/CloudImageEditor/src/CropFrame.js"],"sourcesContent":["// @ts-check\nimport { Block } from '../../../abstract/Block.js';\nimport {\n  clamp,\n  constraintRect,\n  cornerPath,\n  createSvgNode,\n  moveRect,\n  rectContainsPoint,\n  resizeRect,\n  roundRect,\n  setSvgNodeAttrs,\n  sidePath,\n  thumbCursor,\n} from './crop-utils.js';\nimport {\n  GUIDE_STROKE_WIDTH,\n  GUIDE_THIRD,\n  MAX_INTERACTION_SIZE,\n  MIN_CROP_SIZE,\n  MIN_INTERACTION_SIZE,\n  THUMB_CORNER_SIZE,\n  THUMB_SIDE_SIZE,\n  THUMB_STROKE_WIDTH,\n} from './cropper-constants.js';\nimport { classNames } from './lib/classNames.js';\n\nexport class CropFrame extends Block {\n  constructor() {\n    super();\n\n    this.init$ = {\n      ...this.init$,\n      dragging: false,\n    };\n\n    /** @private */\n    this._handlePointerUp = this._handlePointerUp_.bind(this);\n\n    /** @private */\n    this._handlePointerMove = this._handlePointerMove_.bind(this);\n\n    /** @private */\n    this._handleSvgPointerMove = this._handleSvgPointerMove_.bind(this);\n  }\n\n  /**\n   * @private\n   * @param {import('./types.js').Direction} direction\n   */\n  _shouldThumbBeDisabled(direction) {\n    let imageBox = this.$['*imageBox'];\n    if (!imageBox) {\n      return;\n    }\n\n    if (direction === '' && imageBox.height <= MIN_CROP_SIZE && imageBox.width <= MIN_CROP_SIZE) {\n      return true;\n    }\n\n    let tooHigh = imageBox.height <= MIN_CROP_SIZE && (direction.includes('n') || direction.includes('s'));\n    let tooWide = imageBox.width <= MIN_CROP_SIZE && (direction.includes('e') || direction.includes('w'));\n    return tooHigh || tooWide;\n  }\n\n  /** @private */\n  _createBackdrop() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    let { x, y, width, height } = cropBox;\n    let svg = this.ref['svg-el'];\n\n    let mask = createSvgNode('mask', { id: 'backdrop-mask' });\n    let maskRectOuter = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'white',\n    });\n    let maskRectInner = createSvgNode('rect', {\n      x,\n      y,\n      width,\n      height,\n      fill: 'black',\n    });\n    mask.appendChild(maskRectOuter);\n    mask.appendChild(maskRectInner);\n\n    let backdropRect = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'var(--color-image-background)',\n      'fill-opacity': 0.85,\n      mask: 'url(#backdrop-mask)',\n    });\n    svg.appendChild(backdropRect);\n    svg.appendChild(mask);\n\n    this._backdropMask = mask;\n    this._backdropMaskInner = maskRectInner;\n  }\n\n  /**\n   * @private Super Tricky workaround for the chromium bug See\n   *   https://bugs.chromium.org/p/chromium/issues/detail?id=330815\n   */\n  _resizeBackdrop() {\n    if (!this._backdropMask) {\n      return;\n    }\n    this._backdropMask.style.display = 'none';\n    window.requestAnimationFrame(() => {\n      if (this._backdropMask) {\n        this._backdropMask.style.display = 'block';\n      }\n    });\n  }\n\n  /** @private */\n  _updateBackdrop() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n    if (!cropBox) {\n      return;\n    }\n    let { x, y, width, height } = cropBox;\n\n    this._backdropMaskInner && setSvgNodeAttrs(this._backdropMaskInner, { x, y, width, height });\n  }\n\n  /** @private */\n  _updateFrame() {\n    /** @type {import('./types.js').Rectangle} */\n    let cropBox = this.$['*cropBox'];\n\n    if (!cropBox || !this._frameGuides || !this._frameThumbs) {\n      return;\n    }\n    for (let thumb of Object.values(this._frameThumbs)) {\n      let { direction, pathNode, interactionNode, groupNode } = thumb;\n      let isCenter = direction === '';\n      let isCorner = direction.length === 2;\n      let { x, y, width, height } = cropBox;\n\n      if (isCenter) {\n        const moveThumbRect = {\n          x,\n          y,\n          width,\n          height,\n        };\n        setSvgNodeAttrs(interactionNode, moveThumbRect);\n      } else {\n        const thumbSizeMultiplier = clamp(\n          Math.min(width, height) / (THUMB_CORNER_SIZE * 2 + THUMB_SIDE_SIZE) / 2,\n          0,\n          1,\n        );\n\n        let { d, center } = isCorner\n          ? cornerPath(cropBox, direction, thumbSizeMultiplier)\n          : sidePath(\n              cropBox,\n              /** @type {Extract<import('./types.js').Direction, 'n' | 's' | 'w' | 'e'>} */ (direction),\n              thumbSizeMultiplier,\n            );\n        const size = Math.max(\n          MAX_INTERACTION_SIZE * clamp(Math.min(width, height) / MAX_INTERACTION_SIZE / 3, 0, 1),\n          MIN_INTERACTION_SIZE,\n        );\n        setSvgNodeAttrs(interactionNode, {\n          x: center[0] - size,\n          y: center[1] - size,\n          width: size * 2,\n          height: size * 2,\n        });\n        setSvgNodeAttrs(pathNode, { d });\n      }\n\n      let disableThumb = this._shouldThumbBeDisabled(direction);\n      groupNode.setAttribute(\n        'class',\n        classNames('uc-thumb', {\n          'uc-thumb--hidden': disableThumb,\n          'uc-thumb--visible': !disableThumb,\n        }),\n      );\n    }\n\n    setSvgNodeAttrs(this._frameGuides, {\n      x: cropBox.x - GUIDE_STROKE_WIDTH * 0.5,\n      y: cropBox.y - GUIDE_STROKE_WIDTH * 0.5,\n      width: cropBox.width + GUIDE_STROKE_WIDTH,\n      height: cropBox.height + GUIDE_STROKE_WIDTH,\n    });\n  }\n\n  /**\n   * @param {import('./types.js').FrameThumbs} frameThumbs\n   * @param {import('./types.js').Direction} direction\n   */\n  _createThumb(frameThumbs, direction) {\n    let groupNode = createSvgNode('g');\n    groupNode.classList.add('uc-thumb');\n    groupNode.setAttribute('with-effects', '');\n    let interactionNode = createSvgNode('rect', {\n      fill: 'transparent',\n    });\n    let pathNode = createSvgNode('path', {\n      stroke: 'currentColor',\n      fill: 'none',\n      'stroke-width': THUMB_STROKE_WIDTH,\n    });\n    groupNode.appendChild(pathNode);\n    groupNode.appendChild(interactionNode);\n    frameThumbs[direction] = {\n      direction,\n      pathNode,\n      interactionNode,\n      groupNode,\n    };\n\n    if (direction === '') {\n      groupNode.style.cursor = 'move';\n    }\n\n    interactionNode.addEventListener('pointerdown', this._handlePointerDown.bind(this, direction));\n  }\n\n  /** @private */\n  _createThumbs() {\n    /** @type {import('./types.js').FrameThumbs} */\n    const frameThumbs = {};\n\n    for (let i = 0; i < 3; i++) {\n      for (let j = 0; j < 3; j++) {\n        let direction = /** @type {import('./types.js').Direction} */ (`${['n', '', 's'][i]}${['w', '', 'e'][j]}`);\n        if (direction === '') {\n          continue;\n        }\n\n        this._createThumb(frameThumbs, direction);\n      }\n    }\n\n    this._createThumb(frameThumbs, '');\n    return frameThumbs;\n  }\n\n  /** @private */\n  _createGuides() {\n    let svg = createSvgNode('svg');\n\n    let rect = createSvgNode('rect', {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%',\n      fill: 'none',\n      stroke: 'currentColor',\n      'stroke-width': GUIDE_STROKE_WIDTH,\n      'stroke-opacity': 0.5,\n    });\n    svg.appendChild(rect);\n\n    for (let i = 1; i <= 2; i++) {\n      let line = createSvgNode('line', {\n        x1: `${GUIDE_THIRD * i}%`,\n        y1: `0%`,\n        x2: `${GUIDE_THIRD * i}%`,\n        y2: `100%`,\n        stroke: 'currentColor',\n        'stroke-width': GUIDE_STROKE_WIDTH,\n        'stroke-opacity': 0.3,\n      });\n      svg.appendChild(line);\n    }\n\n    for (let i = 1; i <= 2; i++) {\n      let line = createSvgNode('line', {\n        x1: `0%`,\n        y1: `${GUIDE_THIRD * i}%`,\n        x2: `100%`,\n        y2: `${GUIDE_THIRD * i}%`,\n        stroke: 'currentColor',\n        'stroke-width': GUIDE_STROKE_WIDTH,\n        'stroke-opacity': 0.3,\n      });\n      svg.appendChild(line);\n    }\n\n    svg.classList.add('uc-guides', 'uc-guides--semi-hidden');\n\n    return svg;\n  }\n\n  /** @private */\n  _createFrame() {\n    let svg = this.ref['svg-el'];\n    let fr = document.createDocumentFragment();\n\n    let frameGuides = this._createGuides();\n    fr.appendChild(frameGuides);\n\n    let frameThumbs = this._createThumbs();\n    for (let { groupNode } of Object.values(frameThumbs)) {\n      fr.appendChild(groupNode);\n    }\n\n    svg.appendChild(fr);\n    this._frameThumbs = frameThumbs;\n    this._frameGuides = frameGuides;\n  }\n\n  /**\n   * @private\n   * @param {import('./types.js').Direction} direction\n   * @param {PointerEvent} e\n   */\n  _handlePointerDown(direction, e) {\n    if (!this._frameThumbs) return;\n    let thumb = this._frameThumbs[direction];\n    if (this._shouldThumbBeDisabled(direction)) {\n      return;\n    }\n\n    let cropBox = this.$['*cropBox'];\n    let { x: svgX, y: svgY } = this.ref['svg-el'].getBoundingClientRect();\n    let x = e.x - svgX;\n    let y = e.y - svgY;\n\n    this.$.dragging = true;\n    this._draggingThumb = thumb;\n    this._dragStartPoint = [x, y];\n    /** @type {import('./types.js').Rectangle} */\n    this._dragStartCrop = { ...cropBox };\n  }\n\n  /**\n   * @private\n   * @param {PointerEvent} e\n   */\n  _handlePointerUp_(e) {\n    this._updateCursor();\n\n    if (!this.$.dragging) {\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n\n    this.$.dragging = false;\n  }\n\n  /**\n   * @private\n   * @param {PointerEvent} e\n   */\n  _handlePointerMove_(e) {\n    if (!this.$.dragging || !this._dragStartPoint || !this._draggingThumb) {\n      return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n\n    let svg = this.ref['svg-el'];\n    let { x: svgX, y: svgY } = svg.getBoundingClientRect();\n    let x = e.x - svgX;\n    let y = e.y - svgY;\n    let dx = x - this._dragStartPoint[0];\n    let dy = y - this._dragStartPoint[1];\n    let { direction } = this._draggingThumb;\n\n    const movedCropBox = this._calcCropBox(direction, [dx, dy]);\n    if (movedCropBox) {\n      this.$['*cropBox'] = movedCropBox;\n    }\n  }\n\n  /**\n   * @private\n   * @param {import('./types.js').Direction} direction\n   * @param {[Number, Number]} delta\n   */\n  _calcCropBox(direction, delta) {\n    const [dx, dy] = delta;\n    /** @type {import('./types.js').Rectangle} */\n    let imageBox = this.$['*imageBox'];\n    let rect = /** @type {import('./types.js').Rectangle} */ (this._dragStartCrop) ?? this.$['*cropBox'];\n    /** @type {import('./types.js').CropPresetList[0]} */\n    const cropPreset = this.$['*cropPresetList']?.[0];\n    const aspectRatio = cropPreset ? cropPreset.width / cropPreset.height : undefined;\n\n    if (direction === '') {\n      rect = moveRect({ rect, delta: [dx, dy], imageBox });\n    } else {\n      rect = resizeRect({ rect, delta: [dx, dy], direction, aspectRatio, imageBox });\n    }\n\n    if (!Object.values(rect).every((number) => Number.isFinite(number) && number >= 0)) {\n      console.error('CropFrame is trying to create invalid rectangle', {\n        payload: rect,\n      });\n      return;\n    }\n    return constraintRect(roundRect(rect), this.$['*imageBox']);\n  }\n\n  /**\n   * @private\n   * @param {PointerEvent} e\n   */\n  _handleSvgPointerMove_(e) {\n    if (!this._frameThumbs) return;\n\n    let hoverThumb = Object.values(this._frameThumbs).find((thumb) => {\n      if (this._shouldThumbBeDisabled(thumb.direction)) {\n        return false;\n      }\n      let node = thumb.interactionNode;\n      let bounds = node.getBoundingClientRect();\n      let rect = {\n        x: bounds.x,\n        y: bounds.y,\n        width: bounds.width,\n        height: bounds.height,\n      };\n      let hover = rectContainsPoint(rect, [e.x, e.y]);\n      return hover;\n    });\n\n    this._hoverThumb = hoverThumb;\n    this._updateCursor();\n  }\n\n  /** @private */\n  _updateCursor() {\n    let hoverThumb = this._hoverThumb;\n    this.ref['svg-el'].style.cursor = hoverThumb ? thumbCursor(hoverThumb.direction) : 'initial';\n  }\n\n  /**\n   * @private\n   * @param {String} href\n   */\n  _createMask(href) {\n    if (this._frameImage) {\n      this._frameImage.setAttribute('href', href);\n      return;\n    }\n\n    let svg = this.ref['svg-el'];\n    let fr = document.createDocumentFragment();\n\n    let imageNode = createSvgNode('image', {\n      href,\n    });\n\n    imageNode.setAttribute('class', 'uc-cloud-mask');\n\n    fr.appendChild(imageNode);\n\n    svg.appendChild(fr);\n\n    this._frameImage = imageNode;\n  }\n\n  _updateMask() {\n    let cropBox = this.$['*cropBox'];\n\n    if (!cropBox || !this._frameImage) {\n      return;\n    }\n\n    let { x, y, width, height } = cropBox;\n\n    setSvgNodeAttrs(this._frameImage, {\n      x,\n      y,\n      height,\n      width,\n    });\n  }\n\n  /** @private */\n  _render() {\n    this._updateBackdrop();\n    this._updateFrame();\n    this._updateMask();\n  }\n\n  /** @param {boolean} visible */\n  toggleThumbs(visible) {\n    if (!this._frameThumbs) return;\n    Object.values(this._frameThumbs)\n      .map(({ groupNode }) => groupNode)\n      .forEach((groupNode) => {\n        groupNode.setAttribute(\n          'class',\n          classNames('uc-thumb', {\n            'uc-thumb--hidden': !visible,\n            'uc-thumb--visible': visible,\n          }),\n        );\n      });\n  }\n\n  initCallback() {\n    super.initCallback();\n\n    this._createBackdrop();\n    this._createFrame();\n\n    this.sub('*imageBox', () => {\n      this._resizeBackdrop();\n      window.requestAnimationFrame(() => {\n        this._render();\n      });\n    });\n\n    this.sub('*cropBox', (cropBox) => {\n      if (!cropBox) {\n        return;\n      }\n      this._guidesHidden = cropBox.height <= MIN_CROP_SIZE || cropBox.width <= MIN_CROP_SIZE;\n      window.requestAnimationFrame(() => {\n        this._render();\n      });\n    });\n\n    this.subConfigValue('cloudImageEditorMaskHref', (maskHref) => {\n      if (maskHref) {\n        this._createMask(maskHref);\n      }\n    });\n\n    this.sub('dragging', (dragging) => {\n      if (!this._frameGuides) return;\n      this._frameGuides.setAttribute(\n        'class',\n        classNames({\n          'uc-guides--hidden': this._guidesHidden,\n          'uc-guides--visible': !this._guidesHidden && dragging,\n          'uc-guides--semi-hidden': !this._guidesHidden && !dragging,\n        }),\n      );\n    });\n\n    this.ref['svg-el'].addEventListener('pointermove', this._handleSvgPointerMove, true);\n    document.addEventListener('pointermove', this._handlePointerMove, true);\n    document.addEventListener('pointerup', this._handlePointerUp, true);\n  }\n\n  destroyCallback() {\n    super.destroyCallback();\n\n    document.removeEventListener('pointermove', this._handlePointerMove);\n    document.removeEventListener('pointerup', this._handlePointerUp);\n  }\n}\n\nCropFrame.template = /* HTML */ ` <svg class=\"uc-svg\" ref=\"svg-el\" xmlns=\"http://www.w3.org/2000/svg\"></svg> `;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}