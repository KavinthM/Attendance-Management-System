{"ast":null,"code":"import React,{useEffect,useState,useMemo}from\"react\";import Layout from\"../Components/Layout\";import{getAllAttendance,deleteAttendance,updateAttendance,notifyParentsForAbsents,generateFilteredReport}from\"../api/client\";import{STATUS_OPTIONS}from\"../utils/statusOptions\";import dayjs from\"dayjs\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AttendanceRecords=()=>{const[records,setRecords]=useState([]);const[loading,setLoading]=useState(true);const[editingId,setEditingId]=useState(null);const[editStatus,setEditStatus]=useState(\"\");const[saving,setSaving]=useState(false);// Search and filter states\nconst[searchTerm,setSearchTerm]=useState(\"\");const[dateFilter,setDateFilter]=useState(\"\");const[monthFilter,setMonthFilter]=useState(\"\");const[statusFilter,setStatusFilter]=useState(\"\");const[sectionFilter,setSectionFilter]=useState(\"\");// Notification states\nconst[notifying,setNotifying]=useState(false);const[notifiedRecords,setNotifiedRecords]=useState(new Set());const load=async()=>{setLoading(true);try{const{data}=await getAllAttendance();setRecords(data.records||[]);}finally{setLoading(false);}};useEffect(()=>{load();},[]);// Get unique sections from records\nconst availableSections=useMemo(()=>{const sections=new Set();records.forEach(record=>{var _record$student;if((_record$student=record.student)!==null&&_record$student!==void 0&&_record$student.section){sections.add(record.student.section);}});return Array.from(sections).sort();},[records]);// Filter records based on search criteria\nconst filteredRecords=useMemo(()=>{let filtered=[...records];// Filter by search term (name or index)\nif(searchTerm.trim()){const term=searchTerm.toLowerCase().trim();filtered=filtered.filter(record=>{var _record$student2,_record$student2$name,_record$student3,_record$student3$std_;return((_record$student2=record.student)===null||_record$student2===void 0?void 0:(_record$student2$name=_record$student2.name)===null||_record$student2$name===void 0?void 0:_record$student2$name.toLowerCase().includes(term))||((_record$student3=record.student)===null||_record$student3===void 0?void 0:(_record$student3$std_=_record$student3.std_index)===null||_record$student3$std_===void 0?void 0:_record$student3$std_.toLowerCase().includes(term));});}// Filter by date\nif(dateFilter){filtered=filtered.filter(record=>dayjs(record.date).format(\"YYYY-MM-DD\")===dateFilter);}// Filter by month\nif(monthFilter){filtered=filtered.filter(record=>dayjs(record.date).format(\"YYYY-MM\")===monthFilter);}// Filter by status\nif(statusFilter){filtered=filtered.filter(record=>record.status===statusFilter);}// Filter by section\nif(sectionFilter){filtered=filtered.filter(record=>{var _record$student4;return((_record$student4=record.student)===null||_record$student4===void 0?void 0:_record$student4.section)===sectionFilter;});}return filtered;},[records,searchTerm,dateFilter,monthFilter,statusFilter,sectionFilter]);// Get current date records that are absent/late and not yet notified\nconst currentDateAbsentLateRecords=useMemo(()=>{const today=dayjs().format(\"YYYY-MM-DD\");return records.filter(record=>record.student&&dayjs(record.date).format(\"YYYY-MM-DD\")===today&&(record.status===\"Absent\"||record.status===\"Late\")&&!record.notifiedParent&&!notifiedRecords.has(record._id));},[records,notifiedRecords]);const remove=async id=>{if(!window.confirm(\"Delete this record?\"))return;await deleteAttendance(id);await load();};const startEdit=record=>{setEditingId(record._id);setEditStatus(record.status||\"Present\");};const cancelEdit=()=>{setEditingId(null);setEditStatus(\"\");};const saveEdit=async id=>{setSaving(true);try{await updateAttendance(id,{status:editStatus});await load();cancelEdit();}catch(e){var _e$response,_e$response$data;alert((e===null||e===void 0?void 0:(_e$response=e.response)===null||_e$response===void 0?void 0:(_e$response$data=_e$response.data)===null||_e$response$data===void 0?void 0:_e$response$data.message)||\"Failed to update record\");}finally{setSaving(false);}};const clearFilters=()=>{setSearchTerm(\"\");setDateFilter(\"\");setMonthFilter(\"\");setStatusFilter(\"\");setSectionFilter(\"\");};const hasActiveFilters=searchTerm||dateFilter||monthFilter||statusFilter||sectionFilter;// Download functionality\nconst downloadReport=async()=>{try{// Check if there are records to download\nif(filteredRecords.length===0){alert('No records to download. Please adjust your filters.');return;}const{data:blob}=await generateFilteredReport({filters:{searchTerm:searchTerm||null,dateFilter:dateFilter||null,monthFilter:monthFilter||null,statusFilter:statusFilter||null,sectionFilter:sectionFilter||null},records:filteredRecords});// Check if blob is empty\nif(blob.size===0){throw new Error('Received empty PDF file.');}const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.style.display='none';a.href=url;// Generate filename based on filters\nlet filename='attendance_report';if(monthFilter){filename=\"attendance_report_\".concat(monthFilter);}else if(dateFilter){filename=\"attendance_report_\".concat(dateFilter);}else if(hasActiveFilters){filename='attendance_report_filtered';}filename+='.pdf';a.download=filename;document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);document.body.removeChild(a);console.log('PDF downloaded successfully:',filename);}catch(error){console.error('Download error:',error);alert(\"Failed to download report: \".concat(error.message));}};// Get button text based on filters\nconst getDownloadButtonText=()=>{if(monthFilter){return\"Download \".concat(dayjs(monthFilter).format('MMMM YYYY'),\" Report\");}else if(hasActiveFilters){return'Download Selected Range Report';}else{return'Download Current Report';}};// Notify parents for current date absent/late students\nconst notifyParentsForCurrentDate=async()=>{if(currentDateAbsentLateRecords.length===0){alert(\"No absent or late students found for today.\");return;}setNotifying(true);try{const items=currentDateAbsentLateRecords.filter(record=>{var _record$student5;return(_record$student5=record.student)===null||_record$student5===void 0?void 0:_record$student5._id;}).map(record=>({studentId:record.student._id,status:record.status,date:dayjs(record.date).format(\"YYYY-MM-DD\")}));console.log(\"Sending notifications for:\",items);const{data}=await notifyParentsForAbsents(items);const succeeded=Array.isArray(data===null||data===void 0?void 0:data.succeeded)?data.succeeded:[];const failed=Array.isArray(data===null||data===void 0?void 0:data.failed)?data.failed:[];if(succeeded.length>0){// Mark records as notified locally\nconst newNotifiedSet=new Set(notifiedRecords);currentDateAbsentLateRecords.forEach(record=>{if(succeeded.includes(record.student._id)){newNotifiedSet.add(record._id);}});setNotifiedRecords(newNotifiedSet);// Update the records in the database\nawait Promise.all(currentDateAbsentLateRecords.filter(record=>succeeded.includes(record.student._id)).map(record=>updateAttendance(record._id,{notifiedParent:true})));const notifiedNames=succeeded.map(id=>{const rec=currentDateAbsentLateRecords.find(r=>r.student._id===id);return rec?rec.student.name:'Unknown';}).join(\", \");alert(\"Successfully notified parents of: \".concat(notifiedNames));}if(failed.length>0){const names=failed.map(f=>{const record=currentDateAbsentLateRecords.find(r=>r.student._id===f.studentId);return record?\"\".concat(record.student.name,\" (\").concat(record.student.parentPhoneNum,\")\"):f.studentId;}).join(\", \");alert(\"Failed to notify: \".concat(names,\"\\n\\nPlease check phone numbers and try again.\"));}}catch(e){var _e$response2,_e$response2$data;console.error(\"Notification error:\",e);alert((e===null||e===void 0?void 0:(_e$response2=e.response)===null||_e$response2===void 0?void 0:(_e$response2$data=_e$response2.data)===null||_e$response2$data===void 0?void 0:_e$response2$data.message)||\"Failed to send notifications. Please check your Twilio configuration.\");}finally{setNotifying(false);}};return/*#__PURE__*/_jsxs(Layout,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4\",children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-3xl font-bold text-slate-900\",children:\"Attendance Records\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-slate-500 mt-1\",children:\"View and manage historical attendance data\"})]})}),currentDateAbsentLateRecords.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8 bg-rose-50 border border-rose-200 rounded-2xl p-6 flex flex-col sm:flex-row items-center justify-between gap-6 shadow-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-5\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-14 h-14 rounded-2xl bg-rose-100 flex items-center justify-center text-rose-600 shadow-inner\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-bell text-2xl animate-pulse\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-rose-800 m-0 leading-tight\",children:\"Action Needed\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-rose-700 mt-1\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"font-bold\",children:[currentDateAbsentLateRecords.length,\" student(s)\"]}),\" are marked absent or late today and parents haven't been notified yet.\"]})]})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"px-6 py-3 bg-rose-500 hover:bg-rose-600 text-white font-bold rounded-xl shadow-lg shadow-rose-500/30 transition-all hover:-translate-y-0.5 whitespace-nowrap flex items-center gap-2\",onClick:notifyParentsForCurrentDate,disabled:notifying,children:[notifying?/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-circle-notch fa-spin\"}):/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-paper-plane\"}),notifying?\"Sending...\":\"Notify All Parents\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"glass-panel p-6 mb-8 rounded-2xl border border-slate-200 shadow-sm\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 items-end\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-1.5\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs font-semibold text-slate-500 uppercase tracking-wider\",children:\"Search\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"input-field pl-10 w-full\",placeholder:\"Name or Index...\",value:searchTerm,onChange:e=>setSearchTerm(e.target.value)}),/*#__PURE__*/_jsx(\"i\",{className:\"fa-solid fa-search absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-1.5\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs font-semibold text-slate-500 uppercase tracking-wider\",children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",className:\"input-field w-full\",value:dateFilter,onChange:e=>setDateFilter(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-1.5\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs font-semibold text-slate-500 uppercase tracking-wider\",children:\"Month\"}),/*#__PURE__*/_jsx(\"input\",{type:\"month\",className:\"input-field w-full\",value:monthFilter,onChange:e=>setMonthFilter(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-1.5\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs font-semibold text-slate-500 uppercase tracking-wider\",children:\"Status\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsxs(\"select\",{className:\"input-field appearance-none w-full\",value:statusFilter,onChange:e=>setStatusFilter(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Status\"}),STATUS_OPTIONS.map(opt=>/*#__PURE__*/_jsx(\"option\",{value:opt.value,children:opt.label},opt.value))]}),/*#__PURE__*/_jsx(\"i\",{className:\"fa-solid fa-chevron-down absolute right-3.5 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col gap-1.5\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"text-xs font-semibold text-slate-500 uppercase tracking-wider\",children:\"Class\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsxs(\"select\",{className:\"input-field appearance-none w-full\",value:sectionFilter,onChange:e=>setSectionFilter(e.target.value),children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"All Classes\"}),availableSections.map(section=>/*#__PURE__*/_jsx(\"option\",{value:section,children:section},section))]}),/*#__PURE__*/_jsx(\"i\",{className:\"fa-solid fa-chevron-down absolute right-3.5 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col sm:flex-row justify-between items-center pt-6 border-t border-slate-100 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium text-slate-500\",children:[\"Found \",/*#__PURE__*/_jsx(\"span\",{className:\"text-slate-900 font-bold\",children:filteredRecords.length}),\" records\",hasActiveFilters&&/*#__PURE__*/_jsx(\"span\",{className:\"text-primary-600 ml-1\",children:\"(Filtered)\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3 w-full sm:w-auto\",children:[hasActiveFilters&&/*#__PURE__*/_jsxs(\"button\",{className:\"px-4 py-2 text-sm font-semibold text-slate-500 hover:text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors\",onClick:clearFilters,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times mr-2\"}),\" Clear\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:downloadReport,className:\"flex-1 sm:flex-none px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-lg shadow-md shadow-emerald-500/20 transition-all hover:-translate-y-0.5 whitespace-nowrap text-sm\",title:\"Download filtered attendance report\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-file-pdf mr-2\"}),getDownloadButtonText()]})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card overflow-hidden\",children:/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"w-full text-left border-collapse\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-slate-50 border-b border-slate-100 text-xs uppercase tracking-wider text-slate-500 font-semibold\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Date\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Student\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Index No\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Class\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4\",children:\"Reported\"}),/*#__PURE__*/_jsx(\"th\",{className:\"px-6 py-4 text-right\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"divide-y divide-slate-50\",children:loading?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsxs(\"td\",{colSpan:\"7\",className:\"text-center py-12 text-slate-400\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-circle-notch fa-spin text-2xl mb-2\"}),/*#__PURE__*/_jsx(\"br\",{}),\"Loading records...\"]})}):filteredRecords.length===0?/*#__PURE__*/_jsx(\"tr\",{children:/*#__PURE__*/_jsx(\"td\",{colSpan:\"7\",className:\"text-center py-12 text-slate-400\",children:\"No records found matching your filters\"})}):filteredRecords.map(r=>{var _r$student,_r$student2,_r$student3;return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-slate-50/80 transition-colors\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 font-mono text-sm text-slate-600\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"far fa-calendar text-slate-400\"}),dayjs(r.date).format(\"YYYY-MM-DD\")]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 font-semibold text-slate-900\",children:(_r$student=r.student)===null||_r$student===void 0?void 0:_r$student.name}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:/*#__PURE__*/_jsx(\"span\",{className:\"font-mono text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-md border border-slate-200\",children:(_r$student2=r.student)===null||_r$student2===void 0?void 0:_r$student2.std_index})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-sm text-slate-600\",children:(_r$student3=r.student)===null||_r$student3===void 0?void 0:_r$student3.section}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:editingId===r._id?/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"select\",{value:editStatus,onChange:e=>setEditStatus(e.target.value),className:\"input-field text-xs py-1 pr-8\",children:STATUS_OPTIONS.map(opt=>/*#__PURE__*/_jsx(\"option\",{value:opt.value,children:opt.label},opt.value))}),/*#__PURE__*/_jsx(\"i\",{className:\"fa-solid fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-[10px]\"})]}):/*#__PURE__*/_jsxs(\"span\",{className:\"\\n                           inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\\n                           \".concat(r.status==='Present'?'bg-emerald-100 text-emerald-800':'',\"\\n                           \").concat(r.status==='Absent'?'bg-rose-100 text-rose-800':'',\"\\n                           \").concat(r.status==='Late'?'bg-amber-100 text-amber-800':'',\"\\n                           \").concat(r.status==='Excused'?'bg-blue-100 text-blue-800':'',\"\\n                        \"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-1.5 h-1.5 rounded-full mr-1.5 \\n                             \".concat(r.status==='Present'?'bg-emerald-500':'',\"\\n                             \").concat(r.status==='Absent'?'bg-rose-500':'',\"\\n                             \").concat(r.status==='Late'?'bg-amber-500':'',\"\\n                             \").concat(r.status==='Excused'?'bg-blue-500':'',\"\\n                          \")}),r.status]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4\",children:r.notifiedParent||notifiedRecords.has(r._id)?/*#__PURE__*/_jsxs(\"span\",{className:\"text-emerald-600 flex items-center gap-1.5 text-xs font-bold bg-emerald-50 px-2 py-1 rounded-full w-fit\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check-circle\"}),\" Notified\"]}):/*#__PURE__*/_jsx(\"span\",{className:\"text-slate-300 text-xs\",children:\"-\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-6 py-4 text-right\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end gap-2\",children:editingId===r._id?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 hover:bg-emerald-200 flex items-center justify-center transition-colors\",onClick:()=>saveEdit(r._id),disabled:saving,title:\"Save\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-save\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 flex items-center justify-center transition-colors\",onClick:cancelEdit,disabled:saving,title:\"Cancel\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"})})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{className:\"w-8 h-8 rounded-full text-slate-400 hover:bg-primary-50 hover:text-primary-600 flex items-center justify-center transition-colors\",onClick:()=>startEdit(r),title:\"Edit\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-pen\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"w-8 h-8 rounded-full text-slate-400 hover:bg-rose-50 hover:text-rose-600 flex items-center justify-center transition-colors\",onClick:()=>remove(r._id),title:\"Delete\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash-can\"})})]})})})]},r._id);})})]})})})]});};export default AttendanceRecords;","map":{"version":3,"names":["React","useEffect","useState","useMemo","Layout","getAllAttendance","deleteAttendance","updateAttendance","notifyParentsForAbsents","generateFilteredReport","STATUS_OPTIONS","dayjs","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AttendanceRecords","records","setRecords","loading","setLoading","editingId","setEditingId","editStatus","setEditStatus","saving","setSaving","searchTerm","setSearchTerm","dateFilter","setDateFilter","monthFilter","setMonthFilter","statusFilter","setStatusFilter","sectionFilter","setSectionFilter","notifying","setNotifying","notifiedRecords","setNotifiedRecords","Set","load","data","availableSections","sections","forEach","record","_record$student","student","section","add","Array","from","sort","filteredRecords","filtered","trim","term","toLowerCase","filter","_record$student2","_record$student2$name","_record$student3","_record$student3$std_","name","includes","std_index","date","format","status","_record$student4","currentDateAbsentLateRecords","today","notifiedParent","has","_id","remove","id","window","confirm","startEdit","cancelEdit","saveEdit","e","_e$response","_e$response$data","alert","response","message","clearFilters","hasActiveFilters","downloadReport","length","blob","filters","size","Error","url","URL","createObjectURL","a","document","createElement","style","display","href","filename","concat","download","body","appendChild","click","revokeObjectURL","removeChild","console","log","error","getDownloadButtonText","notifyParentsForCurrentDate","items","_record$student5","map","studentId","succeeded","isArray","failed","newNotifiedSet","Promise","all","notifiedNames","rec","find","r","join","names","f","parentPhoneNum","_e$response2","_e$response2$data","children","className","onClick","disabled","type","placeholder","value","onChange","target","opt","label","title","colSpan","_r$student","_r$student2","_r$student3"],"sources":["/Users/kavinth/Documents/GitHub/Smart-Alert/Smart-Alert-new/frontend/src/pages/AttendanceRecords.jsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from \"react\";\nimport Layout from \"../Components/Layout\";\nimport { getAllAttendance, deleteAttendance, updateAttendance, notifyParentsForAbsents, generateFilteredReport } from \"../api/client\";\nimport { STATUS_OPTIONS } from \"../utils/statusOptions\";\nimport dayjs from \"dayjs\";\n\nconst AttendanceRecords = () => {\n  const [records, setRecords] = useState([]);\n  const [loading, setLoading] = useState(true);\n\n  const [editingId, setEditingId] = useState(null);\n  const [editStatus, setEditStatus] = useState(\"\");\n  const [saving, setSaving] = useState(false);\n\n  // Search and filter states\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [dateFilter, setDateFilter] = useState(\"\");\n  const [monthFilter, setMonthFilter] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"\");\n  const [sectionFilter, setSectionFilter] = useState(\"\");\n\n  // Notification states\n  const [notifying, setNotifying] = useState(false);\n  const [notifiedRecords, setNotifiedRecords] = useState(new Set());\n\n  const load = async () => {\n    setLoading(true);\n    try {\n      const { data } = await getAllAttendance();\n      setRecords(data.records || []);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  useEffect(() => {\n    load();\n  }, []);\n\n  // Get unique sections from records\n  const availableSections = useMemo(() => {\n    const sections = new Set();\n    records.forEach(record => {\n      if (record.student?.section) {\n        sections.add(record.student.section);\n      }\n    });\n    return Array.from(sections).sort();\n  }, [records]);\n\n  // Filter records based on search criteria\n  const filteredRecords = useMemo(() => {\n    let filtered = [...records];\n\n    // Filter by search term (name or index)\n    if (searchTerm.trim()) {\n      const term = searchTerm.toLowerCase().trim();\n      filtered = filtered.filter(record =>\n        record.student?.name?.toLowerCase().includes(term) ||\n        record.student?.std_index?.toLowerCase().includes(term)\n      );\n    }\n\n    // Filter by date\n    if (dateFilter) {\n      filtered = filtered.filter(record =>\n        dayjs(record.date).format(\"YYYY-MM-DD\") === dateFilter\n      );\n    }\n\n    // Filter by month\n    if (monthFilter) {\n      filtered = filtered.filter(record =>\n        dayjs(record.date).format(\"YYYY-MM\") === monthFilter\n      );\n    }\n\n    // Filter by status\n    if (statusFilter) {\n      filtered = filtered.filter(record => record.status === statusFilter);\n    }\n\n    // Filter by section\n    if (sectionFilter) {\n      filtered = filtered.filter(record => record.student?.section === sectionFilter);\n    }\n\n    return filtered;\n  }, [records, searchTerm, dateFilter, monthFilter, statusFilter, sectionFilter]);\n\n  // Get current date records that are absent/late and not yet notified\n  const currentDateAbsentLateRecords = useMemo(() => {\n    const today = dayjs().format(\"YYYY-MM-DD\");\n    return records.filter(record =>\n      record.student &&\n      dayjs(record.date).format(\"YYYY-MM-DD\") === today &&\n      (record.status === \"Absent\" || record.status === \"Late\") &&\n      !record.notifiedParent &&\n      !notifiedRecords.has(record._id)\n    );\n  }, [records, notifiedRecords]);\n\n  const remove = async (id) => {\n    if (!window.confirm(\"Delete this record?\")) return;\n    await deleteAttendance(id);\n    await load();\n  };\n\n  const startEdit = (record) => {\n    setEditingId(record._id);\n    setEditStatus(record.status || \"Present\");\n  };\n\n  const cancelEdit = () => {\n    setEditingId(null);\n    setEditStatus(\"\");\n  };\n\n  const saveEdit = async (id) => {\n    setSaving(true);\n    try {\n      await updateAttendance(id, { status: editStatus });\n      await load();\n      cancelEdit();\n    } catch (e) {\n      alert(e?.response?.data?.message || \"Failed to update record\");\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const clearFilters = () => {\n    setSearchTerm(\"\");\n    setDateFilter(\"\");\n    setMonthFilter(\"\");\n    setStatusFilter(\"\");\n    setSectionFilter(\"\");\n  };\n\n  const hasActiveFilters = searchTerm || dateFilter || monthFilter || statusFilter || sectionFilter;\n\n  // Download functionality\n  const downloadReport = async () => {\n    try {\n      // Check if there are records to download\n      if (filteredRecords.length === 0) {\n        alert('No records to download. Please adjust your filters.');\n        return;\n      }\n\n      const { data: blob } = await generateFilteredReport({\n        filters: {\n          searchTerm: searchTerm || null,\n          dateFilter: dateFilter || null,\n          monthFilter: monthFilter || null,\n          statusFilter: statusFilter || null,\n          sectionFilter: sectionFilter || null,\n        },\n        records: filteredRecords\n      });\n\n      // Check if blob is empty\n      if (blob.size === 0) {\n        throw new Error('Received empty PDF file.');\n      }\n\n      const url = window.URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.style.display = 'none';\n      a.href = url;\n\n      // Generate filename based on filters\n      let filename = 'attendance_report';\n      if (monthFilter) {\n        filename = `attendance_report_${monthFilter}`;\n      } else if (dateFilter) {\n        filename = `attendance_report_${dateFilter}`;\n      } else if (hasActiveFilters) {\n        filename = 'attendance_report_filtered';\n      }\n      filename += '.pdf';\n\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      window.URL.revokeObjectURL(url);\n      document.body.removeChild(a);\n\n      console.log('PDF downloaded successfully:', filename);\n    } catch (error) {\n      console.error('Download error:', error);\n      alert(`Failed to download report: ${error.message}`);\n    }\n  };\n\n  // Get button text based on filters\n  const getDownloadButtonText = () => {\n    if (monthFilter) {\n      return `Download ${dayjs(monthFilter).format('MMMM YYYY')} Report`;\n    } else if (hasActiveFilters) {\n      return 'Download Selected Range Report';\n    } else {\n      return 'Download Current Report';\n    }\n  };\n\n  // Notify parents for current date absent/late students\n  const notifyParentsForCurrentDate = async () => {\n    if (currentDateAbsentLateRecords.length === 0) {\n      alert(\"No absent or late students found for today.\");\n      return;\n    }\n\n    setNotifying(true);\n    try {\n      const items = currentDateAbsentLateRecords\n        .filter(record => record.student?._id)\n        .map(record => ({\n          studentId: record.student._id,\n          status: record.status,\n          date: dayjs(record.date).format(\"YYYY-MM-DD\")\n        }));\n\n      console.log(\"Sending notifications for:\", items);\n\n      const { data } = await notifyParentsForAbsents(items);\n      const succeeded = Array.isArray(data?.succeeded) ? data.succeeded : [];\n      const failed = Array.isArray(data?.failed) ? data.failed : [];\n\n      if (succeeded.length > 0) {\n        // Mark records as notified locally\n        const newNotifiedSet = new Set(notifiedRecords);\n        currentDateAbsentLateRecords.forEach(record => {\n          if (succeeded.includes(record.student._id)) {\n            newNotifiedSet.add(record._id);\n          }\n        });\n        setNotifiedRecords(newNotifiedSet);\n\n        // Update the records in the database\n        await Promise.all(\n          currentDateAbsentLateRecords\n            .filter(record => succeeded.includes(record.student._id))\n            .map(record =>\n              updateAttendance(record._id, { notifiedParent: true })\n            )\n        );\n\n        const notifiedNames = succeeded.map(id => {\n          const rec = currentDateAbsentLateRecords.find(r => r.student._id === id);\n          return rec ? rec.student.name : 'Unknown';\n        }).join(\", \");\n\n        alert(`Successfully notified parents of: ${notifiedNames}`);\n      }\n\n      if (failed.length > 0) {\n        const names = failed\n          .map((f) => {\n            const record = currentDateAbsentLateRecords.find(r => r.student._id === f.studentId);\n            return record ? `${record.student.name} (${record.student.parentPhoneNum})` : f.studentId;\n          })\n          .join(\", \");\n        alert(`Failed to notify: ${names}\\n\\nPlease check phone numbers and try again.`);\n      }\n    } catch (e) {\n      console.error(\"Notification error:\", e);\n      alert(e?.response?.data?.message || \"Failed to send notifications. Please check your Twilio configuration.\");\n    } finally {\n      setNotifying(false);\n    }\n  };\n\n  return (\n    <Layout>\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-slate-900\">Attendance Records</h1>\n          <p className=\"text-slate-500 mt-1\">View and manage historical attendance data</p>\n        </div>\n      </div>\n\n      {/* Notification Section for Current Date */}\n      {currentDateAbsentLateRecords.length > 0 && (\n        <div className=\"mb-8 bg-rose-50 border border-rose-200 rounded-2xl p-6 flex flex-col sm:flex-row items-center justify-between gap-6 shadow-sm\">\n          <div className=\"flex items-center gap-5\">\n            <div className=\"w-14 h-14 rounded-2xl bg-rose-100 flex items-center justify-center text-rose-600 shadow-inner\">\n              <i className=\"fas fa-bell text-2xl animate-pulse\"></i>\n            </div>\n            <div>\n              <h3 className=\"text-xl font-bold text-rose-800 m-0 leading-tight\">\n                Action Needed\n              </h3>\n              <p className=\"text-rose-700 mt-1\">\n                <span className=\"font-bold\">{currentDateAbsentLateRecords.length} student(s)</span> are marked absent or late today and parents haven't been notified yet.\n              </p>\n            </div>\n          </div>\n          <button\n            className=\"px-6 py-3 bg-rose-500 hover:bg-rose-600 text-white font-bold rounded-xl shadow-lg shadow-rose-500/30 transition-all hover:-translate-y-0.5 whitespace-nowrap flex items-center gap-2\"\n            onClick={notifyParentsForCurrentDate}\n            disabled={notifying}\n          >\n            {notifying ? <i className=\"fas fa-circle-notch fa-spin\"></i> : <i className=\"fas fa-paper-plane\"></i>}\n            {notifying ? \"Sending...\" : \"Notify All Parents\"}\n          </button>\n        </div>\n      )}\n\n      {/* Search and Filter Section */}\n      <div className=\"glass-panel p-6 mb-8 rounded-2xl border border-slate-200 shadow-sm\">\n        <div className=\"flex flex-col gap-6\">\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4 items-end\">\n            {/* Search by Name/Index */}\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">Search</label>\n              <div className=\"relative\">\n                <input\n                  type=\"text\"\n                  className=\"input-field pl-10 w-full\"\n                  placeholder=\"Name or Index...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                />\n                <i className=\"fa-solid fa-search absolute left-3.5 top-1/2 -translate-y-1/2 text-slate-400\"></i>\n              </div>\n            </div>\n\n            {/* Filter by Date */}\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">Date</label>\n              <input\n                type=\"date\"\n                className=\"input-field w-full\"\n                value={dateFilter}\n                onChange={(e) => setDateFilter(e.target.value)}\n              />\n            </div>\n\n            {/* Filter by Month */}\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">Month</label>\n              <input\n                type=\"month\"\n                className=\"input-field w-full\"\n                value={monthFilter}\n                onChange={(e) => setMonthFilter(e.target.value)}\n              />\n            </div>\n\n            {/* Filter by Status */}\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">Status</label>\n              <div className=\"relative\">\n                <select\n                  className=\"input-field appearance-none w-full\"\n                  value={statusFilter}\n                  onChange={(e) => setStatusFilter(e.target.value)}\n                >\n                  <option value=\"\">All Status</option>\n                  {STATUS_OPTIONS.map((opt) => (\n                    <option key={opt.value} value={opt.value}>\n                      {opt.label}\n                    </option>\n                  ))}\n                </select>\n                <i className=\"fa-solid fa-chevron-down absolute right-3.5 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\"></i>\n              </div>\n            </div>\n\n            {/* Filter by Section */}\n            <div className=\"flex flex-col gap-1.5\">\n              <label className=\"text-xs font-semibold text-slate-500 uppercase tracking-wider\">Class</label>\n              <div className=\"relative\">\n                <select\n                  className=\"input-field appearance-none w-full\"\n                  value={sectionFilter}\n                  onChange={(e) => setSectionFilter(e.target.value)}\n                >\n                  <option value=\"\">All Classes</option>\n                  {availableSections.map((section) => (\n                    <option key={section} value={section}>\n                      {section}\n                    </option>\n                  ))}\n                </select>\n                <i className=\"fa-solid fa-chevron-down absolute right-3.5 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-xs\"></i>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"flex flex-col sm:flex-row justify-between items-center pt-6 border-t border-slate-100 gap-4\">\n            <div className=\"text-sm font-medium text-slate-500\">\n              Found <span className=\"text-slate-900 font-bold\">{filteredRecords.length}</span> records\n              {hasActiveFilters && <span className=\"text-primary-600 ml-1\">(Filtered)</span>}\n            </div>\n\n            <div className=\"flex items-center gap-3 w-full sm:w-auto\">\n              {hasActiveFilters && (\n                <button\n                  className=\"px-4 py-2 text-sm font-semibold text-slate-500 hover:text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors\"\n                  onClick={clearFilters}\n                >\n                  <i className=\"fas fa-times mr-2\"></i> Clear\n                </button>\n              )}\n\n              <button\n                onClick={downloadReport}\n                className=\"flex-1 sm:flex-none px-4 py-2 bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-lg shadow-md shadow-emerald-500/20 transition-all hover:-translate-y-0.5 whitespace-nowrap text-sm\"\n                title=\"Download filtered attendance report\"\n              >\n                <i className=\"fas fa-file-pdf mr-2\"></i>\n                {getDownloadButtonText()}\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Records Table */}\n      <div className=\"card overflow-hidden\">\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left border-collapse\">\n            <thead>\n              <tr className=\"bg-slate-50 border-b border-slate-100 text-xs uppercase tracking-wider text-slate-500 font-semibold\">\n                <th className=\"px-6 py-4\">Date</th>\n                <th className=\"px-6 py-4\">Student</th>\n                <th className=\"px-6 py-4\">Index No</th>\n                <th className=\"px-6 py-4\">Class</th>\n                <th className=\"px-6 py-4\">Status</th>\n                <th className=\"px-6 py-4\">Reported</th>\n                <th className=\"px-6 py-4 text-right\">Actions</th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-slate-50\">\n              {loading ? (\n                <tr><td colSpan=\"7\" className=\"text-center py-12 text-slate-400\"><i className=\"fas fa-circle-notch fa-spin text-2xl mb-2\"></i><br />Loading records...</td></tr>\n              ) : filteredRecords.length === 0 ? (\n                <tr><td colSpan=\"7\" className=\"text-center py-12 text-slate-400\">No records found matching your filters</td></tr>\n              ) : (\n                filteredRecords.map((r) => (\n                  <tr key={r._id} className=\"hover:bg-slate-50/80 transition-colors\">\n                    <td className=\"px-6 py-4 font-mono text-sm text-slate-600\">\n                      <div className=\"flex items-center gap-2\">\n                        <i className=\"far fa-calendar text-slate-400\"></i>\n                        {dayjs(r.date).format(\"YYYY-MM-DD\")}\n                      </div>\n                    </td>\n                    <td className=\"px-6 py-4 font-semibold text-slate-900\">{r.student?.name}</td>\n                    <td className=\"px-6 py-4\">\n                      <span className=\"font-mono text-xs font-medium text-slate-500 bg-slate-100 px-2 py-1 rounded-md border border-slate-200\">\n                        {r.student?.std_index}\n                      </span>\n                    </td>\n                    <td className=\"px-6 py-4 text-sm text-slate-600\">{r.student?.section}</td>\n\n                    <td className=\"px-6 py-4\">\n                      {editingId === r._id ? (\n                        <div className=\"relative\">\n                          <select\n                            value={editStatus}\n                            onChange={(e) => setEditStatus(e.target.value)}\n                            className=\"input-field text-xs py-1 pr-8\"\n                          >\n                            {STATUS_OPTIONS.map((opt) => (\n                              <option key={opt.value} value={opt.value}>{opt.label}</option>\n                            ))}\n                          </select>\n                          <i className=\"fa-solid fa-chevron-down absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none text-[10px]\"></i>\n                        </div>\n                      ) : (\n                        <span className={`\n                           inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium\n                           ${r.status === 'Present' ? 'bg-emerald-100 text-emerald-800' : ''}\n                           ${r.status === 'Absent' ? 'bg-rose-100 text-rose-800' : ''}\n                           ${r.status === 'Late' ? 'bg-amber-100 text-amber-800' : ''}\n                           ${r.status === 'Excused' ? 'bg-blue-100 text-blue-800' : ''}\n                        `}>\n                          <span className={`w-1.5 h-1.5 rounded-full mr-1.5 \n                             ${r.status === 'Present' ? 'bg-emerald-500' : ''}\n                             ${r.status === 'Absent' ? 'bg-rose-500' : ''}\n                             ${r.status === 'Late' ? 'bg-amber-500' : ''}\n                             ${r.status === 'Excused' ? 'bg-blue-500' : ''}\n                          `}></span>\n                          {r.status}\n                        </span>\n                      )}\n                    </td>\n\n                    <td className=\"px-6 py-4\">\n                      {r.notifiedParent || notifiedRecords.has(r._id) ? (\n                        <span className=\"text-emerald-600 flex items-center gap-1.5 text-xs font-bold bg-emerald-50 px-2 py-1 rounded-full w-fit\">\n                          <i className=\"fas fa-check-circle\"></i> Notified\n                        </span>\n                      ) : (\n                        <span className=\"text-slate-300 text-xs\">-</span>\n                      )}\n                    </td>\n\n                    <td className=\"px-6 py-4 text-right\">\n                      <div className=\"flex justify-end gap-2\">\n                        {editingId === r._id ? (\n                          <>\n                            <button\n                              className=\"w-8 h-8 rounded-full bg-emerald-100 text-emerald-600 hover:bg-emerald-200 flex items-center justify-center transition-colors\"\n                              onClick={() => saveEdit(r._id)}\n                              disabled={saving}\n                              title=\"Save\"\n                            >\n                              <i className=\"fas fa-save\"></i>\n                            </button>\n                            <button\n                              className=\"w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 flex items-center justify-center transition-colors\"\n                              onClick={cancelEdit}\n                              disabled={saving}\n                              title=\"Cancel\"\n                            >\n                              <i className=\"fas fa-times\"></i>\n                            </button>\n                          </>\n                        ) : (\n                          <>\n                            <button\n                              className=\"w-8 h-8 rounded-full text-slate-400 hover:bg-primary-50 hover:text-primary-600 flex items-center justify-center transition-colors\"\n                              onClick={() => startEdit(r)}\n                              title=\"Edit\"\n                            >\n                              <i className=\"fas fa-pen\"></i>\n                            </button>\n                            <button\n                              className=\"w-8 h-8 rounded-full text-slate-400 hover:bg-rose-50 hover:text-rose-600 flex items-center justify-center transition-colors\"\n                              onClick={() => remove(r._id)}\n                              title=\"Delete\"\n                            >\n                              <i className=\"fas fa-trash-can\"></i>\n                            </button>\n                          </>\n                        )}\n                      </div>\n                    </td>\n                  </tr>\n                ))\n              )}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </Layout>\n  );\n};\n\nexport default AttendanceRecords;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}